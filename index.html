<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/author.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/author.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"losserlong.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="今日长缨在手，何时缚住苍龙？">
<meta property="og:type" content="website">
<meta property="og:title" content="Xiang&#39;s Blog">
<meta property="og:url" content="https://losserlong.github.io/index.html">
<meta property="og:site_name" content="Xiang&#39;s Blog">
<meta property="og:description" content="今日长缨在手，何时缚住苍龙？">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Xiang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://losserlong.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Xiang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  
<script type="text/javascript" src="/js/love.js"></script>

</head>

<body itemscope itemtype="http://schema.org/WebPage">


<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>


  <div class="container use-motion">
    <div class="headband"></div>

<a target="_blank" rel="noopener" href="https://github.com/losserlong" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Xiang's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">欲买桂花重载酒，终不似，少年游</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">4</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">4</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">5</span></a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://losserlong.github.io/2022/01/20/nginx%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="Xiang">
      <meta itemprop="description" content="今日长缨在手，何时缚住苍龙？">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/20/nginx%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">nginx学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-20 19:47:18 / 修改时间：19:59:07" itemprop="dateCreated datePublished" datetime="2022-01-20T19:47:18+08:00">2022-01-20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/nginx/" itemprop="url" rel="index"><span itemprop="name">nginx</span></a>
                </span>
			  <span>℃</span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="nginx安装"><a href="#nginx安装" class="headerlink" title="nginx安装"></a>nginx安装</h1><h2 id="第一步，-安装-pcre"><a href="#第一步，-安装-pcre" class="headerlink" title="第一步， 安装 pcre"></a>第一步， 安装 pcre</h2><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">wget</span> http://downloads.sourceforge.net/project/pcre/pcre/8.37/pcre-8.37.tar.gz
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">tar</span> -zxvf pcre-8.37.tar.gz
./configure 完成后，回到 pcre 目录下执行 make，
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="第二步，-安装-openssl"><a href="#第二步，-安装-openssl" class="headerlink" title="第二步， 安装 openssl"></a>第二步， 安装 openssl</h2><h2 id="第三步，-安装-zlib"><a href="#第三步，-安装-zlib" class="headerlink" title="第三步， 安装 zlib"></a>第三步， 安装 zlib</h2><pre class="line-numbers language-bash"><code class="language-bash">yum -y <span class="token function">install</span> <span class="token function">make</span> zlib zlib-devel gcc-c++ libtool openssl openssl-devel
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="第四步，-安装-nginx"><a href="#第四步，-安装-nginx" class="headerlink" title="第四步， 安装 nginx"></a>第四步， 安装 nginx</h2><p>1、 解压缩 nginx-xx.tar.gz 包  </p>
<p>2、 进入解压缩目录， 执行./configure。  </p>
<p>3、 make &amp;&amp; make install  </p>
<h3 id="设置nginx的环境变量"><a href="#设置nginx的环境变量" class="headerlink" title="设置nginx的环境变量"></a>设置nginx的环境变量</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">ln</span> -s /usr/local/nginx/sbin/nginx /usr/local/bin/
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="查看开放的端口号"><a href="#查看开放的端口号" class="headerlink" title="查看开放的端口号"></a>查看开放的端口号</h3><pre class="line-numbers language-bash"><code class="language-bash">firewall -cmd --list-all
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="设置开放的端口号"><a href="#设置开放的端口号" class="headerlink" title="设置开放的端口号"></a>设置开放的端口号</h3><pre class="line-numbers language-bash"><code class="language-bash">firewall -cmd --add-service<span class="token operator">=</span>http –permanent
<span class="token function">sudo</span> firewall -cmd --add-port<span class="token operator">=</span>80/tcp --permanent
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="重启防火墙"><a href="#重启防火墙" class="headerlink" title="重启防火墙"></a>重启防火墙</h3><pre class="line-numbers language-bash"><code class="language-bash">firewall-cmd –reload
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="nginx的常用指令"><a href="#nginx的常用指令" class="headerlink" title="nginx的常用指令"></a>nginx的常用指令</h1><pre><code>## （ 1）启动命令  
</code></pre>
<pre class="line-numbers language-bash"><code class="language-bash">在/usr/local/nginx/sbin 目录下执行 ./nginx
因为配置了环境变量，可以直接使用nginx
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>## （ 2）关闭命令  
</code></pre>
<pre class="line-numbers language-bash"><code class="language-bash">在/usr/local/nginx/sbin 目录下执行 ./nginx -s stop
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="（-3）-重新加载命令-这个是热加载的方式"><a href="#（-3）-重新加载命令-这个是热加载的方式" class="headerlink" title="（ 3） 重新加载命令  这个是热加载的方式"></a>（ 3） 重新加载命令  这个是热加载的方式</h2><pre class="line-numbers language-bash"><code class="language-bash">在/usr/local/nginx/sbin 目录下执行 ./nginx -s reload
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="tomtcat的安装目录"><a href="#tomtcat的安装目录" class="headerlink" title="tomtcat的安装目录"></a>tomtcat的安装目录</h2><pre class="line-numbers language-txt"><code class="language-txt">/usr/src/apache-tomcat-9.0.52/bin
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="配置反向代理（1）"><a href="#配置反向代理（1）" class="headerlink" title="配置反向代理（1）"></a>配置反向代理（1）</h1><p>先要在Windows的C:\Windows\System32\drivers\etc下的hosts里面加上192.168.58.130   <a target="_blank" rel="noopener" href="http://www.123.com/">www.123.com</a></p>
<p><font color='red'>注意这个要用editplus打开，管理员运行</font></p>
<pre class="line-numbers language-txt"><code class="language-txt">这个是在nginx.config
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这个nginx的配置文件是在**/usr/local/nginx/conf**</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195047.png" alt="image-20210909110313430"></p>
<pre class="line-numbers language-bash"><code class="language-bash">这个proxy_pass http://127.0.0.1:8080这个是要转发的路径    
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195050.png" alt="image-20210909113916794"></p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195117.png" alt="image-20220118203823143"></p>
<h1 id="Nginx配置实例-反向代理（2）"><a href="#Nginx配置实例-反向代理（2）" class="headerlink" title="Nginx配置实例-反向代理（2）"></a>Nginx配置实例-反向代理（2）</h1><p>实现效果：使用 nginx 反向代理， 根据访问的路径跳转到不同端口的服务中<br>nginx 监听端口为 9001，<br>访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:9001/edu/">http://127.0.0.1:9001/edu/</a> 直接跳转到 127.0.0.1:8081<br>访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:9001/vod/">http://127.0.0.1:9001/vod/</a> 直接跳转到 127.0.0.1:8082  </p>
<h2 id="这个是在nginx-conf里面配置"><a href="#这个是在nginx-conf里面配置" class="headerlink" title="这个是在nginx.conf里面配置"></a>这个是在nginx.conf里面配置</h2><pre class="line-numbers language-bash"><code class="language-bash">    server <span class="token punctuation">{</span>
        listen       9001<span class="token punctuation">;</span>
        server_name  192.168.58.130<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true"># 这个~表示的是后面是正则表达式的意思，如果路径中有edu就跳转到http://127.0.0.1:8080</span>
        location ~ /edu/ <span class="token punctuation">{</span>
           proxy_pass http://127.0.0.1:8080<span class="token punctuation">;</span>

 <span class="token punctuation">}</span>
        location ~ /vod/ <span class="token punctuation">{</span>
           proxy_pass http://127.0.0.1:8081<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

   <span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195906.png" alt="image-20210909144804339"></p>
<h2 id="开放对外访问的端口9001-8080-8081"><a href="#开放对外访问的端口9001-8080-8081" class="headerlink" title="开放对外访问的端口9001 8080 8081"></a>开放对外访问的端口9001 8080 8081</h2><h3 id="查看开放的端口号-1"><a href="#查看开放的端口号-1" class="headerlink" title="查看开放的端口号"></a>查看开放的端口号</h3><pre class="line-numbers language-bash"><code class="language-bash">firewall-cmd  --list-all
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="打开指定的端口号"><a href="#打开指定的端口号" class="headerlink" title="打开指定的端口号"></a>打开指定的端口号</h3><pre class="line-numbers language-bash"><code class="language-bash">firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>端口号/tcp --permanent
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195122.png" alt="image-20220118211444270"></p>
<p><img src="C:\Users\losser\AppData\Roaming\Typora\typora-user-images\image-20220118211459868.png" alt="image-20220118211459868"></p>
<h1 id="nginx实现负载均衡的效果"><a href="#nginx实现负载均衡的效果" class="headerlink" title="nginx实现负载均衡的效果"></a>nginx实现负载均衡的效果</h1><h2 id="实现nginx的负载均衡效果"><a href="#实现nginx的负载均衡效果" class="headerlink" title="实现nginx的负载均衡效果"></a>实现nginx的负载均衡效果</h2><blockquote>
<p>1、实现效果<br>(1）浏览器地址栏输入地址<a target="_blank" rel="noopener" href="http://192.168.17.129/edu/a.html%EF%BC%8C%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%95%88%E6%9E%9C%EF%BC%8C%E5%B9%B3%E5%9D%878080%E5%92%8C8081%E7%AB%AF%E5%8F%A3%E4%B8%AD">http://192.168.17.129/edu/a.html，负载均衡效果，平均8080和8081端口中</a></p>
<p>2、准备工作<br>(1）准备两台tomcat服务器，一台8080,一台8081<br>(2）在两台tomcat里面webapps,目录中，创建名称是edu文件夹，在edu,文件夹中创建页面a.html,用于测试</p>
<p>3、/usr/local/nginx/conf下面配置nginx的配置文件</p>
</blockquote>
<p>这个是在nginx.conf文件的配置</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195127.png" alt="image-20220118213235623"></p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195131.png" alt="image-20220118214750883"></p>
<p>负载均均衡效果</p>
<p><img src="C:\Users\losser\AppData\Roaming\Typora\typora-user-images\image-20220118220151429.png" alt="image-20220118220151429"></p>
<h2 id="nginx的负载均衡策略"><a href="#nginx的负载均衡策略" class="headerlink" title="nginx的负载均衡策略"></a>nginx的负载均衡策略</h2><p><strong>1、</strong>轮询（默认） </p>
<p>每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器 down 掉，能自动剔除。 </p>
<p><strong>2、</strong>    <strong>weight</strong></p>
<p>weight 代表权,重默认为 1,权重越高被分配的客户端越多 </p>
<blockquote>
<p>upstream server_pool{  server 192.168.5.21 weight=10;   server 192.168.5.22 weight=10;   </p>
<p>} </p>
</blockquote>
<p>3、<strong>ip_hash</strong> </p>
<p>每个请求按访问 ip 的 hash 结果分配，<strong>这样每个访客固定访问一个后端服务器</strong>，<strong>可以解决 session 的问题。 例如：</strong> （可以用来解决session共享的问题）</p>
<blockquote>
<p>upstream server_pool{  ip_hash;   server 192.168.5.21:80;   server 192.168.5.22:80;   } </p>
</blockquote>
<p>4、<strong>fair</strong>（第三方） </p>
<p><strong>按后端服务器的响应时间来分配请求</strong>，响应时间短的优先分配。 </p>
<blockquote>
<p> upstream  server_pool{  server 192.168.5.21:80;   server  192.168.5.22:80;   <img src="file:///C:/Users/losser/AppData/Local/Temp/msohtmlclip1/01/clip_image001.gif" alt="img">  fair;     }   </p>
</blockquote>
<h1 id="Nginx配置实例-动静分离"><a href="#Nginx配置实例-动静分离" class="headerlink" title="Nginx配置实例-动静分离"></a>Nginx配置实例-动静分离</h1><h2 id="什么是动静分离"><a href="#什么是动静分离" class="headerlink" title="什么是动静分离"></a>什么是动静分离</h2><p><code>Nginx</code> <strong>动静分离简单来说就是把动态跟静态请求分开</strong>，不能理解成只是单纯的把动态页面和静态页面物理分离。<strong>严格意义上说应该是动态请求跟静态请求分开，可以理解成使用Nginx 处理静态页面，Tomcat处理动态页面</strong>。动静分离从目前实现角度来讲大致分为两种，</p>
<p>一种是纯粹把静态文件独立成单独的域名，放在独立的服务器上，也是目前主流推崇的方案；另外一种方法就是动态跟静态文件混合在一起发布，通过 nginx 来分开。 </p>
<p>通过 location 指定不同的后缀名实现不同的请求转发。通过 expires 参数设置，可以使浏览器缓存过期时间，减少与服务器之前的请求和流量。具体 Expires 定义：是给一个资源设定一个过期时间，也就是说无需去服务端验证，直接通过浏览器自身确认是否过期即可，所以不会产生额外的流量。此种方法非常适合不经常变动的资源。（如果经常更新的文件，不建议使用 Expires 来缓存），我这里设置 3d，表示在这 3 天之内访问这个 URL，发送一个请求，比对服务器该文件最后更新时间没有变化，则不会从服务器抓取，返回状态码</p>
<p>304，如果有修改，则直接从服务器重新下载，返回状态码 200。 </p>
<h2 id="动静分离示意图"><a href="#动静分离示意图" class="headerlink" title="动静分离示意图"></a>动静分离示意图</h2><p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195141.png" alt="image-20220119161042681"></p>
<p>准备工作</p>
<p>1）在Linux系统中准备静态资源，用于进行访问</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195147.png" alt="image-20220119162157558"></p>
<p>2）具体配置</p>
<p>（1）在nginx配置文件中进行配置，这里面的autoindex on表示的是列出文件夹中的内容</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195149.png" alt="image-20220119163051587"></p>
<p>4）最终测试</p>
<p>（1）浏览器中输入地址</p>
<p><a target="_blank" rel="noopener" href="http://192.168.60.10/image/author.jpg">http://192.168.60.10/image/author.jpg</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195153.png" alt="image-20220119163417185"><img src="C:\Users\losser\AppData\Roaming\Typora\typora-user-images\image-20220119163426202.png" alt="image-20220119163426202"></p>
<p>也能访问</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195158.png" alt="image-20220119163658273"></p>
<h1 id="nginx的高可用"><a href="#nginx的高可用" class="headerlink" title="nginx的高可用"></a>nginx的高可用</h1><h2 id="什么是高可用"><a href="#什么是高可用" class="headerlink" title="什么是高可用"></a>什么是高可用</h2><p><strong>单点故障</strong>（英语：single point of failure，缩写SPOF）是指系统中一点失效，就会让整个系统无法运作的部件，换句话说，单点故障即会整体故障。</p>
<p><strong>高可用性</strong>（英语：high availability，缩写为 HA），IT术语，指系统无中断地执行其功能的能力，代表系统的可用性程度。是进行系统设计时的准则之一。高可用性系统与构成该系统的各个组件相比可以更长时间运行。<br><strong>高可用性通常通过提高系统的容错能力来实现。定义一个系统怎样才算具有高可用性往往需要根据每一个案例的具体情况来具体分析。</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195237.png" alt="image-20220119171907161"></p>
<p>（1）需要两台nginx服务器</p>
<p>（2）需要keeplived（用来检测nginx服务器是否还活着）</p>
<p>（3）需要虚拟IP</p>
<h2 id="配置高可用的准备工作"><a href="#配置高可用的准备工作" class="headerlink" title="配置高可用的准备工作"></a>配置高可用的准备工作</h2><ol>
<li>要有两个虚拟机的环境（我这里是直接用第一台进行克隆）</li>
</ol>
<p>​    一台是192.168.60.11</p>
<p>​    另一台是192.168.60.10</p>
<ol start="2">
<li>在两台服务器上安装nginx</li>
<li>在两台服务器上安装keeplived，使用yum命令进行安装</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">yum <span class="token function">install</span> -y keepalived
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>安装完成之后，keepalived的配置文件的位置/etc/keepalived</p>
<h2 id="完成高可用的配置（主从配置）"><a href="#完成高可用的配置（主从配置）" class="headerlink" title="完成高可用的配置（主从配置）"></a>完成高可用的配置（主从配置）</h2><p>（1）修改/etc/keepalived/keepalived.conf  的配置文件</p>
<pre><code>global_defs &#123;
    notification_email &#123;
        acassen@firewall.loc
        failover@firewall.loc
        sysadmin@firewall.loc
    &#125;
    notification_email_from Alexandre.Cassen@firewall.loc
    smtp_server 192.168.60.11
    smtp_connect_timeout 30
    router_id LVS_DEVEL  #访问主机
&#125;

vrrp_script chk_http_port &#123;
    script &quot;/usr/local/src/nginx_check.sh&quot;
    interval 2 #（检测脚本执行的间隔）
    weight -20   # 权重，如果当前的条件成立，就将当前的主机的权重降低20
&#125;

vrrp_instance VI_1 &#123;
    state BACKUP # 备份服务器上将 MASTER 改为 BACKUP
    interface ens33 //网卡名称
    virtual_router_id 51 # 主、备机的 virtual_router_id 必须相同
    priority 90 # 主、备机取不同的优先级，主机值较大，备份机值较小，值越大，优先级越高 
    advert_int 1 # 发送心跳，检测主备服务器是否还活着，这里是1秒
    authentication &#123; # 权限校验的方式用的是密码四个1
        auth_type PASS
        auth_pass 1111
    &#125;
    virtual_ipaddress &#123;
        192.168.60.50 // VRRP H 虚拟地址
    &#125;
&#125;
</code></pre>
<p>（2）在/usr/local/src下面添加检测nginx是否还活着的脚本nginx_check.sh</p>
<pre class="line-numbers language-sh"><code class="language-sh">#!/bin/bash
A=`ps -C nginx –no-header |wc -l`
if [ $A -eq 0 ];then
    /usr/local/nginx/sbin/nginx  #nginx启动脚本的位置
    sleep 2
    if [ `ps -C nginx --no-header |wc -l` -eq 0 ];then
        killall keepalived
    fi
fi
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>（3）把两台服务器上的nginx和keepalived启动</p>
<p>启动nginx：./nginx</p>
<p>启动keepalived：systemctl  start  keepalived.service</p>
<p>（5）最终测试</p>
<p>（1）在浏览器地址栏中输入虚拟的IP地址192.168.60.50，说明虚拟IP绑定是正确的</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195241.png" alt="image-20220119230324269"></p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195244.png" alt="image-20220119230207848"></p>
<p>（2）把主服务器（192.168.60.10）的nginx和keepalived停止，发现ngin已经切换到了备份服务器上，而且浏览器访问，还是有nginx（因为当主服务器挂掉之后，keepalived通过脚本检测到备份服务器还活着，就切换到备份服务器）</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195247.png" alt="image-20220120185354530"></p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195249.png" alt="image-20220120185437883"></p>
<h2 id="nginx的原理解析"><a href="#nginx的原理解析" class="headerlink" title="nginx的原理解析"></a>nginx的原理解析</h2><h3 id="master和worker"><a href="#master和worker" class="headerlink" title="master和worker"></a>master和worker</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> nginx
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="C:\Users\losser\AppData\Roaming\Typora\typora-user-images\image-20220120191125667.png" alt="image-20220120191125667"></p>
<p>这个master相当于是一个领导，一般不做具体的工作，一般是用来分配任务。master分配任务给手下的worker，worker去做具体的事情</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195253.png" alt="image-20220120191813067"></p>
<h3 id="worker是如何进行工作的"><a href="#worker是如何进行工作的" class="headerlink" title="worker是如何进行工作的"></a>worker是如何进行工作的</h3><p>worker是使用争抢的机制，抢到一个任务，就调用tomcat或者反向代理完成具体操作操作。</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195255.png" alt="image-20220120191803483"></p>
<h3 id="一个master和多个worker的好处"><a href="#一个master和多个worker的好处" class="headerlink" title="一个master和多个worker的好处"></a>一个master和多个worker的好处</h3><ol>
<li>可以使用nginx -s reload 热部署的方式，利于nginx进行热部署操作</li>
<li>每个worker是一个<strong>独立的进程</strong>，如果说有其中的一个worker出现问题，那其他的worker独立的，继续进行争抢，实现请求过程，不会造成服务的中断。</li>
</ol>
<blockquote>
<p>首先，对于每个 worker 进程来说，独立的进程，不需要加锁，所以省掉了锁带来的开销，同时在编程以及问题查找时，也会方便很多。其次，采用独立的进程，可以让互相之间不会影响，一个进程退出后，其它进程还在工作，服务不会中断，master 进程则很快启动新的 worker 进程。当然，worker 进程的异常退出，肯定是程序有 bug 了，异常退出，会导致当前 worker 上的所有请求失败，不过不会影响到所有请求，所以降低了风险。需要设置多少个 <strong>worker</strong> </p>
<p>Nginx 同 redis 类似都采用了 <strong>io 多路复用机制</strong>，每个 worker 都是一个独立的进程，但每个进程里只有一个主线程，通过异步非阻塞的方式来处理请求， 即使是千上万个请求也不在话下。每个 worker 的线程可以把一个 cpu 的性能发挥到极致。<strong>所以 worker 数和服务器的 cpu 数相等是最为适宜的。</strong>设少了会浪费 cpu，设多了会造成 cpu 频繁切换上下文带来的损耗。 </p>
</blockquote>
<h3 id="一些参数设置"><a href="#一些参数设置" class="headerlink" title="一些参数设置"></a>一些参数设置</h3><blockquote>
<p>设置worker的数量和cpu的数量相等是最为适宜的</p>
</blockquote>
<blockquote>
<p>连接数worker connection</p>
<p>第一个：发送请求，占用了worker的几个连接数</p>
<p>2个或者4个</p>
</blockquote>
<p>连接数：</p>
<blockquote>
<p>连接数 <strong>worker_connection</strong> </p>
<p>这个值是表示每个 worker 进程所能建立连接的最大值，所以，一个 nginx 能建立的最大连接数，应该是 worker_connections * worker_processes。当然，这里说的是最大连接数，对于 HTTP 请求本地资源来说，能够支持的最大并发数量是 worker_connections * worker_processes，如果是支持 http1.1 的浏览器每次访问要占两个连接，所以普通的静态访问最大并发数是： worker_connections * worker_processes /2，而如果是 HTTP 作 为反向代理来说，最大并发数量应该是 worker_connections * worker_processes/4。因为作为反向代理服务器，每个并发会建立与客户端的连接和与后端服务的连接，会占用两个连接。</p>
</blockquote>
<p>如果是静态资源的话就是两个连接数</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195258.png" alt="image-20220120193446745">，</p>
<p>如果是要访问tomcat就是四个连接数</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195302.png" alt="image-20220120193702496"></p>
<p>第二个: nginx,有一个master，有四个woker，每个woker支持最大的连接数据1024，支持的最大并发数是多少？        (1024*4)/2（<strong>静态访问</strong>）        或者      （1024*4)/4  （<strong>作为反向代理</strong>）</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220120195302.png" alt="image-20220120194458610"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://losserlong.github.io/2022/01/19/linux%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="Xiang">
      <meta itemprop="description" content="今日长缨在手，何时缚住苍龙？">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/19/linux%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">linux基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-19 17:59:52" itemprop="dateCreated datePublished" datetime="2022-01-19T17:59:52+08:00">2022-01-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-20 09:46:39" itemprop="dateModified" datetime="2022-01-20T09:46:39+08:00">2022-01-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
                </span>
			  <span>℃</span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="vim和vi的基本介绍"><a href="#vim和vi的基本介绍" class="headerlink" title="vim和vi的基本介绍"></a>vim和vi的基本介绍</h1><p>所有的 Linux 系统都会内建 vi 文本编辑器。 Vim 具有程序编辑的能力，可以看做是Vi的增强版本，可以主动的以字体颜色辨别 语法的正确性，方便程序设计。代码补完、编译及错误跳转等方便编程的功能特别 丰富，在程序员中被广泛使用。</p>
<h2 id="vim和vi的常用的三种模式"><a href="#vim和vi的常用的三种模式" class="headerlink" title="vim和vi的常用的三种模式"></a>vim和vi的常用的三种模式</h2><p><strong>正常模式：</strong></p>
<ul>
<li>以 vim 打开一个档案就直接进入一般模式了(这是默认的模式)。在这个模式中， 你可以使用 『上下左右』按键来移动光标，你可以使用『删除字符』或『删除整行』来处理档案内容， 也可以使用『复制、贴上』来处理你的文件数据。</li>
</ul>
<p><strong>插入模式：</strong></p>
<ul>
<li>按下i, I, o, O, a, A, r, R等任何一个字母之后才会进入编辑模式, 一般来说按i即可</li>
</ul>
<p><strong>命令行模式：</strong></p>
<ul>
<li>在这个模式当中， 可以提供你相关指令，完成读取、存盘、替换、离开 vim 、显示行号等的 动作则是在此模式中达成的！</li>
</ul>
<p>vi和vim的基本使用</p>
<pre class="line-numbers language-txt"><code class="language-txt">使用vim Hello.java 对Hello.java进行编辑
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="vim和vi模式的相互切换"><a href="#vim和vi模式的相互切换" class="headerlink" title="vim和vi模式的相互切换"></a>vim和vi模式的相互切换</h2><p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210522201350810.png" alt="image-20210522201350810"></p>
<h3 id="强制退出vim编辑器"><a href="#强制退出vim编辑器" class="headerlink" title="强制退出vim编辑器"></a>强制退出vim编辑器</h3><pre class="line-numbers language-bash"><code class="language-bash">在插入模式下，先按esc，然后再按下:q<span class="token operator">!</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="vim和vi快捷键的使用"><a href="#vim和vi快捷键的使用" class="headerlink" title="vim和vi快捷键的使用"></a>vim和vi快捷键的使用</h2><p><strong>快捷键练习使用</strong>：</p>
<ul>
<li><ol>
<li><font color='red'><strong>拷贝</strong></font>当前行 yy , 拷贝当前行向下的5行 5yy，并粘贴。</li>
</ol>
</li>
<li><ol start="2">
<li>**<font color='red'>删除</font>**当前行 dd , 删除当前行向下的5行 5dd *</li>
</ol>
</li>
<li><ol start="3">
<li>在文件中查找某个单词 [命令行下 /关键字 ， 回车 查找 , 输入 n 就是查找下一个 ] </li>
</ol>
</li>
<li><ol start="4">
<li>设置文件的行号，取消文件的行号.[命令行下 : set nu 和 :set nonu]</li>
</ol>
</li>
<li><ol start="5">
<li>编辑 /etc/profile 文件，使用快捷键到底文档的最末行[G]和最首行[gg] </li>
</ol>
</li>
<li><ol start="6">
<li>在一个文件中输入 “hello” ,然后又撤销这个动作 u </li>
</ol>
</li>
<li><ol start="7">
<li>编辑 /etc/profile 文件，并将光标移动到 20行 shift+g </li>
</ol>
</li>
<li><ol start="8">
<li>更多的看整理的文档</li>
</ol>
</li>
</ul>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20191219104939654.jpg" alt="20191219104939654"></p>
<h1 id="基本的指令"><a href="#基本的指令" class="headerlink" title="基本的指令"></a>基本的指令</h1><h2 id="关机-amp-重启命令"><a href="#关机-amp-重启命令" class="headerlink" title="关机&amp;重启命令"></a>关机&amp;重启命令</h2><p>基本介绍</p>
<p>shutdown  -h  now          立即进行关机</p>
<p>shutdown  -h   1                “hello,一分钟之后关机”</p>
<p>shutdown  -r    now           现在重启计算机</p>
<p>halt                                     关机，作用和上面一样<font color='red'> (CentOS6)</font></p>
<p>reboot                                现在重新启动计算机</p>
<p>sync                                    把内存的数据同步到磁盘中</p>
<p>poweroff也是关机指令</p>
<p><strong>注意细节</strong></p>
<p>不管是重启系统还是关闭系统，首先要运行sync命，把内存中的数据写到磁盘中</p>
<h2 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h2><p>基本介绍: 1) 登录时尽量少用root帐号登录，因为它是系统管理员，最大的权限，避免操作失误。可 以利用普通用户登录，登录后再用”su - 用户名’命令来切换成系统管理员身份. 2) 在提示符下输入 logout 即可注销用户</p>
<p><strong>在命令行里注销用户</strong></p>
<p>直接输入logout（使用细节：logout注销指令在图形界面运行级别无效，在运行级别3有效）</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210521112912370.png" alt="image-20210521112912370"></p>
<h2 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h2><p><strong>基本语法</strong></p>
<p>useradd [选项]   用户名</p>
<p>cd   表示change directory，是切换目录</p>
<p><strong>应用案例</strong></p>
<p>1）添加一个用户xiaoming</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210521114644804.png" alt="image-20210521114644804"></p>
<p><strong>细节说明</strong></p>
<p>1）当创建用户成功后，会自动的创建和用户同名的家目录</p>
<p>2）也可以通过useradd -d指定目录    新的用户名，给新创建的用户指定家目录</p>
<h3 id="修改-指定密码（在工作中密码必须复杂）"><a href="#修改-指定密码（在工作中密码必须复杂）" class="headerlink" title="修改/指定密码（在工作中密码必须复杂）"></a>修改/指定密码（在工作中密码必须复杂）</h3><p>指定密码</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">passwd</span> 用户名
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210522095342857.png" alt="image-20210522095342857"></p>
<p>修改密码</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210522095537757.png" alt="image-20210522095537757"></p>
<h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><p><strong>基本语法</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">userdel</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> 用户名  选项：-r 表示删除的同时，将其家目录也一同删除了
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>引用案例</p>
<p>1）删除用户xm，但是要保留家目录</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210522100131970.png" alt="image-20210522100131970"></p>
<p>2）删除用户xh以及用户主目录 </p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210522100617709.png" alt="image-20210522100617709"></p>
<p><strong>细节</strong>：在删除用户时，我们一般不删除家目录</p>
<h2 id="查询用户信息"><a href="#查询用户信息" class="headerlink" title="查询用户信息"></a>查询用户信息</h2><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a><strong>基本语法</strong></h3><p>id 用户名</p>
<p>应用示例：查询root用户信息</p>
<p>如果用户不存在，则返回无此用户</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210522101318669.png" alt="image-20210522101318669"></p>
<h3 id="切换用户"><a href="#切换用户" class="headerlink" title="切换用户"></a>切换用户</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">su</span>   -  切换用户名
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>应用实例</strong></p>
<p>1）创建一个用户zf，指定密码，然后切换到zf</p>
<p> <img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210522101645802.png" alt="image-20210522101645802"></p>
<p>从普通用户切换回root用户两种方式</p>
<p>1）</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210522101841615.png" alt="image-20210522101841615"></p>
<p>2）<img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210522101909970.png" alt="image-20210522101909970"></p>
<p><strong>细节说明</strong></p>
<p>1）从权限高的用户切换到权限低的用户，不需要输入密码，繁殖需要。</p>
<p>2）当需要返回到用户时，使用<strong>exit</strong>指令</p>
<h3 id="查看当前用户-登录用户"><a href="#查看当前用户-登录用户" class="headerlink" title="查看当前用户/登录用户"></a>查看当前用户/登录用户</h3><ul>
<li>基本语法</li>
</ul>
<p>whoami  /   who  am  I</p>
<h3 id="用户组"><a href="#用户组" class="headerlink" title="用户组"></a>用户组</h3><p>介绍：类似于角色，系统可以对共性的多个用户进行统一的管理。</p>
<h4 id="增加组"><a href="#增加组" class="headerlink" title="增加组"></a>增加组</h4><p> groupadd  组名</p>
<p><strong>案例演示</strong>（创建一个组）</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210522104425849.png" alt="image-20210522104425849"></p>
<h4 id="删除组"><a href="#删除组" class="headerlink" title="删除组"></a>删除组</h4><p>指令（基本语法）</p>
<p>groupdel  组名</p>
<p><strong>案例演示</strong></p>
<p>增加用户时直接加上组</p>
<ul>
<li><p>指令（基本语法)</p>
<p>useradd -g 用户组   用户名</p>
<p>案例演示</p>
<p>增加一个用户zwj，直接将zwj指定到wudang</p>
<p>步骤如下演示</p>
</li>
</ul>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210522105120132.png" alt="image-20210522105120132"></p>
<h4 id="修改用户组"><a href="#修改用户组" class="headerlink" title="修改用户组"></a>修改用户组</h4><p>指令（基本语法）</p>
<p>usermod    -g   用户组（新的用户组）  用户名</p>
<p><strong>案例演示</strong></p>
<p>创建一个shaolin组，将zwj修改到shaolin</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210522105739973.png" alt="image-20210522105739973"></p>
<h2 id="解释指令man"><a href="#解释指令man" class="headerlink" title="解释指令man"></a>解释指令man</h2><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">man</span> + 指令  表示的是查看这个指令的用法以及意思
有问题问男人
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="Linux实操篇-实用指令"><a href="#Linux实操篇-实用指令" class="headerlink" title="Linux实操篇   实用指令"></a>Linux实操篇   实用指令</h1><h2 id="指定运行级别（七个级别）"><a href="#指定运行级别（七个级别）" class="headerlink" title="指定运行级别（七个级别）"></a>指定运行级别（七个级别）</h2><h3 id="运行级别的示意图（centos6）"><a href="#运行级别的示意图（centos6）" class="headerlink" title="运行级别的示意图（centos6）"></a>运行级别的示意图（centos6）</h3><p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210522204033286.png" alt="image-20210522204033286"></p>
<h2 id="切换到指定运行级别的指令"><a href="#切换到指定运行级别的指令" class="headerlink" title="切换到指定运行级别的指令"></a>切换到指定运行级别的指令</h2><h3 id="基本语法-1"><a href="#基本语法-1" class="headerlink" title="基本语法"></a>基本语法</h3><p>init[0123456]</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210522204639476.png" alt="image-20210522204639476"></p>
<h3 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例1：通过init来切换不同的运行级别，比如从5—–&gt;3，然后关机</p>
<p>init   3</p>
<p>init   5</p>
<p>init   0</p>
<h3 id="指定运行级别"><a href="#指定运行级别" class="headerlink" title="指定运行级别"></a>指定运行级别</h3><ul>
<li><strong>面试题</strong></li>
</ul>
<p>如何找回root密码，如果不小心忘记了root密码，怎么找回？</p>
<p>思路:进入到单用户模式，然后修改root密码。因为进入单用户模式，root不需要密码就可以登录。 </p>
<p>演示</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210523091441667.png" alt="image-20210523091441667"></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210523092131294.png" alt="image-20210523092131294">    </p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210523091556602.png" alt="image-20210523091556602"></p>
<p>开机  —&gt;在引导时输入  回车键   —–&gt;看到一个界面输入  e   —-&gt;看到一个新的界面，选中第二行（编辑内核）</p>
<p>再输入   e  —-&gt;在这一行的最后输入  1 ，再输入回车键 —–&gt;再次输入b，这时就进入了单用户模式 再用paswd root进行更改密码（上面的图片没有截完整）</p>
<p>2）请设置我们的运行级别，Linux运行后，直接进入到命令行界面，即进入到3运行级别vim  /etc/inittab</p>
<p>将id：initdefault：这一行中的数字，5这个数改成3即可</p>
<h2 id="centos7运行级别"><a href="#centos7运行级别" class="headerlink" title="centos7运行级别"></a>centos7运行级别</h2><h3 id="进入不同运行级别的方式"><a href="#进入不同运行级别的方式" class="headerlink" title="进入不同运行级别的方式"></a>进入不同运行级别的方式</h3><pre class="line-numbers language-bash"><code class="language-bash">init 0   <span class="token comment" spellcheck="true">#关机</span>
init 3   <span class="token comment" spellcheck="true">#进入3级别字符界面</span>
init 5   <span class="token comment" spellcheck="true">#进入5级别图形界面</span>
init 6   <span class="token comment" spellcheck="true">#重启</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="设置系统默认的运行级别"><a href="#设置系统默认的运行级别" class="headerlink" title="设置系统默认的运行级别"></a>设置系统默认的运行级别</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#设置默认第三启动级别</span>
<span class="token punctuation">[</span>root@node5 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl set-default multi-user.target</span>

<span class="token comment" spellcheck="true">#设置默认第五启动级别</span>
<span class="token punctuation">[</span>root@node5 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl set-default graphical.target</span>
<span class="token punctuation">[</span>root@node5 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># runlevel</span>
3 5   <span class="token comment" spellcheck="true">#表示从3级别切换到了5级别</span>

<span class="token comment" spellcheck="true">#查看当前默认的启动级别</span>
<span class="token punctuation">[</span>root@node5 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl get-default</span>
graphical.target

<span class="token punctuation">[</span>root@node5 ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># systemctl get-default</span>
multi-user.target
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="帮助指令"><a href="#帮助指令" class="headerlink" title="帮助指令"></a>帮助指令</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>当我们对某个指令不熟悉时，我们可以使用Linux提供的帮助指令来了解指令的使用方法。</p>
<h3 id="man基本语法"><a href="#man基本语法" class="headerlink" title="man基本语法"></a>man基本语法</h3><ul>
<li>man[命令或配置文件]（功能描述：获得帮助信息）</li>
</ul>
<h3 id="应用实例-1"><a href="#应用实例-1" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例：查看ls命令的帮助信息</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210524090540904.png" alt="image-20210524090540904"></p>
<p>help指令</p>
<ul>
<li><p>基本语法</p>
</li>
<li><p>help  命令（功能描述，获得shell内置命令的帮助信息）</p>
</li>
<li><p>应用实例</p>
<p>​        案例：查看cd命令的帮助信息</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210524091140179.png" alt="image-20210524091140179"></p>
</li>
</ul>
<h1 id="文件目录类"><a href="#文件目录类" class="headerlink" title="文件目录类"></a>文件目录类</h1><h2 id="目录结构的基本介绍"><a href="#目录结构的基本介绍" class="headerlink" title="目录结构的基本介绍"></a>目录结构的基本介绍</h2><p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210524180130847.png" alt=" "></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/d0c50-linux2bfile2bsystem2bhierarchy.jpg" alt="d0c50-linux2bfile2bsystem2bhierarchy"></p>
<h2 id="pwd指令"><a href="#pwd指令" class="headerlink" title="pwd指令"></a>pwd指令</h2><h3 id="基本语法-2"><a href="#基本语法-2" class="headerlink" title="基本语法"></a>基本语法</h3><p>pwd（功能描述：显示当前工作目录的绝对路径）</p>
<h3 id="应用案例"><a href="#应用案例" class="headerlink" title="应用案例"></a>应用案例</h3><ul>
<li>案例：显示当前工作目录的绝对路径</li>
</ul>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210524180318080.png" alt="image-20210524180318080"></p>
<h2 id="ls指令"><a href="#ls指令" class="headerlink" title="ls指令"></a>ls指令</h2><h3 id="基本语法-3"><a href="#基本语法-3" class="headerlink" title="基本语法"></a>基本语法</h3><pre><code>     ls  [选项]   [目录或是文件]
</code></pre>
<h3 id="常用选项"><a href="#常用选项" class="headerlink" title="常用选项"></a>常用选项</h3><p>​        -a   ：显示当前目录所有的文件和目录，<strong>包括隐藏的</strong>。</p>
<p>​        -l    ：以列表的方式显示信息</p>
<h3 id="应用实例-2"><a href="#应用实例-2" class="headerlink" title="应用实例"></a>应用实例</h3><p>​        案例：查看当前目录所有内容信息</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210524181654591.png" alt="image-20210524181654591"></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/image-20210524181749175.png" alt="image-20210524181749175"></p>
<h2 id="cd指令"><a href="#cd指令" class="headerlink" title="cd指令"></a>cd指令</h2><h3 id="基本语法-4"><a href="#基本语法-4" class="headerlink" title="基本语法"></a>基本语法</h3><ul>
<li>cd    [参数]            （功能描述：切换到指定目录）</li>
</ul>
<h3 id="绝对和相对路径"><a href="#绝对和相对路径" class="headerlink" title="绝对和相对路径"></a><strong>绝对和相对路径</strong></h3><p>重点是脑海中要有一个目录树</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210525083657.png" alt="image-20210525083654467"></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> ~ 或者cd：  回到自己的家目录<span class="token punctuation">(</span>home目录<span class="token punctuation">)</span>
<span class="token function">cd</span> <span class="token punctuation">..</span>回到当前目录的上一级目录  
<span class="token function">cd</span> <span class="token keyword">.</span> 代表的是当前路径
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>思考题：</strong></p>
<p>1）当前工作目录是/root，我们希望进入到/home下</p>
<p><strong><font color='red'>绝对路径：</font></strong>/home，即从<font color='orange'>根目录</font>开始定位。</p>
<p>**<font color='red'>相对路径</font>**：. ./home（. .代表回到上级目录，然后再去找到home目录，<font color='orange'>从当前工作目录</font>开始定位到需要的目录去）</p>
<h3 id="应用实例-3"><a href="#应用实例-3" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例1：使用绝对路径切换到root目录</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> /root
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>案例2：使用相对路径切换到/root目录</p>
<p>这里我们要知道该用户目前在哪个目录下，才能写出这个指令，假设在/usr/lib</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/root
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><font size=4px color='red'>非常重要：. .</font>代表的是上级目录(在<font color='orange'>相对路径</font>中)</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> <span class="token punctuation">..</span>/home    
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>案例3：表示回到当前目录的上一级目录</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> <span class="token punctuation">..</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>案例4：回到家目录</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span>
<span class="token function">cd</span> ~
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210525083529.png" alt="image-20210525083526253"></p>
<h2 id="mkdir指令"><a href="#mkdir指令" class="headerlink" title="mkdir指令"></a>mkdir指令</h2><ul>
<li>mkdir指令用于创建目录（make directory）</li>
</ul>
<h3 id="基本语法-5"><a href="#基本语法-5" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span>  要创建的目录
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><h4 id="一次性创建单个目录"><a href="#一次性创建单个目录" class="headerlink" title="一次性创建单个目录"></a>一次性创建单个目录</h4><p>在home目录下创建pig目录</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210525084517.png" alt="image-20210525084515832"></p>
<h4 id="一次性创建多级目录"><a href="#一次性创建多级目录" class="headerlink" title="一次性创建多级目录"></a>一次性创建多级目录</h4><p>在home目录下同时创建animal，同时创建tiger，记住<font color='red'>创建多级目录</font>要带上<font color='orange'>-p这个选项</font></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210525084736.png" alt="image-20210525084731183"></p>
<h2 id="rmdir指令"><a href="#rmdir指令" class="headerlink" title="rmdir指令"></a>rmdir指令</h2><h3 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">rmdir</span> 指令删除空目录
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="应用实例-4"><a href="#应用实例-4" class="headerlink" title="应用实例"></a>应用实例</h3><ul>
<li>案例一：删除一个目录 /home/pig</li>
<li><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210525103102.png" alt="image-20210525103052767"></li>
</ul>
<h3 id="使用细节"><a href="#使用细节" class="headerlink" title="使用细节"></a><font color='red'>使用细节</font></h3><p>rmdir删除的是空目录，如果目录下有内容时无法删除。</p>
<p><font color='red'>提示</font>：如果需要删除的非空目录，如要使用<font size=25px color='red'>rm  -rf</font>要删除的目录</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210525164146.png" alt="image-20210525164144426"></p>
<h2 id="touch指令"><a href="#touch指令" class="headerlink" title="touch指令"></a>touch指令</h2><h3 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h3><ul>
<li>touch指令创建空文件</li>
</ul>
<h3 id="基本语法-6"><a href="#基本语法-6" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">touch</span>   文件名称<span class="token punctuation">(</span>后面可以接多个文件名，用于创建多个文件<span class="token punctuation">)</span>    
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="应用实例-5"><a href="#应用实例-5" class="headerlink" title="应用实例"></a>应用实例</h3><ul>
<li>案例一：创建一个空的hello.txt</li>
</ul>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210525164658.png" alt="image-20210525164656803"></p>
<ul>
<li>案例二：创建多个文件夹</li>
</ul>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210525164955.png" alt="image-20210525164953364"></p>
<h2 id="cp指令（重要）"><a href="#cp指令（重要）" class="headerlink" title="cp指令（重要）"></a>cp指令（重要）</h2><h3 id="介绍-3"><a href="#介绍-3" class="headerlink" title="介绍"></a>介绍</h3><ul>
<li>cp指令拷贝文件到指定目录(cp就是copy)</li>
</ul>
<h3 id="基本语法-7"><a href="#基本语法-7" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cp</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> <span class="token function">source</span> dest    （source就是源文件的位置，dest就是要拷贝的目标文件的位置）
常用选项
-r：递归复制整个文件夹
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="应用实例-6"><a href="#应用实例-6" class="headerlink" title="应用实例"></a>应用实例</h3><ul>
<li><p>案例一：将/home/aaa.txt拷贝到/home/bbb目录下面</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210525170528.png" alt="image-20210525170523307"></p>
</li>
<li><p>案例二：递归复制整个文件夹，举例</p>
</li>
</ul>
<p>将/home/test<font size=5px color='red'>整个目录拷贝</font>到/home/zwj目录(用<font color='orange'>-r</font>表示递归复制)</p>
<p> <img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528175624.png" alt="image-20210525171619686"></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210729104257.png" alt="image-20210729104248532"></p>
<h3 id="使用细节-1"><a href="#使用细节-1" class="headerlink" title="使用细节"></a>使用细节</h3><ul>
<li>强制复制不提示方法：\cp</li>
</ul>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210526173714.png" alt="image-20210526173712937"></p>
<p><strong>技术小技巧</strong></p>
<p>可以通过 上下箭头键，调出原来使用过的指令。</p>
<h2 id="rm指令"><a href="#rm指令" class="headerlink" title="rm指令"></a>rm指令</h2><h3 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>rm指令移除文件或目录</p>
<h3 id="基本语法-8"><a href="#基本语法-8" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">rm</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> 要删除的文件或目录
常用选项
-r：递归删除整个文件夹
-f：强制删除不提示
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="应用实例-7"><a href="#应用实例-7" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：将/home/aaa.txt删除</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210526173806.png" alt="image-20210526173805144"></p>
<p>案例二：递归删除整个文件夹/home/bbb</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210526173817.png" alt="image-20210526173816579"></p>
<ul>
<li><font color='red'>使用细节</font></li>
</ul>
<p><font color='red'>强制删除</font>不提示的方法：<font color='orange'>带上-f参数</font>即可</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210526173826.png" alt="image-20210526173824951"></p>
<h2 id="mv指令"><a href="#mv指令" class="headerlink" title="mv指令"></a>mv指令</h2><h3 id="基本介绍-1"><a href="#基本介绍-1" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>mv移动文件与目录或重命名（move）</p>
<h3 id="基本语法-9"><a href="#基本语法-9" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">mv</span> oldNameFile newNameFile   <span class="token punctuation">(</span>功能描述：重命名<span class="token punctuation">)</span>可以理解为，把当前文件夹下的oldNameFile，移动到当前目录下面，发现已经有了，就是重名了
mv/temp/movefile/targetFolder  <span class="token punctuation">(</span>功能描述，移动文件<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="应用实例-8"><a href="#应用实例-8" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：将    /home/aaa.txt文件  重新命名为pig.txt</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210526173837.png" alt="image-20210526173836313"></p>
<p>案例二：将/home/pig.txt文件移动到 /root目录下</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210526173846.png" alt="image-20210526173845362"></p>
<h2 id="cat指令"><a href="#cat指令" class="headerlink" title="cat指令"></a>cat指令</h2><h3 id="基本介绍-2"><a href="#基本介绍-2" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>cat 查看文件内容，是以<font color='red'>只读的方式打开</font></p>
<h3 id="基本语法-10"><a href="#基本语法-10" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cat</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span>  要查看的文件    
常用选项
-n  <span class="token keyword">:</span>   显示行号
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="应用实例-9"><a href="#应用实例-9" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：/etc /profile   文件内容，并显示行号</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210526213648.png" alt="image-20210526213646596"></p>
<h3 id="使用细节-2"><a href="#使用细节-2" class="headerlink" title="使用细节"></a>使用细节</h3><p>cat<font color='red'>只能浏览文件</font>，而<font color='orange'>不能修改文件</font>，为了浏览方便，一般会带上  <font color='red'> 管道命令 | more</font></p>
<p>cat 文件名  | more[分页浏览]</p>
<h2 id="more指令"><a href="#more指令" class="headerlink" title="more指令"></a>more指令</h2><h3 id="基本介绍-3"><a href="#基本介绍-3" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>more指令是一个基于VI编辑器的文本过滤器，它以<font color='red'>全屏幕的方式按页显示文本文件的内容</font>。</p>
<p>more指令中内置了若干快捷键，详见操作说明。</p>
<h3 id="基本语法-11"><a href="#基本语法-11" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">more</span>    要查看的文件
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="操作说明"><a href="#操作说明" class="headerlink" title="操作说明"></a>操作说明</h3><table>
<thead>
<tr>
<th>操作</th>
<th>功能说明</th>
</tr>
</thead>
<tbody><tr>
<td>空白键（space）</td>
<td>代表向下翻页</td>
</tr>
<tr>
<td>Enter</td>
<td>代表向下翻[一行]</td>
</tr>
<tr>
<td>q</td>
<td>代表立刻离开more，不再显示文件内容</td>
</tr>
<tr>
<td>Ctrl+F</td>
<td>向下滚动一屏</td>
</tr>
<tr>
<td>Ctrl+B</td>
<td>返回上一屏</td>
</tr>
<tr>
<td>=</td>
<td>输出当前的行号</td>
</tr>
<tr>
<td>：f</td>
<td>输出文件名和当前行的行号</td>
</tr>
</tbody></table>
<h2 id="less指令"><a href="#less指令" class="headerlink" title="less指令"></a>less指令</h2><h3 id="基本介绍-4"><a href="#基本介绍-4" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>less指令用来<font color='red'>分屏查看文件的内容</font>，它的功能与more指令类似。但是比more指令更加强大，支持各种显示终端。less指令在显示文件内容时，<font color='red'>并不是将整个文件加载之后才显示</font>，而是根据现实需要加载内容，<font color='red'>对于显示大型文件具有较高的效率。</font></p>
<h3 id="基本语法-12"><a href="#基本语法-12" class="headerlink" title="基本语法"></a>基本语法</h3><p>less要查看的文件</p>
<h3 id="操作说明-1"><a href="#操作说明-1" class="headerlink" title="操作说明"></a>操作说明</h3><table>
<thead>
<tr>
<th>操作</th>
<th>功能说明</th>
</tr>
</thead>
<tbody><tr>
<td>空白键</td>
<td>向下翻动一页</td>
</tr>
<tr>
<td>[pagedown]</td>
<td>向下翻的一页</td>
</tr>
<tr>
<td>[pageup]</td>
<td>向上翻动一页</td>
</tr>
<tr>
<td>/字串</td>
<td>向下搜寻[字串]的功能：n：向下查找    N：向上查找</td>
</tr>
<tr>
<td>？字串</td>
<td>向上搜寻[字串]的功能：n：向上查找    N：向下查找</td>
</tr>
<tr>
<td>q</td>
<td>离开less这个程序</td>
</tr>
</tbody></table>
<h3 id="应用实例-10"><a href="#应用实例-10" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例：采用less查看一个大文件文件/opt/金庸-射雕英雄传txt精校本.txt</p>
<h2 id="gt-指令重定向和-gt-gt-指令追加"><a href="#gt-指令重定向和-gt-gt-指令追加" class="headerlink" title="&gt;指令重定向和&gt;&gt;指令追加"></a>&gt;指令重定向和&gt;&gt;指令追加</h2><h3 id="基本介绍-5"><a href="#基本介绍-5" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>&gt;输出<font color='red'>重定向</font>  和&gt;&gt;<font color='red'>追加</font>（追加到文件末尾）</p>
<p>输出重定向：会将原来的文件内容覆盖</p>
<p>追加：不会覆盖原来的文件的内容而是追加到文件的尾部</p>
<h3 id="基本语法-13"><a href="#基本语法-13" class="headerlink" title="基本语法"></a>基本语法</h3><blockquote>
<p>1）ls  -l &gt;  文件   （功能描述：列表内容写入到文件a.txt中（覆盖写））</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210527170609.png" alt="image-20210527170606573"></p>
</blockquote>
<blockquote>
<ol start="2">
<li>ls -al &gt;&gt;  文件   （功能描述：列表内容追加入到文件a.txt末尾）</li>
</ol>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210527171114.png" alt="image-20210527171112884"></p>
<p>说明：ls  -l  &gt; a.txt，将ls -l显示的内容覆盖写入到a.txt文件中，如果该文件不存在则创建该文件，反之，则覆盖 </p>
</blockquote>
<blockquote>
<ol start="3">
<li>cat   文件1&gt; 文件2   （功能描述：将文件1内容覆盖到文件2）</li>
</ol>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528104008.png" alt="image-20210528104007264"></p>
</blockquote>
<blockquote>
<p>4)echo  “内容”  &gt;&gt; 文件</p>
</blockquote>
<h3 id="应用实例-11"><a href="#应用实例-11" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：将/home目录下的文件列表写入到/home/info.txt中</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528104444.png" alt="image-20210528104442325"></p>
<p>案例二：将当前日历信息追加到/home/mycal文件中[提示cal]</p>
<p> <img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528104737.png" alt="image-20210528104736235"></p>
<h2 id="echo指令"><a href="#echo指令" class="headerlink" title="echo指令"></a>echo指令</h2><h3 id="基本内容"><a href="#基本内容" class="headerlink" title="基本内容"></a>基本内容</h3><p>echo输出内容到控制台</p>
<h3 id="基本语法-14"><a href="#基本语法-14" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">echo</span>  <span class="token punctuation">[</span>选项<span class="token punctuation">]</span>  <span class="token punctuation">[</span>输出内容<span class="token punctuation">]</span>    
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="应用实例-12"><a href="#应用实例-12" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例：使用echo指令输出环境变量 ，输出当前的环境的路径。</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528111840.png" alt="image-20210528111838308"></p>
<p>案例：使用echo指令输出hello，world！</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528111931.png" alt="image-20210528111930781"></p>
<h2 id="head指令"><a href="#head指令" class="headerlink" title="head指令"></a>head指令</h2><h3 id="基本说明"><a href="#基本说明" class="headerlink" title="基本说明"></a>基本说明</h3><p>head用于显示文件的开头部分，默认情况下head显示文件的前10行内容</p>
<h3 id="基本语法-15"><a href="#基本语法-15" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"> <span class="token function">head</span> 文件   <span class="token punctuation">(</span>功能描述：查看文件的头10行内容<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">head</span>  -n 5 文件    <span class="token punctuation">(</span>功能描述：查看文件的头5行内容，5可以是任意数<span class="token punctuation">)</span>    
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="应用实例-13"><a href="#应用实例-13" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例：查看    /etc/profile的前面5行代码</p>
<p>  <img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528123338.png" alt="image-20210528123336898"></p>
<h2 id="tail指令"><a href="#tail指令" class="headerlink" title="tail指令"></a>tail指令</h2><h3 id="基本介绍-6"><a href="#基本介绍-6" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>tail用于输出文件中末尾的内容，默认情况下tail显示文件的后10行内容。</p>
<h3 id="基本语法-16"><a href="#基本语法-16" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">tail</span>  文件       （功能描述：查看文件后10行内容）
<span class="token function">tail</span> -n 5 文件    （功能描述：查看文件的后5行内容，5可以是任意数）
<span class="token function">tail</span>  -f   文件    <span class="token punctuation">(</span>功能描述：实时追踪该文档的所有更新<span class="token punctuation">)</span>（工作中经常使用）

Ctrl+c退出追踪
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h3><p>案例一：查看/etc/profile最后5行的代码</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528124113.png" alt="image-20210528124112154"></p>
<p>案例二：实时监控mydate.txt，看看到文件有变化时，是否会看到，实时的追加日期</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528124520.png" alt="image-20210528124518287"></p>
<h2 id="ln指令（了解）"><a href="#ln指令（了解）" class="headerlink" title="ln指令（了解）"></a>ln指令（了解）</h2><h3 id="基本介绍-7"><a href="#基本介绍-7" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>软链接也叫符号链接，类似于<font color='red'>windows里面的快捷方式</font>，主要是存放了链接其他文件的路径</p>
<h3 id="基本语法-17"><a href="#基本语法-17" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">ln</span> -s <span class="token punctuation">[</span>源文件或目录<span class="token punctuation">]</span> <span class="token punctuation">[</span>软链接名<span class="token punctuation">]</span>  （功能描述：给源文件创建一个软连接）
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="应用实例-14"><a href="#应用实例-14" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例1：在/home目录下创建一个软链接linkToRoot，连接到/root目录</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528164522.png" alt="image-20210528164520885"></p>
<p>案例2：删除软链接linkToRoot</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528164927.png" alt="image-20210528164926717"></p>
<h3 id="细节说明"><a href="#细节说明" class="headerlink" title="细节说明"></a>细节说明</h3><p>当我们使用<font color='red'>pwd指令查看</font>目录时，仍然看到的是软链接所在目录。</p>
<h2 id="history指令"><a href="#history指令" class="headerlink" title="history指令"></a>history指令</h2><h3 id="基本介绍-8"><a href="#基本介绍-8" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>查看已经执行过的命令，也可以执行历史指令</p>
<h3 id="基本语法-18"><a href="#基本语法-18" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">history</span>  <span class="token punctuation">(</span>功能描述：查看已经执行过的历史命令<span class="token punctuation">)</span>
histroy  number    <span class="token punctuation">(</span>显示最近number条指令<span class="token punctuation">)</span>
！number     <span class="token punctuation">(</span>执行第number条指令<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="应用实例-15"><a href="#应用实例-15" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：显示所有的历史命令</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528165919.png" alt="image-20210528165918103"></p>
<p>案例二：显示最近使用的10个命令</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528170027.png" alt="image-20210528170026329"></p>
<p>案例三：执行历史编号为5的指令</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528170241.png" alt="image-20210528170240226"></p>
<h1 id="时间日期类相关的指令"><a href="#时间日期类相关的指令" class="headerlink" title="时间日期类相关的指令"></a>时间日期类相关的指令</h1><h2 id="date指令-显示当前日期"><a href="#date指令-显示当前日期" class="headerlink" title="date指令-显示当前日期"></a>date指令-显示当前日期</h2><h3 id="基本语法-19"><a href="#基本语法-19" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">date</span>                                <span class="token punctuation">(</span>功能描述：显示当前时间<span class="token punctuation">)</span>
<span class="token function">date</span> +%Y                            <span class="token punctuation">(</span>功能描述：显示当前年份<span class="token punctuation">)</span>
<span class="token function">date</span> +%m                            <span class="token punctuation">(</span>功能描述：显示当前月份<span class="token punctuation">)</span>
<span class="token function">date</span> +%d                            <span class="token punctuation">(</span>功能描述：显示当前是哪一天<span class="token punctuation">)</span>
<span class="token function">date</span> +<span class="token string">"%Y-%m-%d %H:%M:%s"</span>               <span class="token punctuation">(</span>功能描述：显示年月日时分秒<span class="token punctuation">)</span>
注意：这个+一定得加上
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="应用实例-16"><a href="#应用实例-16" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：显示当前时间信息</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528171924.png" alt="image-20210528171923814"></p>
<p>案例二：显示当前时间年月日</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528172058.png" alt="image-20210528172057231"></p>
<p>案例三：显示档期那时间年月日时分秒</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528172410.png" alt="image-20210528172409082"></p>
<h2 id="date指令-设置日期"><a href="#date指令-设置日期" class="headerlink" title="date指令-设置日期"></a>date指令-<font color='red'>设置日期</font></h2><h3 id="基本语法-20"><a href="#基本语法-20" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">date</span>  -s  字符串时间
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="应用实例-17"><a href="#应用实例-17" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：设置系统当前时间，比如设置成2021-5-28 11:22:22</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528172859.png" alt="image-20210528172858196"></p>
<h2 id="cal指令"><a href="#cal指令" class="headerlink" title="cal指令"></a>cal指令</h2><h3 id="基本介绍-9"><a href="#基本介绍-9" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>查看日历指令</p>
<h3 id="基本语法-21"><a href="#基本语法-21" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cal</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span>   <span class="token punctuation">(</span>功能描述：不加选项，显示本月日历<span class="token punctuation">)</span>  canlender的简写
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="应用实例-18"><a href="#应用实例-18" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：显示当前日历<br><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528173844.png" alt="image-20210528173842897"></p>
<p>案例二：显示2020年日历</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528174005.png" alt="image-20210528174004035"></p>
<h1 id="搜索查找类"><a href="#搜索查找类" class="headerlink" title="搜索查找类"></a>搜索查找类</h1><h2 id="find指令"><a href="#find指令" class="headerlink" title="find指令"></a>find指令</h2><h3 id="基本介绍-10"><a href="#基本介绍-10" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>find指令将从指定目录向下递归地遍历其各个子目录，将满足条件的<font color='red'>文件或者目录</font>显示在终端。</p>
<h3 id="基本语法-22"><a href="#基本语法-22" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">find</span> <span class="token punctuation">[</span>搜索范围<span class="token punctuation">]</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="选项说明"><a href="#选项说明" class="headerlink" title="选项说明"></a>选项说明</h3><table>
<thead>
<tr>
<th>选项</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>-name&lt;查询方式&gt;</td>
<td>按照指定的文件名查找模式查找文件</td>
</tr>
<tr>
<td>-user&lt;用户名&gt;</td>
<td>查找属于指定用户名地所有文件</td>
</tr>
<tr>
<td>-size&lt;文件大小&gt;</td>
<td>按照指定的文件大小查找文件</td>
</tr>
</tbody></table>
<h3 id="应用实例-19"><a href="#应用实例-19" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：按文件名：更具名称查找/home目录下的hello.txt文件</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528204923.png" alt="image-20210528204921939"></p>
<p>案例二：按拥有者：查找/opt目录下，用户名称为nobody的文件</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528205123.png" alt="image-20210528205122566"></p>
<p>案例三：查找整个linux系统下大于20M的文件（+n大于  -n小于  n等于，注意这里的<font color='red'>n表示的是数字</font>，单位可以根据实际情况来调整，k得用小写）</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528205548.png" alt="image-20210528205546326"></p>
<p>案例四：查询小于20M的文件</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528205935.png" alt="image-20210528205933051"></p>
<p>案例五：查询根目录下面以txt后缀结尾的文件</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210528210725.png" alt="image-20210528210722387"></p>
<h2 id="locate指令"><a href="#locate指令" class="headerlink" title="locate指令"></a>locate指令</h2><h3 id="基本介绍-11"><a href="#基本介绍-11" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>locate指令可以快速定位文件路径。locate指令利用实现建立的系统中所有文件名称以及路径的locate数据库实现快速定位给定的文件。locate指令无需遍历整个文件系统，查询速度较快。</p>
<h3 id="基本语法-23"><a href="#基本语法-23" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">locate</span>  搜索文件
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="特别说明"><a href="#特别说明" class="headerlink" title="特别说明"></a>特别说明</h3><p>由于locate指令基于数据进行查询，所以第一次运行前，必须使用updatedb指令创建locate数据库</p>
<h3 id="应用实例-20"><a href="#应用实例-20" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：请使用locate指令快速定位hello.txt文件所在目录</p>
<h2 id="grep指令和管道符号"><a href="#grep指令和管道符号" class="headerlink" title="grep指令和管道符号  |"></a>grep指令和管道符号 <font color='red'> |</font></h2><h3 id="基本介绍-12"><a href="#基本介绍-12" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>grep过滤查找，<font color='red'>管道符，”|”</font>，表示将前一个命令的处理结果输出传递给后面的命令处理。  （”|”,这后面的就是加上条件）</p>
<h3 id="基本语法-24"><a href="#基本语法-24" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">grep</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span>  查找内容  源文件
选项            功能
-n              显示匹配行以及行号。
-i              忽略字母大小写
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="应用实例-21"><a href="#应用实例-21" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：请在hello.txt文件中，查找”yes”所在行，并显示行号。</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210529085740.png" alt="image-20210529085731997"></p>
<h1 id="压缩和解压缩类"><a href="#压缩和解压缩类" class="headerlink" title="压缩和解压缩类"></a>压缩和解压缩类</h1><h2 id="gzip-gunzip-指令"><a href="#gzip-gunzip-指令" class="headerlink" title="gzip/gunzip  指令"></a>gzip/gunzip  指令</h2><h3 id="基本介绍-13"><a href="#基本介绍-13" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>gzip用于压缩文件，gunzip用于解压</p>
<h3 id="基本语法-25"><a href="#基本语法-25" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">gzip</span>     文件                   <span class="token punctuation">(</span>功能描述：压缩文件，只能将文件压缩为*.gz文件<span class="token punctuation">)</span>
gunzip   文件.gz              <span class="token punctuation">(</span>功能描述：解压缩文件命令<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="应用实例-22"><a href="#应用实例-22" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：gzip压缩，将/home下的hello.txt文件进行压缩</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210529090606.png" alt="image-20210529090605151"></p>
<p>案例二：gunzip压缩，将/home下的hello.txt.gz文件进行解压缩</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210529090744.png" alt="image-20210529090743083"></p>
<h3 id="细节说明-1"><a href="#细节说明-1" class="headerlink" title="细节说明"></a>细节说明</h3><p>当我们使用gzip对文件进行压缩后，不会保留原来的文件。    </p>
<h2 id="zip-unzip指令"><a href="#zip-unzip指令" class="headerlink" title="zip/unzip指令"></a>zip/unzip指令</h2><h3 id="基本介绍-14"><a href="#基本介绍-14" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>zip用于压缩文件，unzip用于解压文件，这个在<font color='red'>项目打包发布中很有用的</font></p>
<h3 id="基本语法-26"><a href="#基本语法-26" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">zip</span>   <span class="token punctuation">[</span>选项<span class="token punctuation">]</span>   XXX.zip     将要压缩的内容  <span class="token punctuation">(</span>功能描述：压缩文件和目录的命令<span class="token punctuation">)</span>
uzip  <span class="token punctuation">[</span>选项<span class="token punctuation">]</span>   XXX.zip    <span class="token punctuation">(</span>功能描述：解压文件<span class="token punctuation">)</span>    
zip常用选项
-r:  递归压缩，即压缩目录
uzip的常用选项
-d <span class="token operator">&lt;</span>目录<span class="token operator">></span> ：指定压缩后的文件的存放目录
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="应用实例-23"><a href="#应用实例-23" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：将/home下的所有文件压缩成mypackage.zip</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210529091849.png" alt="image-20210529091848159"></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210529091917.png" alt="image-20210529091915931"></p>
<p>案例二：将mypackage.zip解压到/opt/tmp目录下</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210529092115.png" alt="image-20210529092113961"></p>
<h2 id="tar指令"><a href="#tar指令" class="headerlink" title="tar指令"></a>tar指令</h2><h3 id="基本介绍-15"><a href="#基本介绍-15" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>tar指令是<strong>打包指令</strong>，最后打包后的文件是.tar.gz的文件。</p>
<h3 id="基本语法-27"><a href="#基本语法-27" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">tar</span>  <span class="token punctuation">[</span>选项<span class="token punctuation">]</span>  XXX.tar.gz   打包的内容    <span class="token punctuation">(</span>功能描述：打包目录，压缩后的文件格式.tar.gz<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>选项说明</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>-c</td>
<td>产生.tar打包文件</td>
</tr>
<tr>
<td>-v</td>
<td>显示详细信息</td>
</tr>
<tr>
<td>-f</td>
<td>指定压缩后的文件名</td>
</tr>
<tr>
<td>-z</td>
<td>打包时同时压缩</td>
</tr>
<tr>
<td>-x</td>
<td>解压.tar文件</td>
</tr>
</tbody></table>
<h3 id="应用实例-24"><a href="#应用实例-24" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：压缩多个文件，将/home/a1.txt和/home/a2.txt压缩成a.tar.gz</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210531170223.png" alt="image-20210531170214643"></p>
<p>案例二：将/home的文件夹压缩成myhome.tar.gz</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210531170512.png" alt="image-20210531170510021"></p>
<p>案例三：将a.tar.gz解压到当前目录</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210531171018.png" alt="image-20210531171017011"></p>
<p>案例四：将myhome.tar.gz解压到/opt/tmp2目录下</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210531171601.png" alt="image-20210531171600366"></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">tar</span> -zxvf 压缩包名字  -C 指定文件夹路径
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="组管理和权限管理（重难点）"><a href="#组管理和权限管理（重难点）" class="headerlink" title="组管理和权限管理（重难点）"></a>组管理和权限管理（重难点）</h1><h2 id="Linux组的基本介绍"><a href="#Linux组的基本介绍" class="headerlink" title="Linux组的基本介绍"></a>Linux组的基本介绍</h2><p>在Linux中的每个用户必须属于一个组，不能独立于组外。在Linux中每个文件有所有者、躲在组、其他组的概念。</p>
<p>1）所有组</p>
<p>2）所在组</p>
<p>3）其他组</p>
<p>4）改变用户所在组</p>
<h2 id="文件-目录所有者"><a href="#文件-目录所有者" class="headerlink" title="文件 / 目录所有者"></a>文件 / 目录所有者</h2><h3 id="基本介绍-16"><a href="#基本介绍-16" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>一般文件的创建者，设创建了该文件，就自然成为了该文件的所有者。</p>
<h3 id="查看文件的所有者"><a href="#查看文件的所有者" class="headerlink" title="查看文件的所有者"></a>查看文件的所有者</h3><pre class="line-numbers language-bash"><code class="language-bash">指令：    <span class="token function">ls</span>  -ahl
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="应用实例-25"><a href="#应用实例-25" class="headerlink" title="应用实例"></a>应用实例</h3><p>应用实例：  创建一个组police，再创建一个用户tom，然后使用tom来创建一个文件，看看情况如何</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210531190844.png" alt="image-20210531190841047"></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210531191140.png" alt="image-20210531191138777"></p>
<h3 id="修改文件所有者"><a href="#修改文件所有者" class="headerlink" title="修改文件所有者"></a>修改文件所有者</h3><pre class="line-numbers language-bash"><code class="language-bash">指令 ： <span class="token function">chown</span> 用户名  文件名   <span class="token punctuation">(</span>chown:就是change own<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="应用案例-1"><a href="#应用案例-1" class="headerlink" title="应用案例"></a>应用案例</h3><p>要求：使用root创建一个文件apple.txt，然后将所有者修改为tom</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210531191946.png" alt="image-20210531191945732"></p>
<h2 id="组的创建"><a href="#组的创建" class="headerlink" title="组的创建"></a>组的创建</h2><h3 id="基本指令"><a href="#基本指令" class="headerlink" title="基本指令"></a>基本指令</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">groupadd</span>   组名    
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="应用实例-26"><a href="#应用实例-26" class="headerlink" title="应用实例"></a>应用实例</h3><p>创建一个组，monster</p>
<p>创建一个用户fox，并放入到monster组中</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210531192445.png" alt="image-20210531192425168"></p>
<h2 id="文件-目录所在组"><a href="#文件-目录所在组" class="headerlink" title="文件/目录所在组"></a>文件/目录所在组</h2><p>当某个<font color='red'>用户创建了一个文件</font>后，<font color='red'>默认</font>这个<font color='red'>文件的所在组</font>就是该<font color='orange'>用户所在的组</font>。</p>
<h3 id="查看文件-目录所在组"><a href="#查看文件-目录所在组" class="headerlink" title="查看文件/目录所在组"></a>查看文件/目录所在组</h3><h4 id="基本指令-1"><a href="#基本指令-1" class="headerlink" title="基本指令"></a>基本指令</h4><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">ls</span> -ahl
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="应用实例-27"><a href="#应用实例-27" class="headerlink" title="应用实例"></a>应用实例</h4><h3 id="修改文件所在组"><a href="#修改文件所在组" class="headerlink" title="修改文件所在组"></a><font color='red'>修改文件</font>所在组</h3><h4 id="基本指令-2"><a href="#基本指令-2" class="headerlink" title="基本指令"></a>基本指令</h4><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">chgrp</span>  组名   文件名    <span class="token punctuation">(</span>chgrp   change group<span class="token punctuation">)</span>


linux下命令“ll”是“ls -l<span class="token string">"的别名。别名相当于windows里的快捷方式。

所以"</span>ll<span class="token string">"和“ls -l”的功能是相同的。
所以"</span>ll<span class="token string">"和"</span><span class="token function">ls</span><span class="token string">"的区别其实是“ls”和"</span><span class="token function">ls</span> -l"的区别。
”ls“是显示当前目录下文件，”ls -l“是显示当前目录下文件详细信息。
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="应用实例-28"><a href="#应用实例-28" class="headerlink" title="应用实例"></a>应用实例</h4><p>使用root用户创建文件orange.txt，看看当前文件属于哪个组，然后将这个文件所在的组修改到police组</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210605081758.png" alt="image-20210605081750518"></p>
<h2 id="其他组"><a href="#其他组" class="headerlink" title="其他组"></a>其他组</h2><p>出去文件的所有者和所在组的用户外，系统的其他用户都是文件的其他在。</p>
<h2 id="改变用户所在组"><a href="#改变用户所在组" class="headerlink" title="改变用户所在组"></a>改变用户所在组</h2><h3 id="基本介绍-17"><a href="#基本介绍-17" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>在添加用户时，可以指定将该用户添加到哪个组中，同样的用root的管理权限才可以改变某个用户所在的组。</p>
<h3 id="改变用户所在组指令"><a href="#改变用户所在组指令" class="headerlink" title="改变用户所在组指令"></a>改变用户所在组指令</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">usermod</span> -g   组名 用户名
<span class="token function">usermod</span> -d   目录名  用户名  改变该用户登陆的初始目录 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="应用实例-29"><a href="#应用实例-29" class="headerlink" title="应用实例"></a>应用实例</h3><p>创建一个土匪组（bandit）将tom这个用户从原来所在的police组，修改到bandit（土匪）组。 </p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210605083001.png" alt="image-20210605082959023">    </p>
<h2 id="权限的基本介绍"><a href="#权限的基本介绍" class="headerlink" title="权限的基本介绍"></a>权限的基本介绍</h2><h3 id="Linux的权限不是很细致，只有RWX三种"><a href="#Linux的权限不是很细致，只有RWX三种" class="headerlink" title="Linux的权限不是很细致，只有RWX三种"></a>Linux的权限不是很细致，只有<font color='red'>RWX</font>三种</h3><p><font color='red'>r(Read，读取)</font>：对文件而言，具有读取文件内容的权限；对目录来说，具有<font color='red'><strong>浏览</strong>目录</font>的权限。<br><font color='red'>w(Write,写入)</font>：对文件而言，具有<font color='red'>新增,修改,删除文件内容</font>的权限；对目录来说，具有<font color='red'>新建，删除，修改，移动目录</font>内文件的权限。<br><font color='red'>x(eXecute，执行)：</font>对文件而言，具有执行文件的权限；对目录了来说该<font color='red'>用户具有<strong>进入</strong>目录的权限。</font><br>1、目录的只读访问不允许使用cd进入目录，必须要有执行的权限才能进入。<br>2、只有执行权限只能进入目录，不能看到目录下的内容，要想看到目录下的文件名和目录名，需要可读权限。<br>3、一个文件能不能被删除，主要看该文件所在的目录对用户是否具有写权限，如果目录对用户没有写权限，则该目录下的所有文件都不能被删除，文件所有者除外<br>4、目录的w位不设置，即使你拥有目录中某文件的w权限也不能写该文件</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210608204827.jpg" alt="20181230195451513"></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210608205159.png" alt="image-20210608205158166"></p>
<h2 id="rwx权限详解"><a href="#rwx权限详解" class="headerlink" title="rwx权限详解"></a>rwx权限详解</h2><h3 id="rwx作用到文件"><a href="#rwx作用到文件" class="headerlink" title="rwx作用到文件"></a>rwx作用到<font color='red'>文件</font></h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>r<span class="token punctuation">]</span>代表可读<span class="token punctuation">(</span>read<span class="token punctuation">)</span>:可以读取，查看
<span class="token punctuation">[</span>w<span class="token punctuation">]</span>代表可写<span class="token punctuation">(</span>write<span class="token punctuation">)</span>:可以修改，但是不代表可以删除文件，删除文件的前提条件是对该文件所在的目录有写权限，才能删除该文件.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="rwx作用到目录"><a href="#rwx作用到目录" class="headerlink" title="rwx作用到目录"></a>rwx作用到<font color='red'>目录</font></h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>r<span class="token punctuation">]</span>代表可读<span class="token punctuation">(</span>read<span class="token punctuation">)</span>:可以读取，ls查看目录内容
<span class="token punctuation">[</span>w<span class="token punctuation">]</span>代表可写<span class="token punctuation">(</span>write<span class="token punctuation">)</span>:可以修改，目录内创建+删除+重命名目录
<span class="token punctuation">[</span>x<span class="token punctuation">]</span>代表可执行<span class="token punctuation">(</span>execute<span class="token punctuation">)</span>:可以进入该目录
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="文件及其目录权限实际案例"><a href="#文件及其目录权限实际案例" class="headerlink" title="文件及其目录权限实际案例"></a>文件及其目录权限实际案例</h3><p><strong>ls -l中显示的内容如下</strong>：</p>
<p>-rwx<font color='red'>rw-</font>r– 1 root root  1213  Feb  2  09 : 39  abc</p>
<p>10个字符确定不同用户能对文件干什么</p>
<p>第一个字符代表文件的类型：文件（-），目录（d），链接（l）</p>
<p>其余字符每3个一组（rwx）读（r）写（w）执行（x）</p>
<p>第一组rwx：文件拥有者同一组的用户权限是<font color='red'>读、写和执行</font></p>
<p>第二组<font color='red'>rw-</font>： 与文件拥有者同一组的用户的权限是<font color='red'>读、写但是不能执行</font></p>
<p>第三组r–：不与文件拥有者同组的其他用户的权限是<font color='red'>读不能写和执行</font></p>
<p><strong>可用数字表示为：</strong>r=4，w=2，x=1因此rwx=4+2+1=7  （用数字表示权限）</p>
<table>
<thead>
<tr>
<th>1</th>
<th>文件：硬链接数或目录：子目录数</th>
</tr>
</thead>
<tbody><tr>
<td>root</td>
<td>用户</td>
</tr>
<tr>
<td>root</td>
<td>组</td>
</tr>
<tr>
<td>1213</td>
<td>文件大小（字节），如果是文件夹，显示4096字节</td>
</tr>
<tr>
<td>Feb 2 09 : 39</td>
<td>最后修改时间</td>
</tr>
<tr>
<td>abc</td>
<td>文件名</td>
</tr>
</tbody></table>
<h2 id="修改权限-chmod（change-modify的意思）"><a href="#修改权限-chmod（change-modify的意思）" class="headerlink" title="修改权限 -chmod（change  modify的意思）"></a>修改权限<font color='red'> -chmod</font>（change  modify的意思）</h2><h3 id="基本说明-1"><a href="#基本说明-1" class="headerlink" title="基本说明"></a>基本说明</h3><p>通过chmod指令，可以修改文件或者目录的权限。</p>
<h3 id="第一种方式：-、-、-变更权限"><a href="#第一种方式：-、-、-变更权限" class="headerlink" title="第一种方式：+、-、=  变更权限"></a>第一种方式：+、-、=  变更权限</h3><pre class="line-numbers language-bash"><code class="language-bash">u：所有者   g：所有组   o:其他人   a：所有人（u、g、o的总和）
<span class="token function">chmod</span>  u<span class="token operator">=</span>rwx , g<span class="token operator">=</span>rx , o<span class="token operator">=</span>x文件目录名
<span class="token function">chmod</span>  o+w  文件目录名
<span class="token function">chmod</span>  a-x  文件目录名
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="案例演示"><a href="#案例演示" class="headerlink" title="案例演示"></a>案例演示</h3><p>1）给abc文件的所有者读写执行权限，给所在组执行权限，给其他组的用户读执行权限。</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210605140748.png" alt="image-20210605140747345"></p>
<p>2）给abc文件的所有者出去执行的权限，增加组的用户写权限</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210605140958.png" alt="image-20210605140956725"></p>
<p>3）给abc文件的所有用户添加读的权限 </p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210605141130.png" alt="image-20210605141129116"></p>
<h3 id="第二种方式：通过数字变更权限"><a href="#第二种方式：通过数字变更权限" class="headerlink" title="第二种方式：通过数字变更权限"></a>第二种方式：通过数字变更权限</h3><p>r=4  w=2  x=1         rwx=4+2+1=7</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">chmod</span>   u<span class="token operator">=</span>rwx，g<span class="token operator">=</span>rx，o<span class="token operator">=</span>x   文件目录名
相当于   <span class="token function">chmod</span>  751  文件名称        
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li><strong>案例演示</strong></li>
</ul>
<p>要求：将/home/abc.txt文件的权限修改为，<font color='red'>rwx</font> <font color='orange'>r-x</font>r-x，使用给数字的方式实现（这里面是每三个符号一组）</p>
<p>rwx  =  4+2+1=7</p>
<p>r-x=4+1=5</p>
<p>r-x=4+1=5</p>
<p>指令chmod 755 /home/abc.txt</p>
<h2 id="修改文件所有者-chown"><a href="#修改文件所有者-chown" class="headerlink" title="修改文件所有者-chown"></a>修改文件所有者-chown</h2><h3 id="基本介绍-18"><a href="#基本介绍-18" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>chown newowner file  改变文件的所有者</p>
<p>chown  newowner：newgroup  file   改变用户的所有者和所有组</p>
<p>带上<font color='red'>-R</font>参数如果是目录  则使其下所有子文件或目标<font color='red'>递归</font>生效</p>
<h3 id="案例演示-1"><a href="#案例演示-1" class="headerlink" title="案例演示"></a>案例演示</h3><p>1）请将/home/abc.txt文件的所有者修改为tom</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210605173227.png" alt="image-20210605173226639"></p>
<p>2）请将/home/kkk目录下所有的文件和目录的所有者都修改为zwj</p>
<p>首先我们应该使用root用户来操作。</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210608082540.png" alt="image-20210608082532219"></p>
<h2 id="修改文件所在组-chgrp"><a href="#修改文件所在组-chgrp" class="headerlink" title="修改文件所在组-chgrp"></a>修改文件所在组-chgrp</h2><h3 id="基本介绍-19"><a href="#基本介绍-19" class="headerlink" title="基本介绍"></a>基本介绍</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">chgrp</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span>  newgroup（改变文件的所有组） <span class="token function">file</span>  
选项：-R表示递归修改其下所有子文件或者目录
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="案例演示-2"><a href="#案例演示-2" class="headerlink" title="案例演示"></a>案例演示</h3><p>1）请将/home/abc.txt文件的所有组修改成bandit（土匪组）</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210608083310.png" alt="image-20210608083308485"></p>
<p>2）请将/home/kkk目录下的所有文件和目录的所在组都修改成bandit（土匪组）</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210608083456.png" alt="image-20210608083455029"></p>
<h2 id="最佳实践-警察和土匪游戏"><a href="#最佳实践-警察和土匪游戏" class="headerlink" title="最佳实践-警察和土匪游戏"></a>最佳实践-警察和土匪游戏</h2><p>police  ，  bandit</p>
<p>jack，jerry警察</p>
<p>xh ， xq：土匪</p>
<p>1）创建组</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">groupadd</span> police
<span class="token function">groupadd</span> bandit
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>2）创建用户</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210608104429.png" alt="image-20210608104428477"></p>
<p>将密码都指定为<font color='red'>123</font></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210608104619.png" alt="image-20210608104618827"></p>
<p>3）jack创建一个文件，自己可以读写，本组人可以读，其他组人没有任何权限</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">chmod</span> 640 jack01.txt
也可以用 <span class="token function">chmod</span> o<span class="token operator">=</span> jack01.txt     
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210608105322.png" alt="image-20210608105321299"></p>
<p>4）jack修改该文件，让其他组人可以读。本组人可以读写</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210608113126.png" alt="image-20210608113125027"></p>
<p>5）xq投靠警察，看看是否可以读写</p>
<p>先用root修改xq的组：</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210608155137.png" alt="image-20210608155135961"></p>
<p>再使用jack给他的家目录/home/jack所在组一个rx权限</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210608160224.png" alt="image-20210608160222949"></p>
<p><img src="C:/Users/AppData/Roaming/Typora/typora-user-images/image-20210608155408201.png" alt="image-20210608155408201"></p>
<h2 id="文件联系权限管理-课后练习1"><a href="#文件联系权限管理-课后练习1" class="headerlink" title="文件联系权限管理[课后练习1]"></a>文件联系权限管理[<font color='red'>课后练习1</font>]</h2><p>建立两个组（神仙，妖怪）</p>
<p>建立四个用户（唐僧，悟空，八戒，沙僧）</p>
<p>把悟空，八戒放在妖怪组，唐僧沙僧放进神仙组</p>
<p>用悟空建立一个文件（monkey.java该文件要输出 i am monkey）</p>
<p>给八戒一个rw的权限</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210608165548.png" alt="image-20210608165547626"></p>
<p>唐僧沙僧对该文件没有权限</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210608165642.png" alt="image-20210608165641017"></p>
<p>把沙僧放入妖怪组</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210608165902.png" alt="image-20210608165901057"></p>
<p>让沙僧修改该文件monkey，加入一句话（“我是沙僧，我是妖怪！”）;</p>
<h2 id="文件联系权限管理-课后练习2"><a href="#文件联系权限管理-课后练习2" class="headerlink" title="文件联系权限管理[课后练习2]"></a>文件联系权限管理[<font color='red'>课后练习2</font>]</h2><p>1）用root登录，建立用户mycentos，自己设定密码</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210609083755.png" alt="image-20210609083753792"></p>
<p>2）用mycentos登录，在主目录下建立目录test/t11/t1</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210609084052.png" alt="image-20210609084051839"></p>
<p>3）在t1中建立一个文本文件aa，用vi编辑器内容为ls -al</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210609084200.png" alt="image-20210609084159138"></p>
<p>4）改变aa的权限为可执行文件[可以将当前日期追加到一个文件]，运行该文件./aa</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210609084346.png" alt="image-20210609084344890"></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210609084744.png" alt="image-20210609084743768"></p>
<p>5）删除新建立的目录test/t11/t1</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210609084907.png" alt="image-20210609084906028"></p>
<p>6）删除用户mycentos以及其主目录中的内容</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210609085331.png" alt="image-20210609085329973"></p>
<p>7）将Linux设置到图形界面</p>
<p>8）重新启动Linux或关机</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">reboot</span> 重启
halt 关机
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h1 id="定时任务调度"><a href="#定时任务调度" class="headerlink" title="定时任务调度"></a>定时任务调度</h1><h2 id="crond任务调度"><a href="#crond任务调度" class="headerlink" title="crond任务调度"></a>crond任务调度</h2><p>crond进行定时任务的设置</p>
<h3 id="原理示意图"><a href="#原理示意图" class="headerlink" title="原理示意图"></a>原理示意图</h3><p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210609105612.png" alt="image-20210609105611466"></p>
<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>任务调度是指在系统的某个时间执行的特定的命令或者程序。</p>
<p>任务调度分类：1、系统工作：游戏重要的工作必须是周而复始的执行。比如病毒扫描等</p>
<p>2、个别用户工作：个别用户可能希望执行某些程序，比如对mysql数据库的备份。</p>
<h3 id="基本语法-28"><a href="#基本语法-28" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">crontab</span>  <span class="token punctuation">[</span>常用 选项<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="常用选项-1"><a href="#常用选项-1" class="headerlink" title="常用选项"></a>常用选项</h3><table>
<thead>
<tr>
<th>-e</th>
<th>编辑crontab定时任务</th>
</tr>
</thead>
<tbody><tr>
<td>-l</td>
<td>查询crontab任务</td>
</tr>
<tr>
<td>-r</td>
<td>删除当前用户所有的crontab任务</td>
</tr>
</tbody></table>
<h3 id="任务要求"><a href="#任务要求" class="headerlink" title="任务要求"></a>任务要求</h3><p>设置任务跳读文件：/etc/crontab</p>
<p>设置个人任务调度。执行crontab -e 命令</p>
<p>接着输入任务到调度文件</p>
<p>如：*/1 ****ls -l  / etc /&gt;/ tmp/to.txt</p>
<p>意思说每小时的每分钟执行ls -l /etc/ &gt; /tmp/to.txt命令</p>
<h3 id="步骤如下"><a href="#步骤如下" class="headerlink" title="步骤如下"></a>步骤如下</h3><pre class="line-numbers language-bash"><code class="language-bash">1<span class="token punctuation">)</span> <span class="token function">cron</span> -e
2<span class="token punctuation">)</span> */1 * * * * <span class="token function">ls</span> -l /etc<span class="token operator">>></span> /tmp/to.txt
3<span class="token punctuation">)</span> 当保存后就退出程序
4<span class="token punctuation">)</span> 在每一分钟都会调用  <span class="token function">ls</span> -l /etc<span class="token operator">>></span> /tmp/to.txt
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="细节参数说明"><a href="#细节参数说明" class="headerlink" title="细节参数说明"></a>细节参数说明</h3><ul>
<li><strong>5个占位符的说明</strong></li>
</ul>
<table>
<thead>
<tr>
<th>项目</th>
<th>含义</th>
<th>范围</th>
</tr>
</thead>
<tbody><tr>
<td>第一个“*”</td>
<td>一小时中的第几分钟</td>
<td>0-59</td>
</tr>
<tr>
<td>第二个“*”</td>
<td>一天中的第几小时</td>
<td>0-23</td>
</tr>
<tr>
<td>第三个“*”</td>
<td>一月中的第几天</td>
<td>1-31</td>
</tr>
<tr>
<td>第四个“*”</td>
<td>一年中的第几月</td>
<td>1-12</td>
</tr>
<tr>
<td>第五个“*”</td>
<td>一周中的星期几</td>
<td>0-7（0和7都代表星期日）</td>
</tr>
</tbody></table>
<ul>
<li><strong>特殊符号的说明</strong></li>
</ul>
<table>
<thead>
<tr>
<th>特殊符号</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>*</td>
<td>代表任何时间。比如第一个“*”就代表一个小时中每分钟都执行一次的意思。</td>
</tr>
<tr>
<td>，</td>
<td>代表不连续的时间。比如“0 8 ，12 ，16 * * * 命令”，就代表在每天的8点0分，12点0分，16点0分都执行一次命令</td>
</tr>
<tr>
<td>-</td>
<td>代表连续的时间范围。比如“0 5 * * 1-6<font color='red'>命令</font> ” ，代表在周一到周六的凌晨5点0分执行命令</td>
</tr>
<tr>
<td>*/n</td>
<td>代表没隔多久执行一次。比如“*/10 * * * * <font color='red'>命令</font>” ，代表每隔10分钟就执行一遍命令</td>
</tr>
</tbody></table>
<ul>
<li><strong>特定时间执行任务案例</strong></li>
</ul>
<table>
<thead>
<tr>
<th>时间</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td>45 22 * * * 命令</td>
<td align="left">在22点45分执行命令</td>
</tr>
<tr>
<td>0 17 * * 1  命令</td>
<td align="left">在每周1的17点0分执行命令</td>
</tr>
<tr>
<td>0 5 1 ，15 * * 命令</td>
<td align="left">在每月1号和15号的凌晨5点0分执行命令</td>
</tr>
<tr>
<td>40 4 * * 1-5 命令</td>
<td align="left">每周一到周五的凌晨4点40分执行命令</td>
</tr>
<tr>
<td>*/10 4 * * * 命令</td>
<td align="left">每天的凌晨4点，每隔十分钟执行一次命令</td>
</tr>
<tr>
<td>00 1 ， 15 * 1命令</td>
<td align="left">每月1号和15号，每周1点0分都会执行命令。注意：星期几和几号最好不要同时出现，因为他们的定义都是天。非常容易让管理员混乱</td>
</tr>
</tbody></table>
<h2 id="crond任务调度应用实例"><a href="#crond任务调度应用实例" class="headerlink" title="crond任务调度应用实例"></a>crond任务调度应用实例</h2><h3 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h3><p><strong>案例1</strong>：每隔一分钟，就将当前的日期信息，追加到 /tmp/mydate文件中</p>
<p>1)先编写一个文件 /home/mytask1.sh</p>
<pre class="line-numbers language-bash"><code class="language-bash">指令
vim /home/mytask1.sh
<span class="token function">date</span> <span class="token operator">>></span> /tmp/mydate
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>2）给mytask1.sh一个可执行权限</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">chmod</span> 744 /home/mytask1.sh
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）crontab -e</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210609195311.png" alt="image-20210609195310486"></p>
<p>4）*/1 * * * *  /home/mytask1.sh</p>
<p>5）成功</p>
<p><strong>案例2</strong>：每隔一分钟，将当前<font color='red'><strong>日期和日历</strong></font>都追加到 /home/mycal文件中</p>
<p>1)先编写一个文件 /home/mytask2.sh</p>
<pre class="line-numbers language-bash"><code class="language-bash">指令
vim /home/mytask2.sh
<span class="token function">date</span> <span class="token operator">>></span> /tmp/mcycal
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>2）给mytask1.sh一个可执行权限</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">chmod</span> 744 /home/mytask2.sh
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）crontab -e</p>
<p>4）*/1 * * * *  /home/mytask2.sh</p>
<p>5）成功</p>
<p><strong>案例3</strong>：每天凌晨2:00将mysql数据库testdb。备份到文件中。</p>
<h3 id="crond相关的指令"><a href="#crond相关的指令" class="headerlink" title="crond相关的指令"></a>crond相关的指令</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">crontab</span> -r :终止任务调度
<span class="token function">crontab</span> -l :列出当前有哪些任务调度
<span class="token function">service</span> crond restart <span class="token punctuation">[</span>重启任务调度<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h1 id="Linux磁盘分区、挂载"><a href="#Linux磁盘分区、挂载" class="headerlink" title="Linux磁盘分区、挂载"></a>Linux磁盘分区、挂载</h1><h2 id="分区基础知识"><a href="#分区基础知识" class="headerlink" title="分区基础知识"></a>分区基础知识</h2><h3 id="分区的方式（了解）"><a href="#分区的方式（了解）" class="headerlink" title="分区的方式（了解）"></a>分区的方式（<font color='red'>了解</font>）</h3><p>1）mbr分区：</p>
<p>1.最多支持四个主分区</p>
<p>2.系统只能安装在主分区</p>
<p>3.扩展分区只要占一个主分区</p>
<p>4.MBR最大支持2TB，但拥有最好的兼容性</p>
<p>2）gtp分区：</p>
<p>1.支持多个主分区(但操作系统可能限制，比如Windows下最多128个分区)</p>
<p>2.最大支持18EB的大容量（EB=1024PB，PB=1024TB）</p>
<p>3.windows7  64位以后支持gtp</p>
<h3 id="Windows下的磁盘分区"><a href="#Windows下的磁盘分区" class="headerlink" title="Windows下的磁盘分区"></a>Windows下的磁盘分区</h3><p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210615123843.png" alt="image-20210615123834985"></p>
<h2 id="Linux分区"><a href="#Linux分区" class="headerlink" title="Linux分区"></a>Linux分区</h2><h3 id="原理介绍"><a href="#原理介绍" class="headerlink" title="原理介绍"></a>原理介绍</h3><p>1）Linux来说无论有几个分区，分给哪一个目录使用，它归根结底就只有一个根目录，一个独立且唯一的文件结构，Linux中每一个分区都是用来组成文件系统的一部分。</p>
<p>2）Linux采用一种叫做“载入”的处理方法，它的整个文件系统中包含了一整套文件和目录，且将一个分区和一个目录联系起来。这是要载入一个分区将它的存储空间在一个目录下获得。</p>
<p>3）示意图</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210615124801.png" alt="image-20210615124800040"></p>
<h3 id="硬盘说明"><a href="#硬盘说明" class="headerlink" title="硬盘说明"></a>硬盘说明</h3><p>1）Linux硬盘分为IDE硬盘和SCSI硬盘，目前基本上是SCSI硬盘</p>
<p>2）对于<font color='red'>IDE</font>硬盘，驱动器标识符为“hdx<del>”，其中 “hd”表明分区所在设备的类型，这是指IDE硬盘了。“x”为盘号（a为基本盘，b为基本从属盘，c为辅助主盘，d为辅助从属盘），“</del>”代表分区，前四个分区用数字1到4表示，他们是主分区或扩展分区，hbd2表示为第二个IDE硬盘上过的第二个主分区或扩展分区。</p>
<p>3）对于SCSI硬盘则表示为“sdx”，SCSI硬盘是用“sd”来表示分区所在设备的类型的，其余则和IDE硬盘的表示方法一样。</p>
<h3 id="使用-lsblk-指令查看当前系统的分区情况"><a href="#使用-lsblk-指令查看当前系统的分区情况" class="headerlink" title="使用  lsblk  指令查看当前系统的分区情况"></a>使用 <font color='red'> lsblk  指令</font>查看当前<font color='orange'>系统的分区情况</font></h3><p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210615134935.png" alt="image-20210615134934383"></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210616132706.png" alt="image-20210616132658380"></p>
<h2 id="挂载的经典案例"><a href="#挂载的经典案例" class="headerlink" title="挂载的经典案例"></a>挂载的经典案例</h2><p>需求是给我们的Linux系统增加一个新的硬盘，并且挂载到/home/newdisk</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210616133041.png" alt="image-20210616133040682"></p>
<h3 id="如何增加一块硬盘"><a href="#如何增加一块硬盘" class="headerlink" title="如何增加一块硬盘"></a>如何增加一块硬盘</h3><p>1）虚拟机添加硬盘</p>
<p>2）分区 </p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">fdisk</span> /dev/sdb
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）格式化</p>
<pre class="line-numbers language-bash"><code class="language-bash">mkfs -t ext4 /dev/sdb1 mkfs是格式化的意思
这里表示的是把dev下面的sdb1格式化成ext4类型的文件类型
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>4）挂载</p>
<pre class="line-numbers language-bash"><code class="language-bash">先创建 /home/newdisk
再进行挂载  <span class="token function">mount</span>  /dev/sdb1  /home/newdisk 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210616134841.png" alt="image-20210616134840082"></p>
<p>5）设置可以自动挂载（永久挂载，当你重启机系统后，仍然可以挂载到 /home/newdisk上面去）。</p>
<pre class="line-numbers language-bash"><code class="language-bash">vim /etc/fstab  进入之后加上
/dev/sdb1                /home/newdisk                  ext4     defaults        0 0
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="具体的操作步骤"><a href="#具体的操作步骤" class="headerlink" title="具体的操作步骤"></a>具体的操作步骤</h2><h3 id="虚拟机增加硬盘步骤1（增加硬盘）"><a href="#虚拟机增加硬盘步骤1（增加硬盘）" class="headerlink" title="虚拟机增加硬盘步骤1（增加硬盘）"></a>虚拟机增加硬盘步骤1<font color='red'>（增加硬盘）</font></h3><p>在<font color='red'>【虚拟机】</font>菜单中，选择<font color='red'>【设置】</font>，然后设备列表里面添加硬盘，然后一路<font color='red'>【下一步】</font>，中间只有选择磁盘大小的地方需要修改，直至完成。然后重启系统（才能识别）！</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210616172357.png" alt="image-20210616172349248"></p>
<h3 id="虚拟机增加硬盘步骤2（对磁盘进行分区-）"><a href="#虚拟机增加硬盘步骤2（对磁盘进行分区-）" class="headerlink" title="虚拟机增加硬盘步骤2（对磁盘进行分区 ）"></a>虚拟机增加硬盘步骤2<font color='red'>（对磁盘进行分区 ）</font></h3><p>分区命令  </p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">fdisk</span>  /dev/sdb
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>开始对/sdb分区</p>
<ul>
<li>m    显示命令列表</li>
<li>n      显示磁盘分区   同 fdisk   -1</li>
<li>d      删除分区</li>
<li>w     写入并退出</li>
</ul>
<p>说明：开始分区后输入n，新增分区，然后选择p，分区类型为主分区。两次回车默认全部空间，最后输入w并退出，若不保存推出输入q。</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210616173747.png" alt="image-20210616173745730"></p>
<h3 id="虚拟机增加硬盘步骤3（格式化磁盘）"><a href="#虚拟机增加硬盘步骤3（格式化磁盘）" class="headerlink" title="虚拟机增加硬盘步骤3（格式化磁盘）"></a>虚拟机增加硬盘步骤3<font color='red'>（格式化磁盘）</font></h3><p>格式化磁盘</p>
<p>分区命令：mkfs -t   ext4   /dev/sdb1</p>
<p>其中ext4是分区类型</p>
<h3 id="虚拟机增加硬盘步骤4-（挂载）"><a href="#虚拟机增加硬盘步骤4-（挂载）" class="headerlink" title="虚拟机增加硬盘步骤4    （挂载）"></a>虚拟机增加硬盘步骤4    <font color='red'>（挂载）</font></h3><p><font color='red'><strong>挂载</strong></font>：将一个分区于一个目录联系起来</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">mount</span>  设备名称    挂载目录
   例如：mount   /dev/sdb1    /newdisk
<span class="token function">umount</span>   设备名称  或者   挂载目录   （相当于卸载）
   例如：umount /dev/sdb1    或者   <span class="token function">umount</span>   /newdisk
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="虚拟机增加硬盘步骤5（实现永久挂载）"><a href="#虚拟机增加硬盘步骤5（实现永久挂载）" class="headerlink" title="虚拟机增加硬盘步骤5（实现永久挂载）"></a>虚拟机增加硬盘步骤5<font color='red'>（实现永久挂载）</font></h3><p><font color='red'>永久挂载</font>：通过<font color='orange'>修改/etc/fstab实现挂载</font></p>
<p>添加完成后   执行 <font color='red'> mount    -a  </font>立即生效</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210616175226.png" alt="image-20210616175225394"></p>
<h2 id="磁盘情况查询"><a href="#磁盘情况查询" class="headerlink" title="磁盘情况查询"></a>磁盘情况查询</h2><h3 id="查询系统整体磁盘使用情况"><a href="#查询系统整体磁盘使用情况" class="headerlink" title="查询系统整体磁盘使用情况"></a>查询系统整体磁盘使用情况</h3><ul>
<li><p>基本语法</p>
<pre class="line-numbers language-bash"><code class="language-bash">查看磁盘占用情况   <span class="token function">df</span>  -lh
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>应用实例</p>
</li>
</ul>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210618124410.png" alt="image-20210618124402629"></p>
<h3 id="查询指定目录磁盘占用情况"><a href="#查询指定目录磁盘占用情况" class="headerlink" title="查询指定目录磁盘占用情况"></a>查询指定目录磁盘占用情况</h3><ul>
<li><p>基本语法</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">du</span>  -h  /目录
查询指定目录的磁盘占用情况，默认为当前目录
-s  之目录大小的汇总
-h  带计量单位
-a  含文件
--max-depth<span class="token operator">=</span>1  子目录深度
-c  列出明细的同时，增加汇总值
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>应用实例</li>
</ul>
</li>
</ul>
<p>查询  /opt 目录的磁盘占用情况，深度为1</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210618125722.png" alt="image-20210618125721731"></p>
<p>查看当前目录下文件夹的是使用率</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">du</span> -h --max-depth<span class="token operator">=</span>1
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="C:\Users\losser\AppData\Roaming\Typora\typora-user-images\image-20211224154439972.png" alt="image-20211224154439972"></p>
<h2 id="磁盘情况-工作实用指令"><a href="#磁盘情况-工作实用指令" class="headerlink" title="磁盘情况-工作实用指令"></a>磁盘情况-工作实用指令</h2><p> 1）统计     /home  文件夹目录下的个数</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">ls</span> -l /home <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"^-"</span> <span class="token operator">|</span> <span class="token function">wc</span> -l
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210618134222.png" alt="image-20210618134221489"></p>
<p>2）统计/home文件夹下目录的个数</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">ls</span> -l /home <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"^d"</span> <span class="token operator">|</span> <span class="token function">wc</span> -l
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210618134329.png" alt="image-20210618134328531"></p>
<p>3）统计     /home   文件夹下文件的个数，包括子文件夹里面的</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">ls</span> -lR /home <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"^-"</span> <span class="token operator">|</span> <span class="token function">wc</span> -l    加上了R就将/home下面的文件的个数，包括子文件夹里面的都递归统计
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210618190911.png" alt="image-20210618190910795"></p>
<p>4）统计文件夹下目录的个数，包括子文件夹里面的</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">ls</span> -lR /home <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"^d"</span> <span class="token operator">|</span> <span class="token function">wc</span> -l    加上了R就将/home下面的文件的个数，包括子文件夹里面的都递归统计
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210618191522.png" alt="image-20210618191521215"></p>
<p>5）以树状显示目录结构</p>
<pre class="line-numbers language-bash"><code class="language-bash">tree 指令的安装
yum <span class="token function">install</span> tree
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210618192100.png" alt="image-20210618192059735"></p>
<p>​                        <img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210707201650.png" alt="image-20210618192214345">    </p>
<h1 id="实操篇之网络配置"><a href="#实操篇之网络配置" class="headerlink" title="实操篇之网络配置"></a>实操篇之网络配置</h1><h2 id="Linux网络配置的原理图（含虚拟机）"><a href="#Linux网络配置的原理图（含虚拟机）" class="headerlink" title="Linux网络配置的原理图（含虚拟机）"></a>Linux网络配置的原理图（含虚拟机）</h2><p>目前我们采用的是NAT模式。</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210622155744.png" alt="image-20210622155736574"></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210618213424.png" alt="image-20210618213423266"></p>
<h2 id="查看网络IP和网关"><a href="#查看网络IP和网关" class="headerlink" title="查看网络IP和网关"></a>查看网络IP和网关</h2><h3 id="查看虚拟网络编辑器"><a href="#查看虚拟网络编辑器" class="headerlink" title="查看虚拟网络编辑器"></a>查看虚拟网络编辑器</h3><p>VMware  编辑   —–&gt;   虚拟网络配置</p>
<h3 id="修改IP地址（修改虚拟网卡的IP-也就是vmnet8）"><a href="#修改IP地址（修改虚拟网卡的IP-也就是vmnet8）" class="headerlink" title="修改IP地址（修改虚拟网卡的IP   也就是vmnet8）"></a>修改IP地址（修改虚拟网卡的IP   也就是vmnet8）</h3><p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210618214242.png" alt="image-20210618214240461"></p>
<h3 id="查看网络IP和网关-1"><a href="#查看网络IP和网关-1" class="headerlink" title="查看网络IP和网关"></a>查看网络IP和网关</h3><p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210619081720.png" alt="image-20210619081710105"></p>
<h3 id="查看Windows环境中的VMnet8网络配置（ipconfig指令）"><a href="#查看Windows环境中的VMnet8网络配置（ipconfig指令）" class="headerlink" title="查看Windows环境中的VMnet8网络配置（ipconfig指令）"></a>查看Windows环境中的VMnet8网络配置（ipconfig指令）</h3><p>1）使用ipconfig查看</p>
<p>2）界面查看</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210619082121.png" alt="image-20210619082120849"></p>
<h2 id="ping测试主机之间网络的连通性"><a href="#ping测试主机之间网络的连通性" class="headerlink" title="ping测试主机之间网络的连通性"></a>ping测试主机之间网络的连通性</h2><h3 id="基本语法-29"><a href="#基本语法-29" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">ping</span>    目的主机    （功能描述：测试当前服务器是否可以连接目的主机）
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="应用实例-30"><a href="#应用实例-30" class="headerlink" title="应用实例"></a>应用实例</h3><p>测试当前服务器是否可以访问百度</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">ping</span>     www.baidu.com
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="Linux网络环境配置"><a href="#Linux网络环境配置" class="headerlink" title="Linux网络环境配置"></a>Linux网络环境配置</h2><h3 id="第一种方式（自动获取）"><a href="#第一种方式（自动获取）" class="headerlink" title="第一种方式（自动获取）"></a>第一种方式（自动获取）</h3><p><font color='red'>说明</font>：登陆后，通过界面来设置自动获取IP</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210619085552.png" alt="image-20210619085547568"></p>
<p><font color='red'>特点</font>：Linux启动后会自动获取IP，缺点是每次启动后自动获取的IP地址可能不一样。这个不适用于做服务器，因为我们服务器的IP需要是固定的。</p>
<h3 id="第二种方式（指定固定的IP）"><a href="#第二种方式（指定固定的IP）" class="headerlink" title="第二种方式（指定固定的IP）"></a>第二种方式（指定固定的IP）</h3><ul>
<li><p>说明192.168.122.1</p>
<p>直接修改文件来指定IP，并且可以连接到外网（<font color='red'>推荐</font>），<strong>编辑</strong>   vi  /etc/sysconfig/network-scripts/ifcfg-ens33（centos7），（ vi /etc/sysconfig/network-scripts/ifcfg-eth0     这个为centos6）</p>
</li>
</ul>
<p>要求：将IP地址设置成静态的，IP地址为192.168.31.128</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210619101600.png" alt="image-20210619101559143"></p>
<p>修改后，一定要重启服务</p>
<p>1）service   network   restart</p>
<p>2）reboot   重启机器</p>
<h1 id="实操篇之进程管理"><a href="#实操篇之进程管理" class="headerlink" title="实操篇之进程管理"></a>实操篇之进程管理</h1><h2 id="基本介绍-20"><a href="#基本介绍-20" class="headerlink" title="基本介绍"></a>基本介绍</h2><p>1）在Linux中，每个执行的<strong>程序（代码）</strong>都成为一个<font color='red'>进程</font>。每个进程都分配一个id号。</p>
<p>2）每个进程，都会对应一个父进程，而这个父进程可以复制多个子进程。例如www服务器。</p>
<p>3）每个进程都可能以两种方式存在。<font color='red'>前台和后台</font>，所谓前台进程就是用户目前屏幕上可以进行的操作。后台进程实际在操作，由于屏幕上无法看到进程，通常使用后台方式执行。</p>
<p>4）一般系统的服务都是以后台进程的方式存在，而且都会常驻在系统中。知道关机才结束。</p>
<h2 id="显示执行的进程"><a href="#显示执行的进程" class="headerlink" title="显示执行的进程"></a>显示执行的进程</h2><h3 id="说明：查看进程使用的指令是ps-，一般来说使用的参数是-aus"><a href="#说明：查看进程使用的指令是ps-，一般来说使用的参数是-aus" class="headerlink" title="说明：查看进程使用的指令是ps ，一般来说使用的参数是   -aus"></a>说明：查看进程使用的指令是ps ，一般来说使用的参数是   -aus</h3><p>ps显示信息选项：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>PID</td>
<td>进程识别号</td>
</tr>
<tr>
<td>TTY</td>
<td>终端机号</td>
</tr>
<tr>
<td>TIME</td>
<td>此进程所消耗CUP时间</td>
</tr>
<tr>
<td>CMD</td>
<td>正在执行的命令或进程名</td>
</tr>
</tbody></table>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">ps</span> -a     :显示当前终端的所有进程信息
<span class="token function">ps</span> -u    ：以用户的格式显示进程信息
<span class="token function">ps</span> -x    ：显示后台进程运行的参数
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">ps</span> -aux <span class="token operator">|</span> <span class="token function">more</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210619175858.png" alt="image-20210619175857359"></p>
<h3 id="ps详解"><a href="#ps详解" class="headerlink" title="ps详解"></a>ps详解</h3><p>1）指令：ps -aux  |  grep   xxx  ，比如看看有没有sshd服务</p>
<p>2）指令说明</p>
<ul>
<li>System  V  展示风格</li>
<li>USER  :用户名称</li>
<li>PID：进程号</li>
<li>%CPU：进程占用CPU的百分比</li>
<li>%MEM：进程占用的物理内存的百分比</li>
<li>VSZ:进程占用虚拟内存的大小（单位:KB）</li>
<li>RSS：进程占用的物理内存的大小（单位：KB）</li>
<li>TT：终端名称，缩写</li>
<li>STAT：进程状态，其中S-睡眠，s-表示该进程是会话的先导进程，N-表示进程拥有比普通优先级更低的优先级，R-正在运行，D-短期等待，Z-僵死进程，T-被跟踪或被停止等待</li>
<li>STARTED：进程的启动时间</li>
<li>TIME：CPU时间，即进程使用CPU的总时间。</li>
<li>COMMAND：启动进程所用的命令和参数，如果过长会被截断显示</li>
</ul>
<h3 id="应用实例-31"><a href="#应用实例-31" class="headerlink" title="应用实例"></a>应用实例</h3><p>要求：以全格式显示当前所有的进程，查看进程的父进程。</p>
<ul>
<li>ps    -ef 是以全格式显示当前的所有的进程</li>
<li>-e 显示所有进程。-f全格式。</li>
<li>ps  -ef | grep  xxx</li>
<li>是BSD风格</li>
<li>UID：用户ID</li>
<li>PID：进程ID</li>
<li>PPID：父进程ID</li>
<li>C:CPU用于计算执行优先级的因子。数值越大，表明进程是CPU密集型运算，执行优先级会降低；数值越小，表明进程I/O密集型运算，执行优先级会提高    </li>
</ul>
<p>思考题，如果我们希望查看sshd进程的父进程号是多少，应该怎么样查询？</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> sshd
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210619190657.png" alt="image-20210619190657050"></p>
<h2 id="终止进程kill和killall"><a href="#终止进程kill和killall" class="headerlink" title="终止进程kill和killall"></a>终止进程kill和killall</h2><h3 id="介绍-4"><a href="#介绍-4" class="headerlink" title="介绍"></a>介绍</h3><p>若是某个进程执行一般需要停止时，或是已消了很大的系统资源时，可以考虑停止该进程。使用kill命令来完成此项任务。</p>
<h3 id="基本语法-30"><a href="#基本语法-30" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">kill</span>   <span class="token punctuation">[</span>选项<span class="token punctuation">]</span>   进程号  （功能描述：通过进程号来杀死进程）
<span class="token function">killall</span>  进程名称  （功能描述：通过进程名称杀死进程，也支持通配符，这在系统因负载过大而变得很慢时很有用）
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="常用选项-2"><a href="#常用选项-2" class="headerlink" title="常用选项"></a>常用选项</h3><pre class="line-numbers language-bash"><code class="language-bash">-9 表示强迫进程立即停止
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="最佳实践："><a href="#最佳实践：" class="headerlink" title="最佳实践："></a>最佳实践：</h3><p>案例一：踢掉某个非法登录的用户</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">ps</span> -aux <span class="token operator">|</span> <span class="token function">grep</span> sshd
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210620093220.png" alt="image-20210620093212557"></p>
<p>案例二：终止远程登陆服务sshd，在适当时候再次重启sshd服务</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">ps</span> -aux <span class="token operator">|</span> <span class="token function">grep</span> sshd
<span class="token function">kill</span> 1467
<span class="token function">ps</span> -aux <span class="token operator">|</span> <span class="token function">grep</span> sshd
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210620114835.png" alt="image-20210620114833970"></p>
<p>案例三：种植多个gedit编辑器  【killall ，通过进程名称来终止进程】</p>
<pre class="line-numbers language-bash"><code class="language-bash">gedit 执行两次
<span class="token function">killall</span>  gedit
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210620115213.png" alt="image-20210620115211999"></p>
<p>案例四：强制杀死一个终端</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">ps</span> -aux <span class="token operator">|</span> <span class="token function">grep</span> <span class="token function">bash</span>
<span class="token function">kill</span> -9 <span class="token punctuation">[</span>终端端口号<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210620115916.png" alt="image-20210620115915404"></p>
<h2 id="查看进程树pstree"><a href="#查看进程树pstree" class="headerlink" title="查看进程树pstree"></a>查看进程树pstree</h2><h3 id="基本语法-31"><a href="#基本语法-31" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash">pstree <span class="token punctuation">[</span>选项<span class="token punctuation">]</span>   ，可以更加直观的来观看进程
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="常用选项-3"><a href="#常用选项-3" class="headerlink" title="常用选项"></a>常用选项</h3><pre class="line-numbers language-bash"><code class="language-bash">-p <span class="token keyword">:</span> 显示进程的PID
-u <span class="token keyword">:</span> 显示进程的所属用户
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="应用实例-32"><a href="#应用实例-32" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：请你以树状形式显示进程的pid</p>
<pre class="line-numbers language-bash"><code class="language-bash">pstree -p <span class="token operator">|</span> <span class="token function">more</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210620120705.png" alt="image-20210620120703674"></p>
<p>案例二：请你以树状形式显示用户的id</p>
<pre class="line-numbers language-bash"><code class="language-bash">pstree -u <span class="token operator">|</span> <span class="token function">more</span> 
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210620120800.png" alt="image-20210620120759535"></p>
<h2 id="服务（service）管理"><a href="#服务（service）管理" class="headerlink" title="服务（service）管理"></a>服务（service）管理</h2><h3 id="介绍-5"><a href="#介绍-5" class="headerlink" title="介绍"></a>介绍</h3><p>服务（service）本质就是进程，但是运行在后台的，同城都会监听某个端口，等待其他程序的请求，比如（mysql，sshd，防火墙等），因此我们又称为守护进程，是Linux中非常重要的知识点。</p>
<p><font color='red'>【原理图】</font></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210620121057.png" alt="image-20210620121056540"></p>
<h2 id="service-（CentOS6-）systemctl（CentOS7-0-）-管理命令"><a href="#service-（CentOS6-）systemctl（CentOS7-0-）-管理命令" class="headerlink" title="service （CentOS6 ）systemctl（CentOS7.0  ） 管理命令"></a>service （CentOS6 ）systemctl（CentOS7.0  ） 管理命令</h2><p><font color='red'> CentOS7.0      systemctl   [start | stop | restart | reload | status |<br>mask  ]    服务名    这里的mask 是表示禁用的意思,reload表示的是重载 </font></p>
<p>service服务指令在/etc/init.d/</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210622160143.png" alt="image-20210622160142001"></p>
<p>systemctl指令管理的服务是在<font color='red'>/usr/lib/systemd/system</font>查看</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210623081048.png" alt="image-20210623081039798"></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">service</span>  服务名  <span class="token punctuation">[</span>start <span class="token operator">|</span> stop <span class="token operator">|</span> restart <span class="token operator">|</span> reload <span class="token operator">|</span> status <span class="token operator">|</span>mask <span class="token punctuation">]</span>
在CentOS7.0后  不再使用service ，而是systemctl
systemctl   <span class="token punctuation">[</span>start <span class="token operator">|</span> stop <span class="token operator">|</span> restart <span class="token operator">|</span> reload <span class="token operator">|</span> status <span class="token operator">|</span> mask <span class="token punctuation">]</span>    服务名 这个很重要
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="chconfig指令"><a href="#chconfig指令" class="headerlink" title="chconfig指令"></a>chconfig指令</h3><h4 id="介绍-6"><a href="#介绍-6" class="headerlink" title="介绍"></a>介绍</h4><p>1、通过chconfig命令可以给服务的各个运行级别设置<font color='red'>自   启动 / 关闭 </font></p>
<p>2、chconfig指令管理的服务在/etc/init.d查看</p>
<p>3、注意：CentOS7后，很多服务<font color='red'>使用systemctl</font>管理</p>
<h4 id="chconfig基本语法"><a href="#chconfig基本语法" class="headerlink" title="chconfig基本语法"></a>chconfig基本语法</h4><ul>
<li>查看服务  chconfig   –list  [ |  grep xxx  ]</li>
<li>chconfig  服务名  –list</li>
</ul>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210622222047.png" alt="image-20210622222047028"></p>
<ul>
<li>ckconfig  –level 5 服务名  on/off</li>
</ul>
<p>案例演示：对network  服务进行各种操作，把network在运行级别3关闭自启动</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">chkconfig</span> --level 3 network off
<span class="token function">chkconfig</span> --level 3 network on
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210622222416.png" alt="image-20210622222415266"></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210622222511.png" alt="image-20210622222510465"></p>
<p><font color='red'><strong>使用细节</strong></font></p>
<p>chconfig重新设置服务后自启动或关闭，需要重启机器reboot生效</p>
<h3 id="systemctl指令的常见使用"><a href="#systemctl指令的常见使用" class="headerlink" title="systemctl指令的常见使用"></a><font color='red'>systemctl指令</font>的常见使用</h3><p>systemctl基本介绍：<font color='red'>在Centos 中 systemctl  是设置系统服务的命令</font>，即 service  ,   它融合之前service和chkconfig的功能于一体。</p>
<p>可以使用它永久性或只在当前会话中启用/禁用服务。</p>
<pre class="line-numbers language-bash"><code class="language-bash">systemctl 设置服务的自启动状态
systemctl                            输出激活的单元，即列出所有正在运行的服务
systemctl    list-units                  输出激活的单元
systemctl    --failed                 输出运行失败的单元
systemctl    list-unit-files     <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">|</span><span class="token function">grep</span>  服务名<span class="token punctuation">]</span>         （查看服务开机启动状态，grep可以进行过滤）
systemctl enbale  服务名    （设置服务开机启动）
systemctl disabale  服务名   （关闭服务开机启动）
systemctl is-enbaled   服务名   （查询某个服务是否是自启动的）
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>启动一个服务</p>
<pre class="line-numbers language-bash"><code class="language-bash">systemctl start sshd.service 也可以省略<span class="token punctuation">(</span>.service<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在开机启动或者关闭服务:</p>
<pre class="line-numbers language-bash"><code class="language-bash">systemctl enbale sshd.service
systemctl disable sshd.service
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>查看是否开机启动</p>
<pre class="line-numbers language-bash"><code class="language-bash">systemctl is-enbaled sshd.service
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>查看已启动的服务列表:</p>
<pre class="line-numbers language-bash"><code class="language-bash"> systemctl list-unit-files <span class="token operator">|</span> <span class="token function">grep</span> enabled
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>查看启动失败的服务列表：</p>
<pre class="line-numbers language-bash"><code class="language-bash">systemctl --failed
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>查看防火墙服务</p>
<pre class="line-numbers language-bash"><code class="language-bash"> <span class="token function">ls</span> -l /usr/lib/systemd/system <span class="token operator">|</span> <span class="token function">grep</span> firewalld
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210623081741.png" alt="image-20210623081740177"></p>
<p>查看防火墙的自启动状态</p>
<pre class="line-numbers language-bash"><code class="language-bash">systemctl list-unit-files <span class="token operator">|</span> <span class="token function">grep</span> firewalld
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210623081922.png" alt="image-20210623081920967"></p>
<pre class="line-numbers language-bash"><code class="language-bash">systemctl is-enabled firewalld
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210623082012.png" alt="image-20210623082011662"></p>
<p>查看网络状态</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">netstat</span>  -anp <span class="token operator">|</span><span class="token function">more</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210623082621.png" alt="image-20210623082620812"></p>
<h3 id="使用案例"><a href="#使用案例" class="headerlink" title="使用案例"></a>使用案例</h3><p>1）查看当前防火墙的状况，关闭防火墙和重启防火墙    <font color='red'>（ CentOS7.0中）</font></p>
<pre class="line-numbers language-bash"><code class="language-bash">systemctl status firewalld     firewalld  表示的是防火墙的意思
systemctl stop firewalld   关闭防火墙
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210620123455.png" alt="image-20210620123454237"></p>
<h3 id="细节讨论："><a href="#细节讨论：" class="headerlink" title="细节讨论："></a>细节讨论：</h3><p>1）关闭或者其用防火墙后，立即生效。 [telnet  测试某个端口即可]</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210620141036.png" alt="image-20210620141035729"></p>
<p>2）这种方式这是临时生效，当重启系统后，还是回归以后对服务的设置</p>
<p>3）如果希望设置，某个服务自动启动或关闭永久生效，使用chekconfig指令。</p>
<h3 id="查看服务名"><a href="#查看服务名" class="headerlink" title="查看服务名"></a>查看服务名</h3><p>方式一：使用setup  –&gt;  系统服务  就可以看到   </p>
<pre class="line-numbers language-bash"><code class="language-bash">setup
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210620141824.png" alt="image-20210620141823089"></p>
<p>方式二： /etc/init.d/服务名称</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210620142324.png" alt="image-20210620142323462"></p>
<h3 id="服务的运行级别（runlevel）："><a href="#服务的运行级别（runlevel）：" class="headerlink" title="服务的运行级别（runlevel）："></a>服务的运行级别（runlevel）：</h3><p>Linux系统有七种运行级别（runlevel）：<font color='red'>常用的是级别3和5</font></p>
<p>运行级别0：系统停机状态，系统默认的运行级别不能设置为0，否则不能正常启动</p>
<p>运行级别1：单用户工作状态，root权限，用于系统维护，禁止远程登陆</p>
<p>运行级别2：多用户状态（有NFS），不支持网络</p>
<p><font color='red'>运行级别3</font>：完全的多用户状态（有NFS）<font color='red'>无界面</font>，登陆后进入控制台命令行模式</p>
<p>运行级别4：系统未使用，保留</p>
<p><font color='red'>运行级别5</font>：X11控制台，登录后进入图形GUI模式</p>
<p>运行级别6：系统正常关闭并重启，默认运行级别不能设置为6，否则不能正常启动</p>
<ul>
<li>开机的流程</li>
</ul>
<p>开机   —–》 BIOS  ——-》   /boot ——-》systemd进程1———-》运行级别————》运行级别对应的服务</p>
<p>1、查看默认的运行级别</p>
<pre class="line-numbers language-bash"><code class="language-bash">systemctl get-default
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210622192424.png" alt="image-20210622192404552"></p>
<p>2、设置运行级别为3号级别</p>
<pre class="line-numbers language-bash"><code class="language-bash">systemctl set-default multi-user.target
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210622192618.png" alt="image-20210622192616836"></p>
<p>3、设置成图形化界面</p>
<pre class="line-numbers language-bash"><code class="language-bash">systemctl set-default graphical.target
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210622192959.png" alt="image-20210622192958284"></p>
<p>示意图</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210623085346.png" alt="image-20210623085342071"></p>
<h3 id="打开或者关闭指定端口"><a href="#打开或者关闭指定端口" class="headerlink" title="打开或者关闭指定端口"></a>打开或者关闭指定端口</h3><p>在真正的生产环境中，往往需要防火墙打开，如果把防火墙打开，那么外部请求数据包就不能跟服务器监听通讯。这时，需要打开指定端口。比如80、22、8080等。</p>
<h3 id="firewall指令"><a href="#firewall指令" class="headerlink" title="firewall指令"></a>firewall指令</h3><pre class="line-numbers language-bash"><code class="language-bash">打开端口：
firewall-cmd --permanet     --add-port<span class="token operator">=</span>端口号/协议
firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>端口号/tcp --permanent
关闭端口：firewall-cmd --permanet --remove-port<span class="token operator">=</span>端口号/协议

需要重新载入，才能生效：firewall-cmd  --reload

查询端口是否开放：firewall-cmd  --query-port<span class="token operator">=</span>端口/协议

查看已经开启的端口号
firewall-cmd --list-ports
firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>8088/tcp
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="应用案例-2"><a href="#应用案例-2" class="headerlink" title="应用案例"></a>应用案例</h3><p>1、启用防火墙，测试111端口是否能telnet ，不行</p>
<p>2、开放111端口</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210623105115.png" alt="image-20210623105103990"></p>
<p>3、再次关闭111端口</p>
<pre class="line-numbers language-bash"><code class="language-bash">关闭端口：firewall-cmd --permanet --remove-port <span class="token operator">=</span>端口号/协议
需要重新载入，才能生效：firewall-cmd  --reload
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210623110756.png" alt="image-20210623110755819"></p>
<h2 id="动态监控进程"><a href="#动态监控进程" class="headerlink" title="动态监控进程"></a>动态监控进程</h2><h3 id="介绍-7"><a href="#介绍-7" class="headerlink" title="介绍"></a>介绍</h3><p>top与ps命令很相似。他们都是用来显示正在执行的进程。Top与ps的最大不同之处，在于top执行一段时间后可以更新正在运行的进程。</p>
<h3 id="基本语法-32"><a href="#基本语法-32" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">top</span>  <span class="token punctuation">[</span>选项<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="选项说明-1"><a href="#选项说明-1" class="headerlink" title="选项说明"></a>选项说明</h3><table>
<thead>
<tr>
<th>选项</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>-d 秒数</td>
<td>指定top命令每隔几秒更新。默认是3秒</td>
</tr>
<tr>
<td>-i</td>
<td>使top不显示任何闲置或者僵尸进程</td>
</tr>
<tr>
<td>-p</td>
<td>通过指定监控进程ID来仅仅监控某个进程的状态</td>
</tr>
</tbody></table>
<p>使用top指令动态监控进程</p>
<pre class="line-numbers language-bash"><code class="language-bash">下图的zombie是僵尸进程，已经死掉了，但是内存没有释放
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210623112345.png" alt="image-20210623112345015"></p>
<h3 id="交互操作说明"><a href="#交互操作说明" class="headerlink" title="交互操作说明"></a>交互操作说明</h3><table>
<thead>
<tr>
<th>操作</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td><font color='red'>P</font></td>
<td>以CUP使用率排序，默认就是此项</td>
</tr>
<tr>
<td><font color='red'>M</font></td>
<td>一内存使用率排序</td>
</tr>
<tr>
<td>N</td>
<td>以PID排序</td>
</tr>
<tr>
<td>q</td>
<td>退出top</td>
</tr>
</tbody></table>
<h3 id="应用实例-33"><a href="#应用实例-33" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：监视特定用户</p>
<p>top:输入此命令，按回车键，查看执行的进程。</p>
<p>u：然后输入”u”回车，再输入用户名，即可。</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210623191024.png" alt="image-20210623191023100"></p>
<p>案例二：终止此进程，比如我们要结束pzx登录</p>
<p>top：输入此命令，按回车键，查看执行的进程。</p>
<p>k：然后输入“k”回车，再输入要结束的进程的ID号。<font color='red'>（然后在输入9，进行强制杀死）</font></p>
<p>案例三：指定系统装态更新的时间（每隔10秒自动更行），默认是3秒</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">top</span> -d 10
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="监控网络状态"><a href="#监控网络状态" class="headerlink" title="监控网络状态"></a>监控网络状态</h2><p>查看系统的网络状态情况netstat</p>
<h3 id="基本语法-33"><a href="#基本语法-33" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash">netstst  <span class="token punctuation">[</span>选项<span class="token punctuation">]</span>
选项说明
-an   按一定顺序排列输出
-p   显示哪一个进程在调用
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="应用案例-3"><a href="#应用案例-3" class="headerlink" title="应用案例"></a>应用案例</h3><p>查看系统的网络状态情况netstat</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210623192417.png" alt="image-20210623192416838"></p>
<p>查看sshd服务的服务信息</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">netstat</span> -anp <span class="token operator">|</span> <span class="token function">grep</span> sshd
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="网络有问题的处理方法"><a href="#网络有问题的处理方法" class="headerlink" title="网络有问题的处理方法"></a>网络有问题的处理方法</h3><p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210624193815.png" alt="image-20210624193814271"></p>
<h3 id="linux和Windows之间建立通信（这个其实就是建立tcp通信）"><a href="#linux和Windows之间建立通信（这个其实就是建立tcp通信）" class="headerlink" title="linux和Windows之间建立通信（这个其实就是建立tcp通信）"></a>linux和Windows之间建立通信（这个其实就是建立tcp通信）</h3><p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210623192935.png" alt="image-20210623192932774"></p>
<h1 id="RPM和YUM"><a href="#RPM和YUM" class="headerlink" title="RPM和YUM"></a>RPM和YUM</h1><h2 id="rpm包的管理"><a href="#rpm包的管理" class="headerlink" title="rpm包的管理"></a>rpm包的管理</h2><h3 id="介绍-8"><a href="#介绍-8" class="headerlink" title="介绍"></a>介绍</h3><p>rpm用于互联网下载包的打包以安装工具，它包含在某些Linux发行版中。它生成具有.RPM拓展名的文件。RPM是RedHat Package Manager （RedHat 软件包管理工具）缩写，类似于windows中的setup.exe。    Linux的发行版都采用（suse，redhat，centos等等）</p>
<h3 id="rpm的简单查询指令"><a href="#rpm的简单查询指令" class="headerlink" title="rpm的简单查询指令"></a>rpm的简单查询指令</h3><pre class="line-numbers language-bash"><code class="language-bash">查询已经安装的rpm列表  
rpm  -qa  <span class="token operator">|</span>  <span class="token function">grep</span> xxx
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>案例演示：请查询是否安装firefox</p>
<pre class="line-numbers language-bash"><code class="language-bash">    rpm -qa <span class="token operator">|</span> <span class="token function">grep</span> firefox
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210623205228.png" alt="image-20210623205227158"></p>
<h3 id="rpm包的其他查询指令："><a href="#rpm包的其他查询指令：" class="headerlink" title="rpm包的其他查询指令："></a>rpm包的其他查询指令：</h3><pre class="line-numbers language-bash"><code class="language-bash">rpm  -qa  查询所安装的所有rpm软件包
rpm  -qa <span class="token operator">|</span> <span class="token function">more</span>
rpm  -qa <span class="token operator">|</span> <span class="token function">grep</span> X<span class="token punctuation">[</span>rpm -qa <span class="token operator">|</span> <span class="token function">grep</span> firefox<span class="token punctuation">]</span>
rpm  -q   软件包名：查询软件包是否安装
rpm  -q   firefox
rpm  -qi  软件包名：查询软件包信息
rpm  -q  <span class="token function">file</span>
rpm  -ql  软件包名：查询软件包中的文件
rpm  -qi  firefox

rpm  -qf  文件全路径名  查询文件所属的软件包
rpm  -qf  /etc/passwd
rpm  -qf  /root/install.log
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210623205954.png" alt="image-20210623205954028"></p>
<p>查询firefox安装在哪里</p>
<pre class="line-numbers language-bash"><code class="language-bash">rpm  -q  <span class="token function">file</span> firefox
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210707202032.png" alt="image-20210623210345146"></p>
<pre class="line-numbers language-bash"><code class="language-bash">rpm -qf /etc/passwd
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210623210614.png" alt="image-20210623210613970"></p>
<h3 id="卸载rpm包"><a href="#卸载rpm包" class="headerlink" title="卸载rpm包"></a>卸载rpm包</h3><ul>
<li>基本语法</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash">rpm -e  RPM的名称
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>应用案例</li>
</ul>
<p>1）删除firefox软件包</p>
<pre class="line-numbers language-bash"><code class="language-bash">rpm -e firefox
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210623211022.png" alt="image-20210623211021073"></p>
<ul>
<li>细节讨论</li>
</ul>
<p>1）如果其他软件包依赖于你要卸载的软件包，卸载时则会产生错误信息。</p>
<pre class="line-numbers language-bash"><code class="language-bash">如：<span class="token variable">$rpm</span> -e foo    
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>removing these packages would break dependences：foo is needed by bar-1.0-1</p>
<p>2）如果我们就是要删除foo这个rpm包，可以增加参数–nodeps ，就可以进行强制删除了，但是一般不推荐这样做，因为依赖于这些软件包的程序可能无法运行。</p>
<p>如：$rpm -e <font color='red'>–nodeps</font> foo  带上–nodeps就是强制删除的意思</p>
<h3 id="安装rpm包"><a href="#安装rpm包" class="headerlink" title="安装rpm包"></a>安装rpm包</h3><p><strong>基本语法</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash">rpm -ivh RPM包的全路径名称
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>参数说明</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash">i<span class="token operator">=</span>install 安装
v<span class="token operator">=</span>verbose 提示
h<span class="token operator">=</span>hash    进度条
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>应用实例</strong></p>
<p>1）演示安装firefox浏览器</p>
<p>步骤：</p>
<p>1、先找到firefox的安装rpm包，你需要挂载到我们安装的centos的iso文件</p>
<p>2、到 /mdeia/ 下去找rpm</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cp</span> firefox-68.10.0-1.el7.centos.x86_64.rpm /opt/
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210624122937.png" alt="image-20210624122936318"></p>
<h2 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h2><h3 id="介绍-9"><a href="#介绍-9" class="headerlink" title="介绍"></a>介绍</h3><p>Yum是一个shell<font color='red'>前端软件包管理器。</font>基于RPM包管理，能够从指定的服务器自动下载RPM包并且安装，可以<font color='red'>自动处理依赖关系</font>，并且一次安装所有依赖的软件包。（<font color='red'>有点像maven</font>）<font color='red'>使用yum的前提是可以联网。</font>    </p>
<p>示意图</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210624124019.png" alt="image-20210624124018202"></p>
<h3 id="yum的基本指令"><a href="#yum的基本指令" class="headerlink" title="yum的基本指令"></a>yum的基本指令</h3><p>查询yum服务是否具有需要安装的软件</p>
<pre class="line-numbers language-bash"><code class="language-bash">yum  list  <span class="token operator">|</span>  <span class="token function">grep</span>  xxx软件列表
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>安装指定的yum包</p>
<pre class="line-numbers language-bash"><code class="language-bash">yum <span class="token function">install</span> xxx   下载安装  <span class="token punctuation">[</span>-y<span class="token punctuation">]</span>  -y 选项的意思是询问的时候默认都是yes
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="yum应用实例"><a href="#yum应用实例" class="headerlink" title="yum应用实例"></a>yum应用实例</h3><p>请使用yum的方式来安装firefox</p>
<p>1）先查看firefox  rpm 在yum服务器上有没有</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210624124334.png" alt="image-20210624124333702"></p>
<p>2）安装</p>
<pre class="line-numbers language-bash"><code class="language-bash">yum insatll firefox
默认会安装最新版本的软件
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210624125045.png" alt="image-20210624125044364"></p>
<h3 id="yum的删除指令"><a href="#yum的删除指令" class="headerlink" title="yum的删除指令"></a>yum的删除指令</h3><pre class="line-numbers language-bash"><code class="language-bash">yum remove -y 软件名
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="JavaEE定制篇-搭建JavaEE环境"><a href="#JavaEE定制篇-搭建JavaEE环境" class="headerlink" title="JavaEE定制篇 搭建JavaEE环境"></a>JavaEE定制篇 搭建JavaEE环境</h1><h2 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h2><p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210624134137.png" alt="image-20210624134136606"></p>
<p>如果需要在Linux下进行JavaEE开发，需要安装如下软件</p>
<h2 id="安装jdk"><a href="#安装jdk" class="headerlink" title="安装jdk"></a>安装jdk</h2><ol start="0">
<li><p>先将软件通过xftp7上传到/opt</p>
</li>
<li><p>解压缩到/opt  </p>
</li>
</ol>
<p>2)修改/etc/profile配置文件（<font color='red'>vim /etc/profile</font>）</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210624181309.png" alt="image-20210624181308670"></p>
<pre class="line-numbers language-bash"><code class="language-bash">JAVA_HOME<span class="token operator">=</span>/opt/jdk1.7.0_79
PATH<span class="token operator">=</span>/opt/jdk1.7.0_79/bin:<span class="token variable">$PATH</span>
<span class="token function">export</span> JAVA_HOME PATH
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol start="3">
<li>需要注销用户，环境变量才能生效</li>
</ol>
<p>1、如果是3运行级别，直接logout</p>
<p>2、如果是5运行级别  （<font color='red'>可以使用 source /etc/profile 来刷新配置文件</font>）</p>
<p>先用javac指令生成字节码文件，再用java指令运行。</p>
<pre class="line-numbers language-bash"><code class="language-bash">javac Hello.java 
java Hello
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210624183256.png" alt="image-20210624183255605"></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210624183426.png" alt="image-20210624183425081"></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210624183330.png" alt="image-20210624183329066"></p>
<h2 id="安装tomcat"><a href="#安装tomcat" class="headerlink" title="安装tomcat"></a>安装tomcat</h2><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>1、先通过xftp传输压缩包到Linux上，然后解压到/opt</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">tar</span> -zxvf apache-tomcat-7.0.70.tar.gz
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210624184016.png" alt="image-20210624184015616"></p>
<p>2、启动tomca ./startup.sh</p>
<p>先进入到tomcat的bin目录</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210624191150.png" alt="image-20210624191149690"></p>
<pre class="line-numbers language-bash"><code class="language-bash">./startup.sh  启动tomcat
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210624191418.png" alt="image-20210624191416250"></p>
<p>使用Linux本地的浏览器是可以访问到tomcat</p>
<p>3)开放放端口  vim/etc/sysconfig/firewall</p>
<p>在windows下访问<a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080/</a></p>
<h2 id="eclipse的安装"><a href="#eclipse的安装" class="headerlink" title="eclipse的安装"></a>eclipse的安装</h2><h3 id="步骤-1"><a href="#步骤-1" class="headerlink" title="步骤"></a>步骤</h3><p>1）解压到/opt</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">tar</span> -zxvf eclipse-jee-mars-2-linux-gtk-x86_64.tar.gz 
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210625112930.png" alt="image-20210625112922649"></p>
<p>2）启动eclipse，配置jre和server</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> 切换到eclipse目录下
然后再用 ./eclipse 进行启动
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>3）编写Hello World程序并测试成功</p>
<p>4）编写jsp页面并测试成功</p>
<h2 id="mysql的安装和配置"><a href="#mysql的安装和配置" class="headerlink" title="mysql的安装和配置"></a>mysql的安装和配置</h2><p>1、先查看是否已经下载了mysql</p>
<pre class="line-numbers language-sql"><code class="language-sql">rpm <span class="token operator">-</span>qa <span class="token operator">|</span> grep mysql
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果有就删掉</p>
<pre class="line-numbers language-bash"><code class="language-bash">rpm -e <span class="token punctuation">(</span>--nodeps强制删除<span class="token punctuation">)</span> mysql-libs
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2、安装mysql的环境</p>
<pre class="line-numbers language-bash"><code class="language-bash">yum -y <span class="token function">install</span> <span class="token function">make</span> gcc-c++ cmake bsion-devel ncurses-devel
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3、解压mysql包</p>
<pre class="line-numbers language-bash"><code class="language-bash"> <span class="token function">tar</span> -zxvf mysql-5.6.14.tar.gz 
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>4、切换到MySQL的目录下</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cd</span> mysql-5.6.14/ 
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="shell编程"><a href="#shell编程" class="headerlink" title="shell编程"></a>shell编程</h1><h2 id="为什么要学shell编程？"><a href="#为什么要学shell编程？" class="headerlink" title="为什么要学shell编程？"></a>为什么要学shell编程？</h2><p>1）Linux运维工程师再进行对服务器集群管理时，需要编写shell程序来进行服务器的管理。</p>
<p>2）对于JavaEE和python程序员来说，工作需要，需要些shell脚本进行程序或者是服务器的维护，比如编写一个定时备份数据库的脚本。</p>
<p>3）对于大数据程序员来说，需要编写Shell程序来管理集群。</p>
<h2 id="Shell是什么"><a href="#Shell是什么" class="headerlink" title="Shell是什么"></a>Shell是什么</h2><p>shell是一个命令行解释器，它为用户提供一个向Linux内核发送请求以便运行程序的界面系统级程序，用户可以用shell来启动、挂起、停止甚至是编写一些程序。</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210626093328.png" alt="image-20210626093320313"></p>
<h2 id="shell编程快速入门-shell脚本的执行方式"><a href="#shell编程快速入门-shell脚本的执行方式" class="headerlink" title="shell编程快速入门-shell脚本的执行方式"></a>shell编程快速入门-shell脚本的执行方式</h2><h3 id="脚本的要求"><a href="#脚本的要求" class="headerlink" title="脚本的要求"></a>脚本的要求</h3><p>1）脚本以#!/bin/bash开头 （告诉编辑器是用bash来进行解析的）</p>
<p>2）脚本需要有可执行权限</p>
<h3 id="编写第一个shell脚本"><a href="#编写第一个shell脚本" class="headerlink" title="编写第一个shell脚本"></a>编写第一个shell脚本</h3><p>需求说明</p>
<p>创建一个shell脚本，输出hello world！</p>
<p>查看案例： </p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210626093948.png" alt="image-20210626093947711"></p>
<h3 id="脚本的常用执行方式"><a href="#脚本的常用执行方式" class="headerlink" title="脚本的常用执行方式"></a>脚本的常用执行方式</h3><p>方式一：（输入脚本的绝对路径或者相对路径）</p>
<p>1）首先要赋予helloworld.sh脚本的    +x权限  </p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210626094501.png" alt="image-20210626094500814"></p>
<p> 方式二（sh+脚本，<font color='red'>不推荐使用</font>）</p>
<p>说明：不用赋予脚本+x权限，直接执行即可</p>
<p> <img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210626094834.png" alt="image-20210626094834001"></p>
<h2 id="shell的变量"><a href="#shell的变量" class="headerlink" title="shell的变量"></a>shell的变量</h2><h3 id="shell的变量的介绍"><a href="#shell的变量的介绍" class="headerlink" title="shell的变量的介绍"></a>shell的变量的介绍</h3><p>1）Linux  Shell 中的变量分为，<font color='red'>系统变量</font>和<font color='red'>用户自定义变量</font>。</p>
<p>2）系统变量：SHOME 、 $PWD 、$SHELL、 $USER等等</p>
<p>比如：echo $HOME  等等</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210626095649.png" alt="image-20210626095648035"></p>
<p>3）显示当前shell中的所有变量：set</p>
<h3 id="shell变量的定义"><a href="#shell变量的定义" class="headerlink" title="shell变量的定义"></a>shell变量的定义</h3><p>基本语法</p>
<p>1）定义变量：变量=值</p>
<p>2）撤销变量：unset  变量</p>
<p>3）声明静态变量：readonly  变量，注意：不能用unset</p>
<p>快速入门</p>
<p>案例1：定义变量A</p>
<p>案例2：撤销变量A</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210626100740.png" alt="image-20210626100739165"></p>
<p>​    案例3：声明一个只读变量B=2 （<font color='red'>readonly   就相当于Java中的final</font>），不能unset </p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210626101954.png" alt="image-20210626101953724"></p>
<p>案例四：可以把一个变量提升为一个全局环境变量，可供其他shell程序使用</p>
<h3 id="定义变量的规则"><a href="#定义变量的规则" class="headerlink" title="定义变量的规则"></a>定义变量的规则</h3><p>1）变量名称可以由字母数字和下划线组成，但是不能以数字开头。</p>
<p>2）等号两侧不能有空格</p>
<p>3）变量名称一般习惯大写</p>
<h3 id="将命令的返回值赋值给变量（重点）"><a href="#将命令的返回值赋值给变量（重点）" class="headerlink" title="将命令的返回值赋值给变量（重点）"></a>将命令的返回值赋值给变量（重点）</h3><pre class="line-numbers language-shell"><code class="language-shell">A=`ls -la`反引号，运行里面的命令，并把结果返回给变量A
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p> <img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210628103515.png" alt="image-20210628103507936"></p>
<h2 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h2><p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210628103906.png" alt="image-20210628103906011"></p>
<h3 id="基本语法-34"><a href="#基本语法-34" class="headerlink" title="基本语法"></a>基本语法</h3><p>1）export  变量名=变量值     （功能描述：将shell变量输出为环境变量）</p>
<p>2）source    配置文件            （功能描述：让修改后的文件信息立即生效）</p>
<p>3）在另一个shell程序中使用TOMCAT_HOME</p>
<p>注意：在输出TOMCAT_HOME环境变量前，要让起生效</p>
<p><font color='red'>这个是刷新配置文件的意思：source/etc/profile</font></p>
<pre class="line-numbers language-shell"><code class="language-shell">多行注释   :<<! 要注释的内容  !
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210628105154.png" alt="image-20210628105153321"></p>
<h2 id="位置参数变量"><a href="#位置参数变量" class="headerlink" title="位置参数变量"></a>位置参数变量</h2><h3 id="介绍-10"><a href="#介绍-10" class="headerlink" title="介绍"></a>介绍</h3><p>当我们执行一个shell脚本时，如果希望获得命令行的参数信息。就可以使用到位置参数变量。比如：./myshell.sh 100 200 ，这个就是执行shell命令行，可以在myshell脚本中获取到参数信息  （<font color='red'>有点类似于Java方法传参数</font>）</p>
<h3 id="基本语法-35"><a href="#基本语法-35" class="headerlink" title="基本语法"></a>基本语法</h3><p>$n（功能描述：n为数字，$0代表命令本身，$1-$9代表第一到第九个参数，十以上的参数需要用大括号包含，如${10}）</p>
<p>$* （功能描述：这个变量代表命令行中所有参数，<font color='red'>$*把所有的参数看成一个整体</font>）</p>
<p>$@（功能描述：这个变量也代表命令行中的所有参数，<font color='red'>不过$@把每个参数区分对待</font>)</p>
<p>$#（功能描述：这个变量代表命令行中的所有参数的个数）</p>
<h3 id="位置参数变量的应用实例"><a href="#位置参数变量的应用实例" class="headerlink" title="位置参数变量的应用实例"></a>位置参数变量的应用实例</h3><p>案例：编写一个shell脚本positionPara.sh，在脚本中获得命令行中各个参数信息</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210628172432.png" alt="image-20210628172425041"></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210628172520.png" alt="image-20210628172519512"></p>
<h2 id="预定义变量"><a href="#预定义变量" class="headerlink" title="预定义变量"></a>预定义变量</h2><h3 id="基本介绍-21"><a href="#基本介绍-21" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>就是shell设计者事先已经定义好的变量，可以直接在shell脚本中使用。</p>
<h3 id="基本语法-36"><a href="#基本语法-36" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-shell"><code class="language-shell">$$                （功能描述：当前进程的进程号（pid））
$!                （功能描述：后台运行的最后一个进程的进程号（pid））
$?                （功能描述：最后一次执行的命令的返回状态。如果这个变量的值为0，证明上一个命令正确执行；如果这个变量的值为非0（具体是哪个数，由命令自己来决定），则证明上一个命令执行不正确了。）
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="应用实例-34"><a href="#应用实例-34" class="headerlink" title="应用实例"></a>应用实例</h3><p>在一个shell脚本中简单使用一下预定义变量。</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210628214100.png" alt="image-20210628214059047"></p>
<h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><h3 id="基本介绍-22"><a href="#基本介绍-22" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>学习如何在shell中进行运算操作</p>
<h3 id="基本语法-37"><a href="#基本语法-37" class="headerlink" title="基本语法"></a>基本语法</h3><p>1）“$((运算式))”  或 “$[运算式]”</p>
<p>2）expr m  +  n</p>
<p>注意expr运算符间要有空格</p>
<p>3）expr  m  -n</p>
<p>4）expr  \* , / , % 乘，除，取余   （expr ： expression）</p>
<ul>
<li>应用实例</li>
<li><font color='red'>注意在写shell脚本的时候变量和等号之间不要有空格</font></li>
</ul>
<p>案例一：计算（2+3）X4的值</p>
<ol>
<li>$((运算式))<img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210705161642.png" alt="image-20210705161634409"></li>
<li>$[运算式]<img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210705161853.png" alt="image-20210705161851739"></li>
<li>expr<img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210705163238.png" alt="image-20210705163236697"></li>
</ol>
<p>案例二：请求算出命令行两个参数之和<img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210705164141.png" alt="image-20210705164140704"></p>
<h2 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h2><h3 id="基本语法-38"><a href="#基本语法-38" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-shell"><code class="language-shell">[ condition ] (注意condition前后要有空格)
#非空返回true,可使用$?验证(0为true,>1为false)
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="应用实例-35"><a href="#应用实例-35" class="headerlink" title="应用实例"></a>应用实例</h3><pre class="line-numbers language-shell"><code class="language-shell">[ atguigu ]            返回true
[]                  返回false
[ condition ] && echo OK  || echo notok  条件满足,执行后面的语句
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="判断语句"><a href="#判断语句" class="headerlink" title="判断语句"></a>判断语句</h3><ul>
<li>常用的判断条件</li>
</ul>
<p> 1）  两个整数的比较</p>
<pre class="line-numbers language-shell"><code class="language-shell">=字符串的比较
-lt小于  lt=less than
-le小于等于  
-eq等于   eq=equal than
-gt大于   gt=great than
-ge大于等于 ge=great equal
-ne不等于  ne=not equal
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="按照文件所有权进行判断"><a href="#按照文件所有权进行判断" class="headerlink" title="按照文件所有权进行判断"></a>按照文件所有权进行判断</h3><pre class="line-numbers language-bash"><code class="language-bash">-r  有读的权限
-w  有些的权限
-x  有执行的权限
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="按照文件类型进行判断"><a href="#按照文件类型进行判断" class="headerlink" title="按照文件类型进行判断"></a>按照文件类型进行判断</h3><pre class="line-numbers language-bash"><code class="language-bash">-f  文件存在并且是个常规文件
-e  文件存在
-d  文件存在并且是个目录
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="应用实例-36"><a href="#应用实例-36" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：“ok”是否等于“ok”</p>
<p>判断语句：<img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210705181745.png" alt="image-20210705181744621"></p>
<p>案例二：判断23是否大于等于22</p>
<pre class="line-numbers language-shell"><code class="language-shell">这里的结束 fi ，就是把 if 反着写，后面的要学的 case   结束的关键字就是 esac
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210705182352.png" alt="image-20210705182351705"></p>
<p>案例三：判断/root/shell/aaa.txt是否存在</p>
<p>判断语句：</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210705182924.png" alt="image-20210705182923634"></p>
<h1 id="shell-流程控制"><a href="#shell-流程控制" class="headerlink" title="shell 流程控制"></a>shell 流程控制</h1><h2 id="if判断"><a href="#if判断" class="headerlink" title="if判断"></a>if判断</h2><h3 id="基本语法-39"><a href="#基本语法-39" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">if</span> <span class="token punctuation">[</span> 条件判断式 <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">then</span>
    程序
    <span class="token keyword">elif</span> <span class="token punctuation">[</span> 条件判断式 <span class="token punctuation">]</span>
    <span class="token keyword">then</span>
    程序 
<span class="token keyword">fi</span>    
或者
<span class="token keyword">if</span> <span class="token punctuation">[</span> 条件判断式 <span class="token punctuation">]</span>        
    <span class="token keyword">then</span>
    程序
    <span class="token keyword">elif</span> <span class="token punctuation">[</span> 条件判断式 <span class="token punctuation">]</span>
    <span class="token keyword">then</span>
    程序 
<span class="token keyword">fi</span>    
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意事项：（1）[  条件判断式  ] ，中括号和条件判断式之间必须有空格</p>
<p>（2）推荐使用第二种方式</p>
<h3 id="应用案例-4"><a href="#应用案例-4" class="headerlink" title="应用案例"></a>应用案例</h3><p>#案例：请编写一个shell程序，如果输入的参数大于等于60，则输出”及格了“ ，如果小于60，则输出“不及格”  <img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210705202738.png" alt="image-20210705202737022"></p>
<h2 id="case语句"><a href="#case语句" class="headerlink" title="case语句"></a>case语句</h2><h3 id="基本语法-40"><a href="#基本语法-40" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-shell"><code class="language-shell">case $变量名  in   
"值1"）
如果变量名等于值1，则执行程序1
;;
"值2"）
如果变量等于值2,则执行程序2
;;
...省略其他分支...
*)
如果变量的值都不是以上的值，则执行此程序
;;
esac
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="应用案例-5"><a href="#应用案例-5" class="headerlink" title="应用案例"></a>应用案例</h3><p>案例1：当命令行参数是1时，输出“周一”，是2时，输出“周二”，其他情况输出“other”</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210705214123.png" alt="image-20210705214122831"></p>
<h2 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h2><h3 id="基本语法（这个相当于增强for循环，foreach）"><a href="#基本语法（这个相当于增强for循环，foreach）" class="headerlink" title="基本语法（这个相当于增强for循环，foreach）"></a>基本语法（这个相当于增强for循环，foreach）</h3><pre class="line-numbers language-shell"><code class="language-shell">for  变量  in 值1  值2 值3 ...
do
程序
done
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="应用实例-37"><a href="#应用实例-37" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例1：打印命令行输入的参数【会使用到$*  $@】</p>
<p><font color='red'>这里的$i表示的是引用上面的i的意思</font></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210705220258.png" alt="image-20210705220256804"></p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210706164642.png" alt="image-20210706164634006"></p>
<h3 id="基本语法-41"><a href="#基本语法-41" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-shell"><code class="language-shell">for ((初始值;循环控制条件;变量变化))
do
程序
done
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="应用实例-38"><a href="#应用实例-38" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例1：从一加到一百的值输出显示[这里可以看出$* 和 $@的区别]</p>
<pre class="line-numbers language-shell"><code class="language-shell">#!/bin/bash
#求1到100的值
#定义一个结果变量
sum=0
for ((i=1;i <= 100 ;i++ ))

do
sum=$[ $sum+i ]
done
echo "sum=$sum"
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210706165737.png" alt="image-20210706165734779"></p>
<h2 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h2><h3 id="基本语法-42"><a href="#基本语法-42" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-shell"><code class="language-shell">while  [条件判断式]
do
程序
done
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="应用实例-39"><a href="#应用实例-39" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：从命令行输出一个数n，统计从1+…+n的值是多少？</p>
<h2 id="读取控制台的输入"><a href="#读取控制台的输入" class="headerlink" title="读取控制台的输入"></a>读取控制台的输入</h2><h3 id="基本语法-43"><a href="#基本语法-43" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-shell"><code class="language-shell">read (选项)  (参数)
选项：
-p ：指定读取时的提示符号
-t ：指定读取时等待的时间(秒),如果没有在指定的时间内输入，就不再等待了
参数
变量：指定读取值的变量名
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="应用实例-40"><a href="#应用实例-40" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：从控制台读取一个num值。</p>
<p>​    <img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210706172934.png" alt="image-20210706172933098"></p>
<p>案例二：读取控制台输入一个num值，在10秒内输入。</p>
<p>  <img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210706172957.png" alt="image-20210706172956207"></p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="函数介绍"><a href="#函数介绍" class="headerlink" title="函数介绍"></a>函数介绍</h3><p>shell编程和其它语言一样，有系统函数，也可以有自定义函数。在系统函数中，就介绍这两个。</p>
<h3 id="系统函数"><a href="#系统函数" class="headerlink" title="系统函数"></a>系统函数</h3><ul>
<li>bashname基本语法</li>
</ul>
<p>功能：返回完整路径下最后 / 部分，常用于获取文件名</p>
<pre class="line-numbers language-shell"><code class="language-shell">basename [pathname]  [suffix]
basename [string]  [suffix]  功能描述：basename命令会删掉所有的前缀包括最后一个('/')
字符,然后将字符显示出来
选项
suffix 为后缀，如果suffix被指定了，basename会将pathname或string中的suffix去掉
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="应用实例-41"><a href="#应用实例-41" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：请返回    /home/aaa/test.txt的”test.txt“部分</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210707101506.png" alt="image-20210707101457436"></p>
<h3 id="dirname基本语法"><a href="#dirname基本语法" class="headerlink" title="dirname基本语法"></a>dirname基本语法</h3><p>功能：返回完整路径最后 / 的前面的部分，常用于返回路径部分</p>
<p>dirname文件绝对路径(功能描述：从给定的包含绝对路径的文件中去除文件名（非目录部分），然后返回剩下的路径（目录部分）)</p>
<h3 id="应用实例-42"><a href="#应用实例-42" class="headerlink" title="应用实例"></a>应用实例</h3><p>案例一：请返回/home/aaa/test.txt的/home/aaa</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210707102534.png" alt="image-20210707102533380"></p>
<h3 id="自定义函数"><a href="#自定义函数" class="headerlink" title="自定义函数"></a>自定义函数</h3><ul>
<li><strong>基本语法</strong></li>
</ul>
<pre class="line-numbers language-shell"><code class="language-shell">[ function ] funname [()]
{
    Action;
    [return int;]

}
调用直接写函数名： funname
注意[]这个是可选的，里面的内容可写可不写
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>应用实例</strong></li>
</ul>
<p>案例1：计算输出两个参数的和，getSum</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210707104023.png" alt="image-20210707104022527"></p>
<h2 id="shell编程的综合案例"><a href="#shell编程的综合案例" class="headerlink" title="shell编程的综合案例"></a>shell编程的综合案例</h2><h3 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h3><ol>
<li>每天凌晨2:10备份数据库atguiguDB到/data/backup/db</li>
<li>备份开始和备份结束能够给出相应的提示信息</li>
<li>备份后的文件要求以备份时间为文件名，并打成.tar.gz的形式，比如： 2018-03-12_230201.tar.gz</li>
<li>在备份的同时，检查是否有10天前的备份的数据库文件，如果有就将其删除</li>
</ol>
<p>编写一个shell脚本。</p>
<p>思路分析：</p>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210707154849.png" alt="image-20210707154848109"></p>
<p>代码实现：</p>
<pre class="line-numbers language-shell"><code class="language-shell">#!/bin/bash
#完成数据库的定时备份
#定义备份的路径
BACKUP=/data/backup/db
#当前的时间作为文件名
DATETIME=$(date +%Y_%m_%d_%H%M%S)
#可以输出变量调试
#echo $DATETIME
#!/bin/bash
#完成数据库的定时备份
#定义备份的路径
BACKUP=/data/backup/db
#!/bin/bash
#完成数据库的定时备份
#定义备份的路径
BACKUP=/data/backup/db
#当前的时间作为文件名
DATETIME=$(date +%Y_%m_%d_%H%M%S)
#可以输出变量调试
#echo $DATETIME
echo "======开始备份======"
echo "======备份的路径是$BACKUP/$DATETIME.tar.gz ======"

#主机
HOST=localhost
#用户名
DB_USER=root
#密码
DB_PWD=root
#备份数据库名
DATABASE=atguiguDB
#创建备份的路径
#如果备份的文件夹存在就使用，否则就创建
#mkdir -p ：递归创建目录，即使上级目录不存在，会按目录层级自动创建目录
 [ ! -d "$BACKUP/$DATETIM"   ] && mkdir -p "$BACKUP/$DATETIME"
#执行mysql的备份数据库的指令
mysqldump   -u${DB_USER} -P${DB_PWD}   --host=$HOST   $DATABASE | gzip  >  $BACKUP/$DATETIME.sql.gz
#打包备份文件
cd $BACKUP
tar -zcvf $DATETIME.tar.gz  $DATETIME
#删除临时目录
rm -rf $BACKUP/$DATETIME
#删除十天前的备份文件
#下面那条指令的意思：find是查找指令，-m表示按照时间查找+10表示十天前的 
#-name 表示按照名称查找以.tar.gz结尾的文件   
#exec代表着执行 执行后面的  rm -rf {} \; 就是删除找到的那些文件，这个是一个固定的写法
find $BCAKUP  -m  +10  -name  "*.tar.gz" -exec  rm -rf {} \;
echo "======备份文件成功======"
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://qlwy.oss-cn-shenzhen.aliyuncs.com/img/20210707194758.png" alt="image-20210707194750770"></p>
<p><font color='red'>2020/7/7Linux学习完结撒花</font></p>
<p>77事变84周年，吾辈当自强</p>
<h1 id="Linux中的一些补充知识"><a href="#Linux中的一些补充知识" class="headerlink" title="Linux中的一些补充知识"></a>Linux中的一些补充知识</h1><h2 id="软链接和硬连接"><a href="#软链接和硬连接" class="headerlink" title="软链接和硬连接"></a>软链接和硬连接</h2><p>一个硬连接仅仅是一个文件名。（一个文件可以有好几个文件名，只有将最后一个文件名从磁盘上删除，才能把这个文件删掉。文件名的个数是由ls(1)来确定的。所有的文件名都处于同一个状态，也就没有什么“源名字”之说。通常文件系统里的一个文件的所有名字包含着一样的数据信息，不过这样也不是必需的。）一个软连接（或符号连接）是完全不同的：它是一个包含了路径信息的小小的指定文件。因此，软连接可以指向不同文件系统里的文件（比如由NFS装载的不同机器文件系统上的文件），甚至可以指向一个不一定确实存在的文件。在软连接文件被访问（系统调用open(2)或stat(2)）的时候，操作系统用该文件所包含的路径替换该文件的访问介入点，从而实现对所指文件的访问。（用命令rm(1)和unlink(2)可以删除连接，但  不是删除该文件所指向的文件。系统指定调用lstat(2)和read‐link(2)                    来读取连接文件与其所指文件的状态。到底是对软连接文件操作，还是对被指向文件操作，由于不同操作系统件存在不同的系统调用，而存在着差异。）</p>
<h2 id="在Linux中启动程序"><a href="#在Linux中启动程序" class="headerlink" title="在Linux中启动程序"></a>在Linux中启动程序</h2><ol>
<li>进入到bin文件夹中使用./脚本文件</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">./zkServer.sh start
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="2">
<li>使用bin文件夹外面使用bin/zkServer.sh</li>
</ol>
<pre class="line-numbers language-bash"><code class="language-bash">bin/zkServer.sh 
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="3">
<li>直接配置环境变量</li>
</ol>
<h1 id="Linux中的一些坑"><a href="#Linux中的一些坑" class="headerlink" title="Linux中的一些坑"></a>Linux中的一些坑</h1><p>如果网络出现问题，可以使用</p>
<pre class="line-numbers language-bash"><code class="language-bash">systemctl start NetworkM
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--more--></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://losserlong.github.io/2022/01/18/mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="Xiang">
      <meta itemprop="description" content="今日长缨在手，何时缚住苍龙？">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/18/mysql/" class="post-title-link" itemprop="url">mysql事务隔离级别</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-18 16:31:34" itemprop="dateCreated datePublished" datetime="2022-01-18T16:31:34+08:00">2022-01-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-19 09:57:53" itemprop="dateModified" datetime="2022-01-19T09:57:53+08:00">2022-01-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
                </span>
			  <span>℃</span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="事务隔离级别-图文详解"><a href="#事务隔离级别-图文详解" class="headerlink" title="事务隔离级别(图文详解)"></a>事务隔离级别(图文详解)</h1><h2 id="什么是事务"><a href="#什么是事务" class="headerlink" title="什么是事务?"></a>什么是事务?</h2><p>事务是逻辑上的一组操作，要么都执行，要么都不执行。</p>
<p>事务最经典也经常被拿出来说例子就是转账了。假如小明要给小红转账1000元，这个转账会涉及到两个关键操作就是：将小明的余额减少1000元，将小红的余额增加1000元。万一在这两个操作之间突然出现错误比如银行系统崩溃，导致小明余额减少而小红的余额没有增加，这样就不对了。事务就是保证这两个关键操作要么都成功，要么都要失败。</p>
<h3 id="常用的事务控制语法"><a href="#常用的事务控制语法" class="headerlink" title="常用的事务控制语法"></a>常用的事务控制语法</h3><pre class="line-numbers language-mysq"><code class="language-mysq">- 事务开始
begin;
- 事务提交，提交后就会写入物理磁盘中去
commit;
- 事务回滚，事务提交后，无法回滚
rollback;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="事务的四大特性（ACID）"><a href="#事务的四大特性（ACID）" class="headerlink" title="事务的四大特性（ACID）"></a>事务的四大特性（ACID）</h2><p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118173945.png" alt="image-20211231191231001"></p>
<ol>
<li><strong><font color='red'>原子性（atomicity）</font>：</strong> <strong>事务是最小的执行单位，不允许分割。</strong>事务的原子性确保动作要么全部完成，要么完全不起作用；</li>
<li><strong><font color='red'>一致性（consistency）</font>：</strong> <strong>执行事务前后，数据保持一致</strong>，例如转账业务中，无论事务是否成功，转账者和收款人的总额应该是不变的；</li>
<li><strong><font color='red'>隔离性（isolation）</font>：</strong> 并发访问数据库时，一个用户的事务不被其他事务所干扰，<strong>各并发事务之间数据库是独立的；</strong></li>
<li><strong><font color='red'>持久性（durability）</font>：</strong> <strong>一个事务被提交之后。它对数据库中数据的改变是持久的</strong>，即使数据库发生故障也不应该对其有任何影响。</li>
</ol>
<h2 id="关闭mysql的事务自动提交"><a href="#关闭mysql的事务自动提交" class="headerlink" title="关闭mysql的事务自动提交"></a>关闭mysql的事务自动提交</h2><pre class="line-numbers language-mysql"><code class="language-mysql">SET autocommit = 0|1|ON|OFF;
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>对取值的说明：</p>
<p>值为 0 和值为 OFF：关闭事务自动提交。如果关闭自动提交，用户将会一直处于某个事务中，只有提交或回滚后才会结束当前事务，重新开始一个新事务。<br>值为 1 和值为 ON：开启事务自动提交。如果开启自动提交，则每执行一条 SQL 语句，事务都会提交一次。</p>
<h2 id="数据库的隔离级别"><a href="#数据库的隔离级别" class="headerlink" title="数据库的隔离级别"></a>数据库的隔离级别</h2><h3 id="事务隔离级别的定义"><a href="#事务隔离级别的定义" class="headerlink" title="事务隔离级别的定义"></a>事务隔离级别的定义</h3><p>事务指定一个隔离级别，该隔离级别<strong>定义一个事务必须与由其他事务进行的资源或数据更改相隔离的程度。</strong>隔离级别从允许的并发副作用（例如，脏读或幻读的角度进行描述。</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">- 查看隔离级别,8.0版本之前的，用SELECT @@tx_isolation
select @@transaction_isolation;

- 修改隔离级别
set session transaction isolation level  READ UNCOMMITTED;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="隔离级别的分类"><a href="#隔离级别的分类" class="headerlink" title="隔离级别的分类"></a>隔离级别的分类</h3><p><strong>读未提交(READ-UNCOMMITTED)：</strong>A事务操作后没有执行commit提交命令，但是B事务也能察觉到A操作的数据变化，此时B重新查询，则能查询出A操作后的最新数据，但是当A事务rollback回滚后，A操作的数据其实没有变化，这时候B处的数据就变成了脏数据(容易导致脏读情形产生)</p>
<p>设置隔离级别为读未提交</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">- 设置隔离级别
set session transaction isolation level    read uncommitted;
 - 查看隔离级别
select  @@transaction_isolation;
 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>读已提交(不可重复读 read committed)oracle默认的隔离级别</strong>:读已提交，表示只有执行了commit命令后，才能得知数据的变化，A修改了数据，没有提交，B不会察觉到数据的变化。这样虽然会避免脏读，但是会出现，当A读取某一条数据时候，B正在对该数据进行操作(修改)，但是B操作并没有结束，因此此时数据并没有发生变化，但是A在B事务提交前已经执行完了，那就会出现数据不一致现象，这种问题叫做不可重复读。</p>
<p>设置隔离级别为读已提交</p>
<pre class="line-numbers language-mysql"><code class="language-mysql"> - 设置隔离级别
set session transaction isolation level    read committed;
  - 查看隔离级别
select  @@transaction_isolation;

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>可重复读(repeatable read mysql 的默认隔离级别)</strong></p>
<p>可重复读与不可重复读很容易搞混淆，<strong>可重复读侧重于有没有进行行增加减少，也就是新增和删除，而不可重复读侧重于修改操作，不影响行数。</strong>可重复读是采用锁行形式，因为是锁行，所以无法保证对行数的操作限制隔离，只能保证当前锁住的行隔离影响。</p>
<p><strong>串行化</strong></p>
<p>最可靠的事务隔离级别。“写”会加“写锁”，“读”会加“读锁”。当出现读写锁冲突的时候，后访问的事务必须等前一个事务执行完成，才能继续执行。事务 100% 隔离，可避免脏读、不可重复读、幻读的发生。因为串行化是锁表，因此虽然隔离级别最高，但是消耗资源最大</p>
<p>mysql数据库默认的事务隔离级别是<strong>可重复读（REPEATABLE-READ ）</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash">mysql<span class="token operator">></span> <span class="token keyword">select</span> @@transaction_isolation<span class="token punctuation">;</span>
+-------------------------+
<span class="token operator">|</span> @@transaction_isolation <span class="token operator">|</span>
+-------------------------+
<span class="token operator">|</span> REPEATABLE-READ         <span class="token operator">|</span>
+-------------------------+
1 row <span class="token keyword">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span>0.00 sec<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>修改数据库的事务隔离级别为<strong>不可重复读 READ-UNCOMMITTED</strong> </p>
<pre class="line-numbers language-bash"><code class="language-bash">mysql<span class="token operator">></span> <span class="token keyword">select</span> @@transaction_isolation<span class="token punctuation">;</span>
+-------------------------+
<span class="token operator">|</span> @@transaction_isolation <span class="token operator">|</span>
+-------------------------+
<span class="token operator">|</span> READ-UNCOMMITTED        <span class="token operator">|</span>
+-------------------------+
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这下面是MySQL8的事务隔离级别，MySQL5的话可重读读，还是会出现幻读</p>
<table>
<thead>
<tr>
<th>事务隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody><tr>
<td>读未提交（read-uncommitted）</td>
<td>是</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>不可重复读（read-committed）</td>
<td>否</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>可重复读（repeatable-read）</td>
<td>否</td>
<td>否</td>
<td><strong>否</strong></td>
</tr>
<tr>
<td>串行化（serializable）</td>
<td>否</td>
<td>否</td>
<td>否</td>
</tr>
</tbody></table>
<h2 id="并发事务带来的问题"><a href="#并发事务带来的问题" class="headerlink" title="并发事务带来的问题"></a>并发事务带来的问题</h2><p>在典型的应用程序中，多个事务并发运行，经常会操作相同的数据来完成各自的任务（多个用户对统一数据进行操作）。并发虽然是必须的，但可能会导致以下的问题。</p>
<ul>
<li><strong>脏读（Dirty read）:</strong> 当一个事务正在访问数据并且对数据进行了修改，而这种修改还没有提交到数据库中，这时另外一个事务也访问了这个数据，然后使用了这个数据。因为这个数据是还没有提交的数据，然后后一个事务进行回滚，将数据变成之前的值，那么前一个事务读到的这个数据是“脏数据”，依据“脏数据”所做的操作可能是不正确的。<font color='red'><strong>（读取未提交数据）</strong></font></li>
</ul>
<table>
<thead>
<tr>
<th align="center">时间顺序</th>
<th>转账事务</th>
<th>取款事务</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td></td>
<td>开始事务</td>
</tr>
<tr>
<td align="center">2</td>
<td>开始事务</td>
<td></td>
</tr>
<tr>
<td align="center">3</td>
<td></td>
<td>查询账户余额为2000元</td>
</tr>
<tr>
<td align="center">4</td>
<td></td>
<td>取款1000元，余额被更改为1000元</td>
</tr>
<tr>
<td align="center">5</td>
<td>查询账户余额为1000元（产生脏读）</td>
<td></td>
</tr>
<tr>
<td align="center">6</td>
<td></td>
<td>取款操作发生未知错误，事务回滚，余额变更为2000元</td>
</tr>
<tr>
<td align="center">7</td>
<td>转入2000元，余额被更改为3000元（脏读的1000+2000）</td>
<td></td>
</tr>
<tr>
<td align="center">8</td>
<td>提交事务</td>
<td></td>
</tr>
<tr>
<td align="center">备注</td>
<td>按照正确逻辑，此时账户余额应该为4000元</td>
<td></td>
</tr>
</tbody></table>
<p>注意：这里要修改mysql的事务隔离级别为<strong>不可重复读（ READ-UNCOMMITTED ）</strong></p>
<p>account表中的原始状态</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118173951.png" alt="image-20211231200932520"></p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118173954.png" alt="image-20211231201320508"></p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118173957.png" alt="image-20211231201342895"></p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118173959.png" alt="image-20211231201534124"></p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118174001.png" alt="image-20211231201641543"></p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118174002.png" alt="image-20220101115134146"></p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118174005.png" alt="image-20220101115237036"></p>
<ul>
<li><strong>丢失修改（Lost to modify）:</strong> 指在一个事务读取一个数据时，另外一个事务也访问了该数据，那么在第一个事务中修改了这个数据后，第二个事务也修改了这个数据。这样第一个事务内的修改结果就被丢失，因此称为丢失修改。 例如：事务1读取某表中的数据A=20，事务2也读取A=20，事务1修改A=A-1，事务2也修改A=A-1，最终结果A=19，事务1的修改被丢失。</li>
</ul>
<ul>
<li><strong>不可重复读（Unrepeatableread）:</strong> 指在一个事务内多次读同一数据。在这个事务还没有结束时，另一个事务也访问该数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改导致第一个事务两次读取的数据可能不太一样。这就发生了在一个事务内两次读到的数据是不一样的情况，因此称为不可重复读。**<font color='red'>（前后多次读取，数据内容不一致）</font>**</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118174008.png" alt="image-20220101144933767"></p>
<img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118174009.png" alt="image-20220101150808461" />

<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118174011.png" alt="image-20220101150929999"></p>
<ul>
<li><strong>幻读（Phantom read）:</strong> 幻读与不可重复读类似。它发生在一个事务（T1）读取了几行数据，接着另一个并发事务（T2）插入了一些数据时。在随后的查询中，第一个事务（T1）就会发现<strong>多了一些原本不存在的记录</strong>，就好像发生了幻觉一样，所以称为幻读。**<font color='red'>（前后多次读取，数据总量不一致）</font>**</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://losserlong.github.io/2022/01/16/juc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="Xiang">
      <meta itemprop="description" content="今日长缨在手，何时缚住苍龙？">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/16/juc/" class="post-title-link" itemprop="url">juc简单学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-16 18:36:04" itemprop="dateCreated datePublished" datetime="2022-01-16T18:36:04+08:00">2022-01-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-19 09:59:02" itemprop="dateModified" datetime="2022-01-19T09:59:02+08:00">2022-01-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/juc/" itemprop="url" rel="index"><span itemprop="name">juc</span></a>
                </span>
			  <span>℃</span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="juc并发编程"><a href="#juc并发编程" class="headerlink" title="juc并发编程"></a>juc并发编程</h1><h2 id="juc简介"><a href="#juc简介" class="headerlink" title="juc简介"></a>juc简介</h2><p>java.util .concurrent，Java并发包</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172801.png" alt="image-20220103094918335"></p>
<h2 id="笔试题目"><a href="#笔试题目" class="headerlink" title="笔试题目"></a>笔试题目</h2><ol>
<li>手写单例模式</li>
<li>手写冒泡排序</li>
<li>生产者消费者变种题目</li>
</ol>
<h2 id="进程-线程回顾"><a href="#进程-线程回顾" class="headerlink" title="进程/线程回顾"></a>进程/线程回顾</h2><h3 id="进程-线程是什么？"><a href="#进程-线程是什么？" class="headerlink" title="进程/线程是什么？"></a>进程/线程是什么？</h3><p><strong>进程：</strong>进程是一个具有一定独立功能的程序关于某个数据集合的一次运行活动。它是操作系统动态执行的基本单元，在传统的操作系统中，进程既是基本的分配单元，也是基本的执行单元。（<strong>简单来说，进程就是后台运行的一个程序</strong>）</p>
<p><strong>线程：</strong>  <strong>通常在一个进程中可以包含若干个线程，当然一个进程中至少有一个线程</strong>，不然没有存在的意义。线程可以利用进程所拥有的资源，在引入线程的操作系统中，通常都是把进程作为分配资源的基本单位，而把<strong>线程作为独立运行和独立调度的基本单位</strong>，由于线程比进程更小，基本上不拥有系统资源，故对它的调度所付出的开销就会小得多，能更高效的提高系统多个程序间并发执行的程度。</p>
<h3 id="进程-线程例子？"><a href="#进程-线程例子？" class="headerlink" title="进程/线程例子？"></a>进程/线程例子？</h3><p> 使用QQ，查看进程一定有一个QQ.exe的<strong>进程</strong>，我可以用qq和A文字聊天，和B视频聊天，给C传文件，给D发一段语言，QQ支持录入信息的搜索。</p>
<p>大四的时候写论文，用word写论文，同时用QQ音乐放音乐，同时用QQ聊天，多个进程。</p>
<p>word如没有保存，停电关机，再通电后打开word可以恢复之前未保存的文档，word也会检查你的拼写，两个<strong>线程</strong>：容灾备份，语法检查</p>
<h3 id="什么是并发？什么是并行？"><a href="#什么是并发？什么是并行？" class="headerlink" title="什么是并发？什么是并行？"></a>什么是并发？什么是并行？</h3><p><strong>并发：</strong>同一时刻多个线程在访问<strong>同一个资源</strong>，多个线程对一个点<br>      例子：小米9今天上午10点，限量抢购<br>            春运抢票<br>            电商秒杀…<br>**并行： ** <strong>多项工作一起执行</strong>，之后再汇总<br>      例子：泡方便面，电水壶烧水，一边撕调料倒入桶中</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172810.png" alt="image-20220114130053636"></p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172814.png" alt="image-20220103110849404"></p>
<h2 id="thread-start"><a href="#thread-start" class="headerlink" title="thread.start"></a>thread.start</h2><p>thread.start表示线程进入<strong>就绪状态</strong>（不是立刻进行调用），是在调用run方法是在cup和操作系统对这个<strong>线程进行调度</strong>的时候。</p>
<h2 id="Thread的状态"><a href="#Thread的状态" class="headerlink" title="Thread的状态"></a>Thread的状态</h2><p>waite()和sleep()的比较，wait放开去睡，放开了手里的锁。</p>
<p>sleep()捏紧了手去睡，醒了还有手里的锁。</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172819.png" alt="image-20220103164224117"></p>
<pre><code>/**
 * Thread state for a thread which has not yet started.
 */
NEW,
</code></pre>
<pre><code>/**
 * Thread state for a runnable thread.  A thread in the runnable
 * state is executing in the Java virtual machine but it may
 * be waiting for other resources from the operating system
 * such as processor.
 */
RUNNABLE,
</code></pre>
<pre><code>/**
 * Thread state for a thread blocked waiting for a monitor lock.
 * A thread in the blocked state is waiting for a monitor lock
 * to enter a synchronized block/method or
 * reenter a synchronized block/method after calling
 * &#123;@link Object#wait() Object.wait&#125;.
 */
BLOCKED,
</code></pre>
<h3 id="WAITING和TIMED-WAITING的区别"><a href="#WAITING和TIMED-WAITING的区别" class="headerlink" title="WAITING和TIMED_WAITING的区别"></a>WAITING和TIMED_WAITING的区别</h3><p>WAITING这个是一直等，死死的等，俗称不见不散</p>
<pre class="line-numbers language-java"><code class="language-java">等待线程的线程状态。

由于调用了一个

以下方法：

<span class="token comment" spellcheck="true">/**
 * Thread state for a waiting thread.
 * A thread is in the waiting state due to calling one of the
 * following methods:
 * &lt;ul>
 *   &lt;li>{@link Object#wait() Object.wait} with no timeout&lt;/li>
 *   &lt;li>{@link #join() Thread.join} with no timeout&lt;/li>
 *   &lt;li>{@link LockSupport#park() LockSupport.park}&lt;/li>
 * &lt;/ul>
 *
 * &lt;p>A thread in the waiting state is waiting for another thread to
 * perform a particular action.
 *
 * For example, a thread that has called &lt;tt>Object.wait()&lt;/tt>
 * on an object is waiting for another thread to call
 * &lt;tt>Object.notify()&lt;/tt> or &lt;tt>Object.notifyAll()&lt;/tt> on
 * that object. A thread that has called &lt;tt>Thread.join()&lt;/tt>
 * is waiting for a specified thread to terminate.
 */</span>
WAITING<span class="token punctuation">,</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>TIMED_WAITING是定时等待，俗称过时不候</p>
<pre class="line-numbers language-java"><code class="language-java">具有指定等待时间的等待线程的线程状态。

由于调用其中一个线程，线程处于定时等待状态

具有指定正等待时间的以下方法：

<span class="token comment" spellcheck="true">/**
 * Thread state for a waiting thread with a specified waiting time.
 * A thread is in the timed waiting state due to calling one of
 * the following methods with a specified positive waiting time:
 * &lt;ul>
 *   &lt;li>{@link #sleep Thread.sleep}&lt;/li>
 *   &lt;li>{@link Object#wait(long) Object.wait} with timeout&lt;/li>
 *   &lt;li>{@link #join(long) Thread.join} with timeout&lt;/li>
 *   &lt;li>{@link LockSupport#parkNanos LockSupport.parkNanos}&lt;/li>
 *   &lt;li>{@link LockSupport#parkUntil LockSupport.parkUntil}&lt;/li>
 * &lt;/ul>
 */</span>
TIMED_WAITING<span class="token punctuation">,</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="经典卖票问题"><a href="#经典卖票问题" class="headerlink" title="经典卖票问题"></a>经典卖票问题</h2><p>一般多线程问题可以简化为：线程        操作（资源类暴露的方法）        资源类</p>
<h3 id="版本1使用匿名内部类"><a href="#版本1使用匿名内部类" class="headerlink" title="版本1使用匿名内部类"></a>版本1使用匿名内部类</h3><p><strong>资源类</strong>：这里也可以使用同步方法或者同步代码块（但是粒度太大）</p>
<p>这里使用的Lock的实现类ReentrantLock()可重入锁，相比synchronized同步锁来说更加灵活，</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * 资源类：票
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Ticket1</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// 设定初始值为30张</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// ReentrantLock可重入锁</span>
    <span class="token keyword">private</span> Lock lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 操作,这里使用synchronized就相当于把这个saleTicket全部都锁住了，粒度太大
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saleTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>


        <span class="token comment" spellcheck="true">// 上锁</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 先判断number是否大于0</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>number <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ThreadName = "</span> <span class="token operator">+</span> Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t卖出第："</span> <span class="token operator">+</span> <span class="token punctuation">(</span>number<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t还剩下"</span> <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"票已经卖完"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 释放锁</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>抢票类</strong></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Created with IntelliJ IDEA.
 * @Author: pzx
 * @Date: 2022/01/03    10:10
 * @Version:1.0
 *
 * 题目：三个售票员     卖出      30张票
 *多线程编程的企业套路+模板
 *
 * 1.在高内聚低耦合的前提下：线程         操作（资源类对外暴露的调用方法）          资源类
 *
 *抢票类
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaleTicket</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// main程序一切入口</span>




        <span class="token comment" spellcheck="true">// 创建两个线程t1，t2</span>
<span class="token comment" spellcheck="true">//        Thread t1 = new Thread();</span>
<span class="token comment" spellcheck="true">//        Thread t2 = new Thread();</span>

        <span class="token comment" spellcheck="true">//Thread(Runnable target, String name)</span>
<span class="token comment" spellcheck="true">//        // 启动线程</span>
<span class="token comment" spellcheck="true">//        t1.start();</span>
<span class="token comment" spellcheck="true">//        t2.start();</span>


        <span class="token comment" spellcheck="true">// 下面三个线程(A、B、C)操作同一个资源类</span>
        Ticket1 ticket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ticket1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 匿名内部类</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">40</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    ticket<span class="token punctuation">.</span><span class="token function">saleTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">40</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    ticket<span class="token punctuation">.</span><span class="token function">saleTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">40</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    ticket<span class="token punctuation">.</span><span class="token function">saleTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="版本二使用lambda表达式"><a href="#版本二使用lambda表达式" class="headerlink" title="版本二使用lambda表达式"></a>版本二使用lambda表达式</h3><p>Lambda Express 使用的场景：当一个接口中只有一个抽象方法，其他的默认方法有几个无所谓。</p>
<p>Lambda Express表达式的小口诀： <strong>拷贝小括号（小括号是接口中的方法），写死右箭头，落地大括号。</strong></p>
<p>@FunctionalInterface注解声明式函数式接口，其实可以不用加，在底层默认给加上了</p>
<p>Foo接口</p>
<pre><code>/**
 * 有且只有一个抽象方法的接口称为“函数式接口”
 */
@FunctionalInterface
interface Foo &#123;
//    public void sayHello();

    int add(int a, int b);


    default int div(int a, int b) &#123;
        return a / b;
    &#125;

    /**
     * 静态方法实现
     * @param a
     * @param b
     * @return
     */
    static int mv(int a, int b) &#123;

        return a * b;
    &#125;


&#125;
</code></pre>
<p>使用Foo接口中的Lambda表达式</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LambdaExpressDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>


    <span class="token comment" spellcheck="true">/*        Foo foo = new Foo() {
            @Override
            public void sayHello() {
                System.out.println("*******************hello java 2022");
            }
        };*/</span>

<span class="token comment" spellcheck="true">/*
        Foo foo = () -> {
            System.out.println("*******************hello java lambda");

        };


        foo.sayHello();
*/</span>

        <span class="token comment" spellcheck="true">// 可以把方法的参数类型省略</span>
        Foo foo <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>

            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"a+b = "</span> <span class="token operator">+</span> a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        foo<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span><span class="token function">div</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Foo<span class="token punctuation">.</span><span class="token function">mv</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="线程交互问题：笔试题目之交替打印0和1"><a href="#线程交互问题：笔试题目之交替打印0和1" class="headerlink" title="线程交互问题：笔试题目之交替打印0和1"></a>线程交互问题：笔试题目之交替打印0和1</h2><p>这个就是<strong>生产者和消费者模型。</strong></p>
<p>笔试题目：<br>题目:现在两个线程，可以操作初始值为零的一个变量,<br>实现一个线程对该变量加，一个线程对该变量减i，<br>实现交替，来10轮，变量初始值为零。</p>
<h3 id="两个线程交替打印1-0版"><a href="#两个线程交替打印1-0版" class="headerlink" title="两个线程交替打印1.0版"></a>两个线程交替打印1.0版</h3><p>这里有一个坑，但是两个线程的时候不会出现，当线程多的时候就会出现。这里的判断条件不能用if，只能用while。</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Created with IntelliJ IDEA.
 * @Author: pzx
 * @Date: 2022/01/03    18:29
 * @Version:1.0
 * 笔试题目：
 * 题目:现在两个线程，可以操作初始值为零的一个变量,
 * 实现一个线程对该变量加，一个线程对该变量减i，
 * 实现交替，来10轮，变量初始值为零。
 *
 *
 * // 1.高内聚低耦合的前提下，线程       操作      资源类
 *    2.   判断/干活/通知
 *
 * 生产者消费者复习
 *
 *
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadWaitNotifyDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        AirCondition airCondition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AirCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment" spellcheck="true">/**
         * 生产蛋糕，做加法
         */</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    airCondition<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment" spellcheck="true">/**
         * 消费蛋糕，做减法
         */</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    airCondition<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/**
 * 资源类
 *  1.0版
 */</span>
<span class="token keyword">class</span> <span class="token class-name">AirCondition</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>


    <span class="token comment" spellcheck="true">/**
     * 对number进行加1
     * 这里有三步，
     * 1、判断number的值是否为0
     * 2、做加法
     * 3、通知消费者来吃蛋糕
     *
     * 生产者线程
     *
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>


        <span class="token comment" spellcheck="true">// 1.判断</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// 2.干活</span>
        number<span class="token operator">++</span><span class="token punctuation">;</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 3.通知(唤醒等待的线程)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 对number进行减1
     * synchronized加上同步锁
     * 就相当于，消费者去买蛋糕，如果没有蛋糕，就先得等待
     * 消费者线程
     *
     *
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>


        <span class="token comment" spellcheck="true">// 1.判断，等于0，没有蛋糕，就得先等</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>number <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// 2.干活</span>
        number<span class="token operator">--</span><span class="token punctuation">;</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 3.通知(唤醒等待的线程)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="两个线程交替打印2-0版（变成四个线程）"><a href="#两个线程交替打印2-0版（变成四个线程）" class="headerlink" title="两个线程交替打印2.0版（变成四个线程）"></a>两个线程交替打印2.0版（变成四个线程）</h3><p>这里升级为四个线程进行操作，一个加一个减，一个加一个减</p>
<p>/*        if (number != 0) {</p>
<pre class="line-numbers language-java"><code class="language-java">        <span class="token comment" spellcheck="true">//  A可能没有执行下面的wait的时候，线程调度的时候就停止了，</span>
        <span class="token comment" spellcheck="true">//  但是他苏醒过来了之后，没有进行判断，因为number可能已经加成1了(下面的消费者也一样)</span>
        <span class="token comment" spellcheck="true">// 一直等待进入阻塞状态，当有其他线程notify()或者notifyAll()就被唤醒了</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token operator">*</span><span class="token operator">/</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadWaitNotifyDemo2</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        AirCondition1 ac1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AirCondition1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 消费者线程A</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ac1<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment" spellcheck="true">// 消费者线程B</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ac1<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment" spellcheck="true">// 消费者线程C</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ac1<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment" spellcheck="true">// 消费者线程D</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    ac1<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"D"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">/**
 * 资源类
 * 2.0版
 */</span>
<span class="token keyword">class</span> <span class="token class-name">AirCondition1</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>


    <span class="token comment" spellcheck="true">/**
     * 对number进行加1
     * 这里有三步，
     * 1、判断number的值是否为0
     * 2、做加法
     * 3、通知消费者来吃蛋糕
     *
     * 生产者线程
     *
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>


        <span class="token comment" spellcheck="true">/**
         * sleep不会释放线程的所有权(锁)而wait会，所以下面配合synchronized使用
         *
         * 这个式调用无参的wait
         * 导致当前线程等待，直到另一个线程调用该对象的notify()方法或notifyAll()方法。
         * 换句话说，这个方法的行为就好像简单地执行呼叫wait(0) 。
         *
         *
         * wait()
         * 当前的线程必须拥有该对象的显示器。 线程释放此监视器的所有权(锁)，并等待直到发生以下两种情况之一：
         *
         * 另一个线程通知等待该对象的监视器的线程通过调用notify方法或notifyAll方法来唤醒。
         * 由timeout毫秒加nanos纳秒参数指定的超时时间已过。
         *
         *
         *
         * 像在一个参数版本中，中断和虚假唤醒是可能的，并且该方法应该始终在循环中使用：
         *
         *   synchronized (obj) {
         *          while (&lt;condition does not hold>)
         *              obj.wait(timeout, nanos);
         *          ... // Perform action appropriate to condition
         *      }
         *
         *
         */</span>
        <span class="token comment" spellcheck="true">// 1.判断</span>


        <span class="token comment" spellcheck="true">// 注意这里不能用if进行判断，如果使用if的话会出现虚假唤醒，因为if只判断一次（这个是最主要原因）</span>
<span class="token comment" spellcheck="true">/*        if (number != 0) {

            //  A可能没有执行下面的wait的时候，线程调度的时候就停止了，
            //  但是他苏醒过来了之后，没有进行判断，因为number可能已经加成1了(下面的消费者也一样)
            // 一直等待进入阻塞状态，当有其他线程notify()或者notifyAll()就被唤醒了
            this.wait();
        }*/</span>


        <span class="token comment" spellcheck="true">// 1.判断</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 一直等待进入阻塞状态，当有其他线程notify()或者notifyAll()就被唤醒了</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token comment" spellcheck="true">// 2.干活</span>
        number<span class="token operator">++</span><span class="token punctuation">;</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"生产了数据:"</span> <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 3.通知(唤醒等待的线程)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 对number进行减1
     * synchronized加上同步锁
     * 就相当于，消费者去买蛋糕，如果没有蛋糕，就先得等待
     * 消费者线程
     *
     *
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>


        <span class="token comment" spellcheck="true">// 1.判断，等于0，没有蛋糕，就得先等</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token comment" spellcheck="true">// 2.干活</span>
        number<span class="token operator">--</span><span class="token punctuation">;</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"消费了数据:"</span> <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 3.通知(唤醒等待的线程)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172832.png" alt="image-20220104161856205"></p>
<h3 id="改编题目"><a href="#改编题目" class="headerlink" title="改编题目"></a>改编题目</h3><p>题目内容</p>
<pre><code>多线程之间按顺序调用，实现A-&gt;B-&gt;C三个线程启动，要求如下:
AA打印5次，BB打10次，CC打印15次接着  (这里又线程之间的通信,这里是精确通知)
AA打印5次，BB打印10次，CC打印15次
</code></pre>
<p>由于这里是三个线程进行打印而且还有顺序，通过使用标志位加Condition接口中的signal();实现精准通知。当A线程进入执行完打印操作之后，将标志位进行改变，就精准通知B线程。同理B完成之后通知C，C然后再通知A实现A-&gt;B-&gt;C（其实都是number标志位起了作用）</p>
<p><strong>资源类的代码如下</strong></p>
<ul>
<li>第一种使用Lock锁</li>
</ul>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * 资源类
 * 作业：将三个方法合并成一个方法
 */</span>
<span class="token keyword">class</span> <span class="token class-name">ShareResource</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 1:A  2:B   3:C   标志位1对于A,2对应B,3对应C</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 设定标志位的初始值为1</span>
    <span class="token comment" spellcheck="true">// lock就相当于锁，而下面的condition就相当于钥匙，一把锁配三把钥匙</span>
    <span class="token keyword">private</span> Lock lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> Condition condition1 <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> Condition condition2 <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> Condition condition3 <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 打印五次
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token comment" spellcheck="true">// 1.判断</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// 进行等待</span>
                condition1<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">// 2.干活</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":\t"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">// 3.通知</span>
            <span class="token comment" spellcheck="true">// 将标志位进行更改</span>
            number <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// 这里精准唤醒2线程</span>
            <span class="token comment" spellcheck="true">// 唤醒condition2锁了的线程（唤醒2线程）</span>
            condition2<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * 打印十次
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print10</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token comment" spellcheck="true">// 1.判断</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// 进行等待</span>
                condition2<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">// 2.干活</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":\t"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">// 3.通知</span>
            <span class="token comment" spellcheck="true">// 将标志位进行更改</span>
            number <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 唤醒等待的线程 （唤醒3线程）</span>
            condition3<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * 打印十五次
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print15</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token comment" spellcheck="true">// 1.判断</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// 进行等待</span>
                condition3<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">// 2.干活</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">15</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":\t"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">// 3.通知</span>
            <span class="token comment" spellcheck="true">// 将标志位进行更改</span>
            number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 唤醒等待的线程（唤醒1线程）</span>
            condition1<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>第二种使用同步方法</li>
</ul>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Created with IntelliJ IDEA.
 * @Author: pzx
 * @Date: 2022/01/07    9:15
 * @Version:1.0
 * 也可以用synchronized同步方法和wait和notifyAll，其实就是number标志位起了作用
 *
 */</span>
<span class="token keyword">class</span> <span class="token class-name">AirCondition3</span><span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// 1代表A ，   2代表B    3代表C</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">print5s</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment" spellcheck="true">// 判断</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t\t"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        number <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">print10s</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment" spellcheck="true">// 判断</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t\t"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        number <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">print15s</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment" spellcheck="true">// 判断</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">15</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t\t"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadWaitNotifyDemo1</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        AirCondition3 airCondition2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AirCondition3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                airCondition2<span class="token punctuation">.</span><span class="token function">print5s</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"线程A"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                airCondition2<span class="token punctuation">.</span><span class="token function">print10s</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"线程B"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">15</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                airCondition2<span class="token punctuation">.</span><span class="token function">print15s</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"线程C"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="使用lock替换synchronized"><a href="#使用lock替换synchronized" class="headerlink" title="使用lock替换synchronized"></a>使用lock替换<strong>synchronized</strong></h2><p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172836.png" alt="image-20220104163122288"></p>
<p>将synchronized同步方法换成Lock锁，Lock更加灵活，<strong>synchronized使用的是Object类中wait和notify/notifyAll。</strong>而在Lock中<code>Lock</code>实现提供比使用<code>synchronized</code>方法和语句可以获得的更广泛的锁定操作。  它们允许更灵活的结构化，可能具有完全不同的属性，并且可以支持多个相关联的对象<code>Condition</code>。</p>
<p><code>Condition</code>因素出<code>Object</code>监视器方法（ <a href="../../../../java/lang/Object.html#wait--"><code>wait</code></a> ， <a href="../../../../java/lang/Object.html#notify--"><code>notify</code></a>和<a href="../../../../java/lang/Object.html#notifyAll--"><code>notifyAll</code></a>  ）成不同的对象，以得到具有多个等待集的每个对象，通过将它们与使用任意的组合的效果<code>Lock</code>实现。 <code>Lock</code>替换<code>synchronized</code>方法和语句的使用，  <code>Condition</code>取代了对象监视器方法的使用。 <code>Condition</code>使用的是<code>await()</code> 和<code>signal()</code> /<code>signalAll()</code>对应Object类的<strong>wait和notify/notifyAll。</strong></p>
<p><strong>资源类和操作类的代码。</strong></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Created with IntelliJ IDEA.
 * @Author: pzx
 * @Date: 2022/01/04    16:49
 * @Version:1.0
 *
 * 将锁换成Lock
 * 1.高内聚低耦合的前提下，线程       操作      资源类
 * 2.   判断/干活/通知
 * 3.   多线程交互的过程中，必须要防止多线程的虚假唤醒，也即(判断使用while，不能用if)
 * (在方法的判断中不许用if，只能用while)
 * 4.   注意标志位的修改和定位
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadWaitNotifyDemo2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        AirCondition2 airCondition2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AirCondition2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">10</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    airCondition2<span class="token punctuation">.</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"线程A"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">10</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    airCondition2<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"线程B"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">10</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    airCondition2<span class="token punctuation">.</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"线程C"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">10</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    airCondition2<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"线程D"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">AirCondition2</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> Lock lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> Condition condition <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>


    <span class="token comment" spellcheck="true">// 生产者对number的值进行加1</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>

        <span class="token comment" spellcheck="true">// 对资源进行上锁</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 1.判断</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">//    this.wait();</span>
                condition<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">// 2.干活</span>
            <span class="token operator">++</span>number<span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"生产了"</span> <span class="token operator">+</span><span class="token string">"\t"</span><span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 通知</span>
<span class="token comment" spellcheck="true">//            this.notify();</span>
            condition<span class="token punctuation">.</span><span class="token function">signalAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 对资源进行释放锁</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">// 生产者对number的值进行减1</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>

        <span class="token comment" spellcheck="true">// 对资源进行上锁</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 1.判断</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">//    this.wait();</span>
                condition<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">// 2.干活</span>
            number<span class="token operator">--</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"消费了"</span> <span class="token operator">+</span><span class="token string">"\t"</span><span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 通知</span>
<span class="token comment" spellcheck="true">//            this.notify();</span>
            condition<span class="token punctuation">.</span><span class="token function">signalAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 对资源进行释放锁</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="多线程8锁"><a href="#多线程8锁" class="headerlink" title="多线程8锁"></a>多线程8锁</h2><pre class="line-numbers language-text"><code class="language-text">题目：多线程8锁
    其实下面就是看synchronized锁的是什么对象
    普通同步方法锁的就是this这个当前对象，而不是锁住这个单独的synchronized方法，也就是说同一时间段，只能有一个线程进入当前类，访问一个synchronized方法
    静态同步方法锁的就是类.Class这个对象也就是类对象，同时去复习一下static关键字
    普通方法没有加synchronized就不会上锁
    对于同步方法块，锁是Synchonized括号里配置的对象
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>A 一个对象里面如果有多个synchronized方法，某一个时刻内，只要一个线程去调用其中的一个synchronized方法了，
其它的线程都只能等待，换句话说，某一个时刻内，只能有唯一一个线程去访问这些synchronized方法
锁的是当前对象this，被锁定后，其它的线程都不能进入到当前对象的其它的synchronized方法
 
加个普通方法后发现和同步锁无关
换成两个对象后，不是同一把锁了，情况立刻变化。
 
 
synchronized实现同步的基础：Java中的每一个对象都可以作为锁。
具体表现为以下3种形式。
对于普通同步方法，锁是当前实例对象。
对于静态同步方法，锁是当前类的Class对象。
对于同步方法块，锁是Synchonized括号里配置的对象
 
当一个线程试图访问同步代码块时，它首先必须得到锁，退出或抛出异常时必须释放锁。
 
也就是说如果一个实例对象的非静态同步方法获取锁后，该实例对象的其他非静态同步方法必须等待获取锁的方法释放锁后才能获取锁，
可是别的实例对象的非静态同步方法因为跟该实例对象的非静态同步方法用的是不同的锁，
所以毋须等待该实例对象已获取锁的非静态同步方法释放锁就可以获取他们自己的锁。
 
所有的静态同步方法用的也是同一把锁——类对象本身，
这两把锁是两个不同的对象，所以静态同步方法与非静态同步方法之间是不会有竞态条件的。
但是一旦一个静态同步方法获取锁后，其他的静态同步方法都必须等待该方法释放锁后才能获取锁，
而不管是同一个实例对象的静态同步方法之间，
还是不同的实例对象的静态同步方法之间，只要它们同一个类的实例对象！
 
 
 
</code></pre>
<ul>
<li>1、标准访问，先打印短信还是邮件</li>
</ul>
<p><code>邮件</code></p>
<ul>
<li>2、 停4秒在短信方法内，先打印短信还是邮件</li>
</ul>
<p><code>邮件</code></p>
<ul>
<li>3 、普通的hello方法，是先打短信还是hello</li>
</ul>
<p><code>hello</code></p>
<ul>
<li>4 、现在有两部手机，先打印短信还是邮件</li>
</ul>
<p><code>短信</code></p>
<ul>
<li>5 、两个静态同步方法，1部手机，先打印短信还是邮件</li>
</ul>
<p><code>邮件</code></p>
<ul>
<li>6 、两个静态同步方法，2部手机，先打印短信还是邮件</li>
</ul>
<p><code>邮件</code></p>
<ul>
<li>7 、1个静态同步方法，1个普通同步方法，1部手机，先打印短信还是邮件</li>
</ul>
<p><code>短信</code></p>
<ul>
<li>8 、1个静态同步方法，1个普通同步方法，2部手机，先打印短信还是邮件</li>
</ul>
<p><code>短信</code></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Lock8</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>


        Phone phone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Phone phone2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            phone<span class="token punctuation">.</span><span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"线程A"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 由于这里线程睡了0.2秒钟，线程A就已经完成启动和调度了</span>
        Thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
<span class="token comment" spellcheck="true">//                phone.sendMsg();</span>


            phone2<span class="token punctuation">.</span><span class="token function">sendMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//            phone.hello();</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"线程B"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token punctuation">{</span>


    <span class="token comment" spellcheck="true">/**
     * 发送邮件的方法
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 线程睡四秒钟</span>
            TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"---------------sendEmail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 发送短信方法
     */</span>
    <span class="token keyword">public</span>  <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sendMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"---------------sendMsg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * 普通方法，没有加锁，就不用争抢锁资源
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"-------------------------hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="交替打印100以内的奇数和偶数"><a href="#交替打印100以内的奇数和偶数" class="headerlink" title="交替打印100以内的奇数和偶数"></a>交替打印100以内的奇数和偶数</h2><p>这里有一个大坑，你要先将另一把锁唤醒之后，然后将自己进入等待状态。不然的话，会出现死锁，连哥哥线程都在等待对方唤醒。</p>
<h3 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h3><p><strong>是指多个进程在运行过程中因争夺资源而造成的一种僵局，</strong>当进程处于这种僵持状态时，若无外力作用，它们都将无法再向前推进。 因此我们举个例子来描述，如果此时有一个线程T1，按照先锁R1再获得锁R2的的顺序获得锁，而在此同时又有另外一个线程T2，按照先锁T2再锁T1的顺序获得锁。    </p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172842.png" alt="image-20220106100435845"></p>
<h3 id="第一种使用Lock锁"><a href="#第一种使用Lock锁" class="headerlink" title="第一种使用Lock锁"></a>第一种使用Lock锁</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        ShareSource1 ss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShareSource1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>ss<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"线程A"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>ss<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">"线程B"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ShareSource1</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> Lock lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> Condition condition <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment" spellcheck="true">// 判断</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t\t"</span> <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
                number<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">//    线程死锁描述的是这样一种情况：多个线程同时被阻塞，它们中的一个或者全部都在等待某个资源被释放。由于线程被无限期地阻塞，因此程序不可能正常终止.</span>
                <span class="token comment" spellcheck="true">// 不能先wait，因为假如先wait之后，B再进来也是wait然后他俩就相互等待，就会死锁</span>
<span class="token comment" spellcheck="true">//                this.wait();</span>
<span class="token comment" spellcheck="true">//                this.notify();</span>
                <span class="token comment" spellcheck="true">// 为了避免死锁，得先将进行唤醒，然后再去等待</span>

                condition<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                condition<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="第二种使用synchronized静态代码块"><a href="#第二种使用synchronized静态代码块" class="headerlink" title="第二种使用synchronized静态代码块"></a>第二种使用synchronized静态代码块</h3><p>​    </p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test3</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ShareSource2 ss2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShareSource2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                ss2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"线程A"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                ss2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"线程B"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ShareSource2</span> <span class="token punctuation">{</span>


    <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>

        <span class="token comment" spellcheck="true">// 判断</span>

        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">while</span> <span class="token punctuation">(</span>number <span class="token operator">&lt;=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t\t"</span> <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
                number<span class="token operator">++</span><span class="token punctuation">;</span>


                <span class="token comment" spellcheck="true">//    线程死锁描述的是这样一种情况：多个线程同时被阻塞，它们中的一个或者全部都在等待某个资源被释放。由于线程被无限期地阻塞，因此程序不可能正常终止.</span>
                <span class="token comment" spellcheck="true">// 不能先wait，因为假如先wait之后，B再进来也是wait然后他俩就相互等待，就会死锁</span>
<span class="token comment" spellcheck="true">//                this.wait();</span>
<span class="token comment" spellcheck="true">//                this.notify();</span>
                <span class="token comment" spellcheck="true">// 为了避免死锁，得先将进行唤醒，然后再去等待</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="集合中的一些比较"><a href="#集合中的一些比较" class="headerlink" title="集合中的一些比较"></a>集合中的一些比较</h1><h2 id="请举例说明集合类是不安全的"><a href="#请举例说明集合类是不安全的" class="headerlink" title="请举例说明集合类是不安全的"></a>请举例说明集合类是不安全的</h2><h3 id="ArrayList线程不安全"><a href="#ArrayList线程不安全" class="headerlink" title="ArrayList线程不安全"></a>ArrayList线程不安全</h3><p>ArrayList、HashMap、HashSet都是线程不安全的</p>
<pre class="line-numbers language-java"><code class="language-java">List<span class="token operator">&lt;</span>String<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// Collections.synchronizedList(new ArrayList&lt;String>());</span>


<span class="token comment" spellcheck="true">// 出现异常java.util.ConcurrentModificationException</span>
<span class="token comment" spellcheck="true">// 多线程条件下，既要读又要写</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">30</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol>
<li><p><strong>故障现象</strong></p>
<p>java.util.ConcurrentModificationException并发修改异常</p>
</li>
<li><p><strong>导致原因</strong><br>多线程条件下，既要读又要写</p>
</li>
<li><p><strong>解决方案</strong></p>
<p>3.1 用Vector,它的底层在add方法加了同步锁<br>3.2 Collections.synchronizedList(new ArrayList<String>());<br>3.3 new CopyOnWriteArrayList&lt;&gt;();    </p>
</li>
<li><p>将代码块抽取成方法的快捷键<strong>Ctrl+Alt+m</strong></p>
</li>
</ol>
<p>ArrayList的add方法</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span>E e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span>size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// Increments modCount!!</span>
    elementData<span class="token punctuation">[</span>size<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="在多线程条件下不使用ArrayList"><a href="#在多线程条件下不使用ArrayList" class="headerlink" title="在多线程条件下不使用ArrayList"></a>在多线程条件下不使用ArrayList</h3><pre class="line-numbers language-java"><code class="language-java">   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token comment" spellcheck="true">/*        // 将数组转List
        List&lt;String> list = Arrays.asList("a", "b", "c");
        // 方法的引用
        list.forEach(System.out ::println);*/</span>

        <span class="token comment" spellcheck="true">// 生成当前的时间戳</span>
        <span class="token comment" spellcheck="true">//    System.currentTimeMillis();</span>

        <span class="token comment" spellcheck="true">// 第一种方法：（线程不安全） new ArrayList&lt;>();</span>
        <span class="token comment" spellcheck="true">// 第二种方法（不推荐）   new Vector&lt;>();</span>
        <span class="token comment" spellcheck="true">// 第三种：使用Collections.synchronizedList将线程不安全的的List转换成线程安全的</span>
        <span class="token comment" spellcheck="true">// 第四种：使用  new CopyOnWriteArrayList&lt;>();</span>


        <span class="token comment" spellcheck="true">// HashMap线程不安全使用ConcurrentHashMap</span>

        List<span class="token operator">&lt;</span>String<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// Collections.synchronizedList(new ArrayList&lt;String>());</span>


        <span class="token comment" spellcheck="true">// 出现异常java.util.ConcurrentModificationException</span>
        <span class="token comment" spellcheck="true">// 多线程条件下，既要读又要写</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">30</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>



    <span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="java-util-concurrent"><a href="#java-util-concurrent" class="headerlink" title="java.util.concurrent"></a>java.util.concurrent</h3><p>多线程条件下，一般使用这个报下面的类，后面的三个都是java.util.concurrent并发包下面的。</p>
<ul>
<li>ArrayList   ——&gt;    CopyOnWriteArrayList</li>
<li>HashSet    ——&gt;    CopyOnWriteArraySet</li>
<li>HashMap   ——&gt;    ConcurrentHashMap</li>
</ul>
<h3 id="回忆集合的基础知识"><a href="#回忆集合的基础知识" class="headerlink" title="回忆集合的基础知识"></a>回忆集合的基础知识</h3><p>HashSet的底层数据结构是HashMap，存的是map的key，它的value是一个写死的Object的常量</p>
<p>HashSet的add方法是调用的HashMap的put方法</p>
<p>HashMap的底层1.8是<strong>Node数组+链表+红黑树，1.7是哈希表</strong></p>
<p>jdk1.8</p>
<p>构造求一个空的HashMap，默认的初始容量是（16），默认的负载因子是（0.75）</p>
<p>HashMap和HashSet都是无序的</p>
<p>无序性：无序性不等于随机性。指的是存储的数据在底层数组中并非按照数组索引的顺序进行添加的，而使根据数值的哈希值决定的。</p>
<p>ArrayList扩容是扩容为原来的1.5倍</p>
<p>HashMap扩容是扩大到原来的两倍，在使用的时候可以将他的初始容量设大，这样就可以避免它反复扩容了。</p>
<h3 id="CopyOnWriteArrayList"><a href="#CopyOnWriteArrayList" class="headerlink" title="CopyOnWriteArrayList"></a>CopyOnWriteArrayList</h3><ul>
<li><strong>java.util.concurrent.CopyOnWriteArrayList<E></strong> </li>
</ul>
<p><font color='orange'><strong>写时复制技术原理</strong></font></p>
<p><strong>CopyOnWrite容器即写时复制的容器。</strong>往一个容器添加元素的时候，不直接往当前容器Object[]添加，<br>而是先将当前容器Object[]进行Copy，复制出一个新的容器Object[] newElements，然后向新的容器Object[] newElements里添加元素。<br>添加元素后，再将原容器的引用指向新的容器setArray(newElements)。<br>这样做的好处是可以对CopyOnWrite容器进行并发的读，而不需要加锁，因为当前容器不会添加任何元素。<br>所以CopyOnWrite容器也是一种读写分离的思想，读和写不同的容器。</p>
<hr>
<p>CopyOnWriteArrayList的原理：简单的来说当A线程去写的时候，先复制一份1.1版的，然后自己用这个1.1版的去写，如果其他的线程要读的时候就去读1.0版本的，当A写完之后再发布1.1版的。<strong>（其实也就是读写分离思想）</strong></p>
<p>CopyOnWriteArrayList是线程安全的，下面是它的add方法的源码，它会先将传入的集合进行复制一份，然后将新的</p>
<pre class="line-numbers language-java"><code class="language-java">   <span class="token comment" spellcheck="true">/** The array, accessed only via getArray/setArray. */</span>
    <span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * Gets the array.  Non-private so as to also be accessible
     * from CopyOnWriteArraySet class.
     */</span>
    <span class="token keyword">final</span> Object<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> array<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * Sets the array.
     */</span>
    <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">setArray</span><span class="token punctuation">(</span>Object<span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        array <span class="token operator">=</span> a<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
   

<span class="token comment" spellcheck="true">/**
     * Appends the specified element to the end of this list.
     *
     * @param e element to be appended to this list
     * @return {@code true} (as specified by {@link Collection#add})
     */</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span>E e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> ReentrantLock lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 这里就是复制一份新的，然后用Object数组进行接收</span>
        Object<span class="token punctuation">[</span><span class="token punctuation">]</span> elements <span class="token operator">=</span> <span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 获得原来的集合的长度</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> elements<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 对elements数组进行扩容长度加一得到新的newElements</span>
        Object<span class="token punctuation">[</span><span class="token punctuation">]</span> newElements <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 将要添加的e，添加到数组的最后</span>
        newElements<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 再将newElements重新设置回CopyOnWriteArrayList对象中，就是相当于1.1版本的替换1.0版本的 </span>
        <span class="token function">setArray</span><span class="token punctuation">(</span>newElements<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 添加完成</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 释放锁</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>HashMap的put方法，put里面其实装的是一个个的Node结点</p>
<pre class="line-numbers language-java"><code class="language-java">    <span class="token comment" spellcheck="true">/**
     * Associates the specified value with the specified key in this map.
     * If the map previously contained a mapping for the key, the old
     * value is replaced.
     *
     * @param key key with which the specified value is to be associated
     * @param value value to be associated with the specified key
     * @return the previous value associated with &lt;tt>key&lt;/tt>, or
     *         &lt;tt>null&lt;/tt> if there was no mapping for &lt;tt>key&lt;/tt>.
     *         (A &lt;tt>null&lt;/tt> return can also indicate that the map
     *         previously associated &lt;tt>null&lt;/tt> with &lt;tt>key&lt;/tt>.)
     */</span>
    <span class="token keyword">public</span> V <span class="token function">put</span><span class="token punctuation">(</span>K key<span class="token punctuation">,</span> V value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment" spellcheck="true">/**
     * Implements Map.put and related methods.
     *
     * @param hash hash for key
     * @param key the key
     * @param value the value to put
     * @param onlyIfAbsent if true, don't change existing value
     * @param evict if false, the table is in creation mode.
     * @return previous value, or null if none
     */</span>
    <span class="token keyword">final</span> V <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> K key<span class="token punctuation">,</span> V value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">,</span>
                   <span class="token keyword">boolean</span> evict<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// HashMap的put装的是一个个的Node结点</span>
        Node<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> Node<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> p<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> i<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> null <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            n <span class="token operator">=</span> <span class="token punctuation">(</span>tab <span class="token operator">=</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> tab<span class="token punctuation">[</span>i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> null<span class="token punctuation">)</span>
            tab<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            Node<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span> e<span class="token punctuation">;</span> K k<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
                <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> p<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                e <span class="token operator">=</span> p<span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>
                e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>TreeNode<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">></span><span class="token punctuation">)</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTreeVal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> tab<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>binCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        p<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">>=</span> TREEIFY_THRESHOLD <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// -1 for 1st</span>
                            <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
                        <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    p <span class="token operator">=</span> e<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// existing mapping for key</span>
                V oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent <span class="token operator">||</span> oldValue <span class="token operator">==</span> null<span class="token punctuation">)</span>
                    e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
                <span class="token function">afterNodeAccess</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token operator">++</span>modCount<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>size <span class="token operator">></span> threshold<span class="token punctuation">)</span>
            <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">afterNodeInsertion</span><span class="token punctuation">(</span>evict<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="Callable接口"><a href="#Callable接口" class="headerlink" title="Callable接口"></a>Callable接口</h1><h2 id="复习获得多线程的方式"><a href="#复习获得多线程的方式" class="headerlink" title="复习获得多线程的方式"></a>复习获得多线程的方式</h2><p>面试题：获得多线程的方法几种？</p>
<ul>
<li>继承Thread类</li>
</ul>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Created with IntelliJ IDEA.
 * @Author: pzx
 * @Date: 2022/01/06    19:39
 * @Version:1.0
 * 实现多线程的方式二继承Thread类，重写run方法
 *
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadDemo1</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        MyThread1 t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span><span class="token string">"线程1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>t1<span class="token punctuation">,</span><span class="token string">"线程2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/*
        t1.setName("线程A");
        t1.start();
        MyThread1 t2 = new MyThread1();
        t2.setName("线程B");
        t2.start();*/</span>

    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MyThread1</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> ticket <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ticket <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t\t"</span> <span class="token operator">+</span> ticket<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ticket<span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>实现Runnable接口</li>
</ul>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Created with IntelliJ IDEA.
 * @Author: pzx
 * @Date: 2022/01/06    19:35
 * @Version:1.0
 * 实现多线程的方式一
 * 实现Runnable接口
 */</span>
<span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>number<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">"\t\t"</span><span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    number<span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>




<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        MyThread myThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>myThread<span class="token punctuation">,</span><span class="token string">"线程A"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>myThread<span class="token punctuation">,</span><span class="token string">"线程B"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Callable的简单使用"><a href="#Callable的简单使用" class="headerlink" title="Callable的简单使用"></a>Callable的简单使用</h2><ul>
<li>实现Callable接口</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172853.png" alt="image-20220108212709371"></p>
<p><strong>实现多线程的方式三之实现Callable接口</strong>，之前两种太简单了就不写了</p>
<p><strong>get方法</strong>一般请放在最后一行,因为如果实现的Callable类中有阻塞的话，它会等它执行完才会执行下面的</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Created with IntelliJ IDEA.
 * @Author: pzx
 * @Date: 2022/01/06    20:11
 * @Version:1.0
 *
 * 选中那个接口，然后使用Ctrl+Alt+U查看这个类或者接口的类图
 * get方法一般请放在最后一行,因为如果实现的Callable类中有阻塞的话
 * 它会等它执行完才会执行下面的
 *在·
 */</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>Callable<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>FutureTask<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>TimeUnit<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 多线程实现方法三实现Callable接口
 */</span>
<span class="token keyword">class</span> <span class="token class-name">MyThread2</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token operator">&lt;</span>Integer<span class="token operator">></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Integer <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\t\t  hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1024</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CallableDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>

        <span class="token comment" spellcheck="true">// Interface RunnableFuture&lt;V> 是Runnable的子接口 。FutureTask实现了RunnableFuture接口、</span>
        <span class="token comment" spellcheck="true">// FutureTask的一个构造方法   FutureTask(Callable&lt;V> callable)</span>
        <span class="token comment" spellcheck="true">// Thread(Runnable target, String name) ， 在Thread的构造器中只要传入Runnable或者Runnable的子接口或者实现类即可</span>
        <span class="token comment" spellcheck="true">// 这里主要是多态的的思想</span>
        FutureTask<span class="token operator">&lt;</span>Integer<span class="token operator">></span> futureTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">/**
         * 打印结果
         * hello world
         * 1024
         * main计算完成、
         * 这里只会打印一次hello world，因为它有缓存
         */</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">,</span><span class="token string">"线程a"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">,</span><span class="token string">"线程b"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"计算完成"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p> 面试题:callable接口与runnable接口的区别？</p>
<p> 答：（1）是否有返回值<br>       （2）是否抛异常<br>       （3）落地方法不一样，一个是run，一个是call</p>
<h2 id="FutureTask"><a href="#FutureTask" class="headerlink" title="FutureTask"></a>FutureTask</h2><p>未来的任务，用它就干一件事，异步调用<br>main方法就像一个冰糖葫芦，一个个方法由main串起来。<br>但解决不了一个问题：正常调用挂起堵塞问题</p>
<p>  <img src="C:\Users\losser\AppData\Roaming\Typora\typora-user-images\image-20220108213632391.png" alt="image-20220108213632391"></p>
<h3 id="例子："><a href="#例子：" class="headerlink" title="例子："></a>例子：</h3><p>（1）老师上着课，口渴了，去买水不合适，讲课线程继续，我可以单起个线程找班长帮忙买水，<br>水买回来了放桌上，我需要的时候再去get。<br>（2）4个同学，A算1+20,B算21+30,C算31*到40,D算41+50，是不是C的计算量有点大啊，<br>FutureTask单起个线程给C计算，我先汇总ABD，最后等C计算完了再汇总C，拿到最终结果<br>（3）高考：会做的先做，不会的放在后面做</p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>在主线程中需要执行比较耗时的操作时，但又不想阻塞主线程时，可以把这些作业交给Future对象在后台完成，<br>当主线程将来需要时，就可以通过Future对象获得后台作业的计算结果或者执行状态。</p>
<p>一般FutureTask多用于耗时的计算，主线程可以在完成自己的任务后，再去获取结果。</p>
<p>仅在计算完成时才能检索结果；如果计算尚未完成，则阻塞 get 方法。一旦计算完成，<br>就不能再重新开始或取消计算。get方法而获取结果只有在计算完成时获取，否则会一直阻塞直到任务转入完成状态，<br>然后会返回结果或者抛出异常。 </p>
<p><strong>只计算一次</strong><br><strong>get方法放到最后</strong></p>
<p>FutureTask类图 <img src="C:\Users\losser\AppData\Roaming\Typora\typora-user-images\image-20220107131432435.png" alt="image-20220107131432435"></p>
<h1 id="JUC强大的辅助类讲解"><a href="#JUC强大的辅助类讲解" class="headerlink" title="JUC强大的辅助类讲解"></a>JUC强大的辅助类讲解</h1><h2 id="CountDownLatch-减少计数"><a href="#CountDownLatch-减少计数" class="headerlink" title="CountDownLatch 减少计数"></a>CountDownLatch 减少计数</h2><h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><ul>
<li>CountDownLatch主要有两个方法，当一个或多个线程调用await方法时，这些线程会阻塞。</li>
<li>其它线程调用countDown方法会将计数器减1(调用countDown方法的线程不会阻塞)，</li>
<li>当计数器的值变为0时，因await方法阻塞的线程会被唤醒，继续执行。</li>
</ul>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>生活中的实例就是晚自习，班长关门，也就是说要等所有的同学出去之后，班长才去关门，减少计数</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Created with IntelliJ IDEA.
 * @Author: pzx
 * @Date: 2022/01/07    15:19
 * @Version:1.0
 * CountDownLatch
 * 这个类似生活中的例子：晚自习，班长关门，也就是说要等所有的同学出去之后，班长才去关门
 * 减少计数
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CountDownLatchDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 构造一个以给定计数 CountDownLatch CountDownLatch。 java.util.concurrent</span>
        CountDownLatch countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"离开教室"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">//countDown() 减少锁存器的计数，如果计数达到零，释放所有等待的线程。</span>
                countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// 导致当前线程等到锁存器计数到零，除非线程是 interrupted,</span>
        <span class="token comment" spellcheck="true">// 其实也就是说当里面的count减少到0就不用等待了，唤醒线程</span>
        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t班长关闭教室"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">closeDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"离开教室"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t班长关闭教室"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="CyclicBarrier-循环栅栏"><a href="#CyclicBarrier-循环栅栏" class="headerlink" title="CyclicBarrier  循环栅栏"></a>CyclicBarrier  循环栅栏</h2><h3 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h3><p><strong>CyclicBarrier</strong> 的字面意思是可循环（Cyclic）使用的屏障（Barrier）。它要做的事情是，让一组线程到达一个屏障（也可以叫同步点）时被阻塞， 直到最后一个线程到达屏障时，屏障才会开门，所有被屏障拦截的线程才会继续干活。线程进入屏障通过CyclicBarrier的await()方法。</p>
<p>这个可以举一个简单的例子就<strong>是，集齐七颗龙珠召唤神龙，还有就是开会，必须要等到人到齐了才能开会。</strong></p>
<h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Created with IntelliJ IDEA.
 * @Author: pzx
 * @Date: 2022/01/07    15:55
 * @Version:1.0
 * java.util.concurrent  CyclicBarrier
 * 其实这个有点像生活中的例子：开会，还有七龙珠，集齐七颗龙珠召唤神龙
 * 开会必须等待所有人都到齐了才行
 *
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CyclicBarrierDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        CyclicBarrier cb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"召唤神龙"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">/**
         * 等待所有parties已经在这个障碍上调用了await 。
         * 如果当前线程不是最后一个线程，那么它被禁用以进行线程调度，并且处于休眠状态，直到发生下列事情之一：
         * 最后一个线程到达; 要么
         * 一些其他线程当前线程为interrupts ; 要么
         * 一些其他线程interrupts其他等待线程之一; 要么
         * 一些其他线程在等待屏障时超时; 要么
         * 其他一些线程在这个屏障上调用reset() 。
         */</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">7</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> temp <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"收集到的\t第"</span> <span class="token operator">+</span> temp <span class="token operator">+</span> <span class="token string">"颗龙珠"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment" spellcheck="true">//等待所有parties已经在这个障碍上调用了await 。</span>
                    <span class="token comment" spellcheck="true">//如果当前线程不是最后一个线程，那么它被禁用以进行线程调度，并且处于休眠状态，直到发生下列事情之一：最后一个线程到了</span>
                    <span class="token comment" spellcheck="true">// 也就是等到最后一个线程到了，然后就开始执行start，start之后，线程的调度顺序还得看操作系统和cup的调度</span>
                    cb<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment" spellcheck="true">// 执行完成之后，就调用CyclicBarrier(int parties, Runnable barrierAction) 里面的barrierAction线程</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"线程\t"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>


    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Semaphore-信号灯"><a href="#Semaphore-信号灯" class="headerlink" title="Semaphore 信号灯"></a>Semaphore 信号灯</h2><h3 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h3><p>在信号量上我们定义两种操作：</p>
<p>acquire（获取） 当一个线程调用acquire操作时，它要么通过成功获取信号量（信号量减1），要么一直等下去，直到有线程释放信号量，或超时。</p>
<p> release（释放）实际上会将信号量的值加1，然后唤醒等待的线程。</p>
<p>信号量主要用于两个目的，一个是用于多个共享资源的互斥使用，另一个用于并发线程数的控制。</p>
<p><strong>这个可以用生活中的抢车位来类比</strong></p>
<h3 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Created with IntelliJ IDEA.
 * @Author: pzx
 * @Date: 2022/01/07    16:40
 * @Version:1.0
 * Semaphore这个主要是应用于抢车位
 * 这个主要用于多线程的并发控制和资源的互斥
 *
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SemaphoreDemo</span> <span class="token punctuation">{</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>




        <span class="token comment" spellcheck="true">// 模拟资源类，有三个空车位</span>
        <span class="token comment" spellcheck="true">// 当permits设置为1就相当于synchronized了</span>
        Semaphore semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">7</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>


            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment" spellcheck="true">//从此信号量获取许可证，阻止直到可用，否则线程为interrupted 。</span>
                    <span class="token comment" spellcheck="true">//获得许可证，如果有可用并立即返回，则将可用许可证数量减少一个。</span>
                    <span class="token comment" spellcheck="true">// 这里相当于抢占到车位</span>
                    semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t抢到了车位"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment" spellcheck="true">// 线程睡4秒钟，模拟停车停了4秒钟</span>
                    TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t离开了车位"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    <span class="token comment" spellcheck="true">//发放许可证，将可用许可证的数量增加一个。 如果任何线程尝试获取许可证，</span>
                    <span class="token comment" spellcheck="true">// 那么选择一个被授予刚被释放的许可证。 （重新）线程调度用于线程调度。</span>
                    <span class="token comment" spellcheck="true">// 这里相当于释放掉车位</span>
                    semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"线程"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="ReentrantReadWriteLock读写锁"><a href="#ReentrantReadWriteLock读写锁" class="headerlink" title="ReentrantReadWriteLock读写锁"></a>ReentrantReadWriteLock读写锁</h1><h2 id="类似案例"><a href="#类似案例" class="headerlink" title="类似案例"></a>类似案例</h2><p>红蜘蛛、缓存、数据库的更新和查询操作。</p>
<h2 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h2><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Created with IntelliJ IDEA.
 * @Author: pzx
 * @Date: 2022/01/07    22:00
 * @Version:1.0
 * 多个线程同时读一个资源类没有任何问题，所以为了满足并发量，读取共享资源应该可以同时进行
 * 但是
 * 如果有一个线程想去写共享资源来，就不应该再有其他线程可以对该资源进行读或者写
 * 小总结：
 *          读-读能共存
 *          读-写不能共存
 *          写-写不能共存
 * 使用读写锁，保证了数据的一致性操作  读锁是共享锁
 * 其实就是写加写锁,读就加读锁       写锁是排他锁
 *
 *
 */</span>
<span class="token keyword">class</span> <span class="token class-name">MyCache</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">volatile</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> ReadWriteLock readWriteLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * 添加操作
     * @param key
     * @param value
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span>String key<span class="token punctuation">,</span> Object value<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 加写锁</span>
            readWriteLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 写入开始</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t------写入开始"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t------写入完成"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 释放锁</span>
            readWriteLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * 读取操作
     * @param key
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">get</span><span class="token punctuation">(</span>String key<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 加写锁</span>
            readWriteLock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 读取开始</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t~~~~~~~~~~~~~~~~~~~~~~读取开始"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t~~~~~~~~~~~~~~~~~~~~~~"</span> <span class="token operator">+</span>
                    <span class="token string">".读取完成"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 释放锁</span>
            readWriteLock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReadWriteLockDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        MyCache myCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> temp <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>

                myCache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>temp <span class="token operator">+</span> <span class="token string">"\t"</span><span class="token punctuation">,</span> temp <span class="token operator">+</span> <span class="token string">"\t"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">5</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> temp <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
                myCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>temp <span class="token operator">+</span> <span class="token string">"\t"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>阻塞队列，空的时候不能消费，满的时候不能增加</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172859.png" alt="image-20220109110721761"></p>
<h1 id="BlockingQueueDemo-阻塞队列"><a href="#BlockingQueueDemo-阻塞队列" class="headerlink" title="BlockingQueueDemo  阻塞队列"></a>BlockingQueueDemo  阻塞队列</h1><h2 id="栈与队列"><a href="#栈与队列" class="headerlink" title="栈与队列"></a>栈与队列</h2><p>栈：先进后出，<strong>后进先出</strong></p>
<p>队列：先进先出</p>
<h2 id="阻塞队列的简单说明"><a href="#阻塞队列的简单说明" class="headerlink" title="阻塞队列的简单说明"></a>阻塞队列的简单说明</h2><p><strong>阻塞：必须要阻塞/不得不阻塞</strong><br>阻塞队列是一个队列，在数据结构中起的作用如下图：<img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172904.png" alt="image-20220109154737709"></p>
<p>当队列是空的，从队列中<strong>获取</strong>元素的操作将会被<strong>阻塞</strong><br>当队列是满的，从队列中<strong>添加</strong>元素的操作将会被<strong>阻塞</strong></p>
<p>试图从<strong>空的队列中获取元素的线程将会被阻塞</strong>，<strong>直到其他线程往空的队列插入新的元素</strong></p>
<p>试图<strong>向已满的队列中添加新元素的线程将会被阻塞</strong>，<strong>直到其他线程从队列中移除一个或多个元素或者完全清空，使队列变得空闲起来并后续新增</strong>    </p>
<h2 id="阻塞队列的用处"><a href="#阻塞队列的用处" class="headerlink" title="阻塞队列的用处"></a>阻塞队列的用处</h2><p>在多线程领域：所谓阻塞，在某些情况下会<strong>挂起</strong>线程（即阻塞），一旦条件满足，被挂起的线程又会自动<strong>被唤起</strong></p>
<p>为什么需要BlockingQueue<br>好处是我们不需要关心什么时候需要阻塞线程，什么时候需要唤醒线程，因为这一切BlockingQueue都给你一手包办了</p>
<p>在concurrent包发布以前，在多线程环境下，**我们每个程序员都必须去自己控制这些细节，尤其还要兼顾    **效率和线程安全，而这会给我们的程序带来不小的复杂度。</p>
<h2 id="阻塞队列的类图"><a href="#阻塞队列的类图" class="headerlink" title="阻塞队列的类图"></a>阻塞队列的类图</h2><p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172907.png" alt="image-20220109155943058"></p>
<p>下面三个最常用</p>
<ul>
<li>SynchronousQueue：不存储元素的阻塞队列，也即单个元素的队列。</li>
<li>ArrayBlockingQueue：由数组结构组成的有界阻塞队列。</li>
<li>LinkedBlockingQueue：由链表结构组成的有界（但大小默认值为integer.MAX_VALUE）阻塞队列。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172913.png" alt="image-20220109084253324"></p>
<h2 id="BlockingQueue核心方法"><a href="#BlockingQueue核心方法" class="headerlink" title="BlockingQueue核心方法"></a>BlockingQueue核心方法</h2><p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172920.png" alt="image-20220109160455125"></p>
<table>
<thead>
<tr>
<th>抛出异常</th>
<th>当阻塞队列满时，再往队列里add插入元素会抛IllegalStateException:Queue full当阻塞队列空时，再往队列里remove移除元素会抛NoSuchElementException</th>
</tr>
</thead>
<tbody><tr>
<td>特殊值</td>
<td>插入方法，成功ture失败false<br/>移除方法，成功返回出队列的元素，队列里没有就返回null</td>
</tr>
<tr>
<td>一直阻塞</td>
<td>当阻塞队列满时，生产者线程继续往队列里put元素，队列会一直阻塞生产者线程直到put数据or响应中断退出<br/>当阻塞队列空时，消费者线程试图从队列里take元素，队列会一直阻塞消费者线程直到队列可用</td>
</tr>
<tr>
<td>超时退出</td>
<td>当阻塞队列满时，队列会阻塞生产者线程一定时间，超过限时后生产者线程会退出</td>
</tr>
</tbody></table>
<h2 id="阻塞队列代码"><a href="#阻塞队列代码" class="headerlink" title="阻塞队列代码"></a>阻塞队列代码</h2><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Created with IntelliJ IDEA.
 * @Author: pzx
 * @Date: 2022/01/09    8:56
 * @Version:1.0
 *
 * 队列：先进先出，FIFO，就相当于食堂排队
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlockingQueueDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> InterruptedException <span class="token punctuation">{</span>
        BlockingQueue<span class="token operator">&lt;</span>String<span class="token operator">></span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">/**
         * 抛出异常
         * add:添加方法
         * remove：移除方法
         * element：检查方法， element是返回队首的元素，如果队列没有元素就返回null
         */</span>

        <span class="token comment" spellcheck="true">// add方法是添加元素</span>
 <span class="token comment" spellcheck="true">/*       System.out.println(queue.add("a"));
        System.out.println(queue.add("a"));
        System.out.println(queue.add("c"));
        // 队列满了
//        queue.add("d");  // Exception in thread "main" java.lang.IllegalStateException: Queue full
        System.out.println("========================================================================================");
        // element是返回队首的元素
        System.out.println(queue.element());
        // remove是移除元素
        System.out.println(queue.remove());
        System.out.println(queue.remove());
        System.out.println(queue.remove());
        // 队列为空了
//        System.out.println(queue.remove()); // Exception in thread "main" java.util.NoSuchElementException

        System.out.println("========================================================================================");
*/</span>
        <span class="token comment" spellcheck="true">/**
         * 特殊值
         * offer：插入成功返回true
         * poll：移除操作(移除队首的操作)，成功返回出队列的元素，队列里面没有就返回null
         * peek：检索但不删除由此queue表示的队列的头部（换句话说，该deque的第一个元素），
         * 如果此deque为空，则返回 null 。
         */</span>
<span class="token comment" spellcheck="true">/*
        System.out.println(queue.offer("aa"));
        System.out.println(queue.offer("bb"));
        System.out.println(queue.offer("cc"));
//        System.out.println(queue.offer("cc")); // false

        System.out.println(queue.peek());
        System.out.println(queue.peek());
        System.out.println(queue.peek());

        System.out.println(queue.poll());
        System.out.println(queue.poll());
        System.out.println(queue.poll());
//        System.out.println(queue.poll()); // null
        System.out.println("========================================================================================");
*/</span>

  <span class="token comment" spellcheck="true">/*      queue.put("aa");
        queue.put("aa");
        queue.put("aa");
//        queue.put("aa");    //这里本来只能放三个元素，但是想要添加四个元素，所以，最后的元素就会被阻塞，就相当于一直在等待消费去消费

        queue.take();
        queue.take();
        queue.take();
//        queue.take();   // 这队列里面本来只有三个元素，这里要获取第四个，所以就得一直等着，等生产者生产第四个



*/</span><span class="token comment" spellcheck="true">/*
        System.out.println(queue.take());
        System.out.println(queue.take());
        System.out.println(queue.take());
*/</span><span class="token comment" spellcheck="true">/*

         */</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">"aa"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">"aa"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">"aa"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 这个是等三秒，三秒要是还没有蛋糕就走了，过时不候</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">"aa"</span><span class="token punctuation">,</span> 3L<span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="方法参数的值传递机制"><a href="#方法参数的值传递机制" class="headerlink" title="方法参数的值传递机制"></a>方法参数的值传递机制</h2><ul>
<li><strong>方法</strong>，必须由其所在类或对象调用才有意义。若方法含有参数： <ul>
<li><strong>形参</strong>：方法声明时的参数 </li>
<li><strong>实参</strong>：方法调用时实际传给形参的参数值</li>
</ul>
</li>
</ul>
<p>Java的实参值如何传入方法呢？ Java里方法的参数传递方式只有一种：<strong>值传递。 即将实际参数值的副本 （复制品）传入方法内，而参数本身不受影响。</strong> </p>
<p>形参是<strong>基本数据类型</strong>：将实参基本数据类型变量的<strong>“数据值”</strong>传递给形参 </p>
<p>形参是<strong>引用数据类型</strong>：将实参引用数据类型变量的<strong>“地址值”</strong>传递给形参</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Created with IntelliJ IDEA.
 * @Author: pzx
 * @Date: 2022/01/09    10:10
 * @Version:1.0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestTransferValue</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">changeValue1</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        age <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">changeValue2</span><span class="token punctuation">(</span>Person person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        person<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"xxxx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">changeValue3</span><span class="token punctuation">(</span>String str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        str <span class="token operator">=</span> <span class="token string">"~~~~"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        TestTransferValue transferValue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestTransferValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//  在一个方法里面，基本类型只传复印件，原件不动</span>
        <span class="token keyword">int</span> age <span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span>
        transferValue<span class="token punctuation">.</span><span class="token function">changeValue1</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"age = "</span> <span class="token operator">+</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 这个自定义类型Person穿的是引用类型</span>

        Person person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"zsf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        transferValue<span class="token punctuation">.</span><span class="token function">changeValue2</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"personName ------------->"</span> <span class="token operator">+</span> person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        String str<span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span>
        transferValue<span class="token punctuation">.</span><span class="token function">changeValue3</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"str = "</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>    
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Person类</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">Person</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172926.png" alt="image-20220109174059210"></p>
<h1 id="ThreadPool线程池"><a href="#ThreadPool线程池" class="headerlink" title="ThreadPool线程池"></a>ThreadPool线程池</h1><hr>
<h2 id="为什么用线程池"><a href="#为什么用线程池" class="headerlink" title="为什么用线程池"></a>为什么用线程池</h2><p>例子：<br>10年前单核CPU电脑，假的多线程，像马戏团小丑玩多个球，CPU需要来回切换。<br>现在是多核电脑，多个线程各自跑在独立的CPU上，不用切换效率高。</p>
<p><strong>线程池的优势：</strong><br>线程池做的工作只要是控制运行的线程数量，<strong>处理过程中将任务放入队列，</strong>然后在线程创建后启动这些任务，<strong>如果线程数量超过了最大数量，超出数量的线程排队等候，</strong>等其他线程执行完毕，再从队列中取出任务来执行。</p>
<p>**它的主要特点为：线程复用;控制最大并发数;管理线程。                                                                       **</p>
<p>第一：降低资源消耗。通过重复利用已创建的线程降低线程创建和销毁造成的销耗。<br>第二：提高响应速度。当任务到达时，任务可以不需要等待线程创建就能立即执行。<br>第三：提高线程的可管理性。线程是稀缺资源，如果无限制的创建，不仅会销耗系统资源，还会降低系统的稳定性，使用线程池可以进行统一的分配，调优和监控。</p>
<h2 id="线程池如何使用"><a href="#线程池如何使用" class="headerlink" title="线程池如何使用"></a>线程池如何使用</h2><h3 id="架构说明"><a href="#架构说明" class="headerlink" title="架构说明"></a>架构说明</h3><p>Java中的线程池是通过Executor框架实现的，该框架中用到了<code>Executor</code>，<code>Executors</code>，<code>ExecutorService</code>，<code>ThreadPoolExecutor</code>这几个类</p>
<p> <img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172930.png" alt="image-20220109172347156"></p>
<h3 id="编码实现"><a href="#编码实现" class="headerlink" title="编码实现"></a>编码实现</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Created with IntelliJ IDEA.
 * @Author: pzx
 * @Date: 2022/01/09    14:10
 * @Version:1.0
 *
 * 线程池
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyThreadPoolDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment" spellcheck="true">// =================第一种=================</span>
        <span class="token comment" spellcheck="true">// Executors是线程池的工具类</span>
        <span class="token comment" spellcheck="true">// newFixedThreadPool创建    一个线程池，该线程池重用固定数量的从共享无界队列中运行的线程。</span>
        <span class="token comment" spellcheck="true">// 创建线程池，设置办理窗口(初始线程)为5</span>
        <span class="token comment" spellcheck="true">// 一池5线程，类似一个银行有5个受理窗口</span>
<span class="token comment" spellcheck="true">//        ExecutorService threadPool = Executors.newFixedThreadPool(5);</span>

        <span class="token comment" spellcheck="true">// =================第二种=================</span>
        <span class="token comment" spellcheck="true">// 线程池只有一个工作线程，类似于，银行只有一个办理窗口</span>
        <span class="token comment" spellcheck="true">//  ExecutorService threadPool = Executors.newSingleThreadExecutor();</span>
        <span class="token comment" spellcheck="true">// 一池N线程，一个池子里面有多个线程，类似于银行有N个受理窗口，这和每个线程执行的事件有关</span>
        <span class="token comment" spellcheck="true">// 创建一个根据需要创建新线程的线程池，但在可用时将重新使用以前构造的线程。</span>


        <span class="token comment" spellcheck="true">// =================第三种=================</span>
        ExecutorService threadPool <span class="token operator">=</span> Executors<span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                threadPool<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>

                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t办理完成"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">// 暂停1秒钟，模拟办理时候的耗时</span>
<span class="token comment" spellcheck="true">//                TimeUnit.SECONDS.sleep(1);</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 关闭线程池</span>
            threadPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="底层原理"><a href="#底层原理" class="headerlink" title="底层原理"></a>底层原理</h3><p>其实他底层都是创建一个<strong>ThreadPoolExecutor</strong>，然后传入不同类型的参数，调用不同的构造器</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Creates a new {@code ThreadPoolExecutor} with the given initial
 * parameters and default thread factory and rejected execution handler.
 * It may be more convenient to use one of the {@link Executors} factory
 * methods instead of this general purpose constructor.
 *
 * @param corePoolSize the number of threads to keep in the pool, even
 *        if they are idle, unless {@code allowCoreThreadTimeOut} is set
 * @param maximumPoolSize the maximum number of threads to allow in the
 *        pool
 * @param keepAliveTime when the number of threads is greater than
 *        the core, this is the maximum time that excess idle threads
 *        will wait for new tasks before terminating.
 * @param unit the time unit for the {@code keepAliveTime} argument
 * @param workQueue the queue to use for holding tasks before they are
 *        executed.  This queue will hold only the {@code Runnable}
 *        tasks submitted by the {@code execute} method.
 * @throws IllegalArgumentException if one of the following holds:&lt;br>
 *         {@code corePoolSize &lt; 0}&lt;br>
 *         {@code keepAliveTime &lt; 0}&lt;br>
 *         {@code maximumPoolSize &lt;= 0}&lt;br>
 *         {@code maximumPoolSize &lt; corePoolSize}
 * @throws NullPointerException if {@code workQueue} is null
 */</span>
<span class="token keyword">public</span> <span class="token function">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
                          TimeUnit unit<span class="token punctuation">,</span>
                          BlockingQueue<span class="token operator">&lt;</span>Runnable<span class="token operator">></span> workQueue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span>corePoolSize<span class="token punctuation">,</span> maximumPoolSize<span class="token punctuation">,</span> keepAliveTime<span class="token punctuation">,</span> unit<span class="token punctuation">,</span> workQueue<span class="token punctuation">,</span>
         Executors<span class="token punctuation">.</span><span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> defaultHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="C:\Users\losser\AppData\Roaming\Typora\typora-user-images\image-20220109181909648.png" alt="image-20220109181909648"></p>
<h2 id="线程池几个重要参数"><a href="#线程池几个重要参数" class="headerlink" title="线程池几个重要参数"></a>线程池几个重要参数</h2><ol>
<li><p><code>corePoolSize</code>：线程池中的常驻核心线程数</p>
</li>
<li><p><code>maximumPoolSize</code>：线程池中能够容纳同时<br>执行的最大线程数，此值必须大于等于1</p>
</li>
<li><p><code>keepAliveTime</code>：多余的空闲线程的存活时间<br>当前池中线程数量超过corePoolSize时，当空闲时间<br>达到<code>keepAliveTime</code>时，多余线程会被销毁直到<br>只剩下<code>corePoolSize</code>个线程为止</p>
</li>
<li><p><code>unit：</code> <code>keepAliveTime</code>的单位 </p>
</li>
<li><p><code>workQueue</code>：任务队列，被提交但尚未被执行的任务</p>
</li>
<li><p><code>threadFactory</code>：表示生成线程池中工作线程的线程工厂，<br>用于创建线程，一般默认的即可</p>
</li>
<li><p><code>handler</code>：拒绝策略，表示当队列满了，并且工作线程大于<br>等于线程池的最大线程数（<code>maximumPoolSize</code>）时如何来拒绝<br>请求执行的runnable的策略</p>
</li>
</ol>
<h2 id="线程池底层工作原理"><a href="#线程池底层工作原理" class="headerlink" title="线程池底层工作原理"></a>线程池底层工作原理</h2><p>步骤是下面的1到4</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172935.png" alt="image-20220109183737541"></p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172938.png" alt="image-20220109203111160"></p>
<p>下图的<code>corePoolSize</code>为2，<code>maximumPoolSize</code>为5，当一开始有两个客户（1，2线程）来办理业务的时候，两个今日窗口正好能够处理。当后面3，4，5又来时，<code>BlockingQueue</code>也正好满了（为5）；然后大堂经理就叫其他的员工来值班扩大到<code>maximumPoolSize</code>（也就是扩容到最大的线程数5）。当后面又进来三个线程（6，7，8）的时候就进入候客区（<code>BlockingQueue</code>），候客区也满了。但此时如果进来了另一个客户（9），就会告知本银行今天的业务繁忙，请到其他网点去办理业务（这里是按照拒绝策略处理）。如果设置了<code>keepAliveTime</code>的话，新增的扩容的员工，在处理完所有的业务之后，过<code>keepAliveTime</code>这么久时间，就会恢复到原来的<code>corePoolSize</code>.</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token function">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
                          TimeUnit unit<span class="token punctuation">,</span>
                          BlockingQueue<span class="token operator">&lt;</span>Runnable<span class="token operator">></span> workQueue<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="C:\Users\losser\AppData\Roaming\Typora\typora-user-images\image-20220109195333905.png" alt="image-20220109195333905"></p>
<p><img src="C:\Users\losser\AppData\Roaming\Typora\typora-user-images\image-20220109201025539.png" alt="image-20220109201025539"></p>
<p> <strong>以下重要：</strong></p>
<ol>
<li><p>在创建了线程池后，开始等待请求。</p>
</li>
<li><p>当调用**execute()**方法添加一个请求任务时，线程池会做出如下判断：</p>
<pre><code>  2.2如果正在运行的线程数量小于**corePoolSize**，那么马上创建线程运行这个任务；

  2.2如果正在运行的线程数量大于或等于**corePoolSize**，那么将这个任务放入队列；

  2.3如果这个时候队列满了且正在运行的线程数量还小于**maximumPoolSize**，那么还是要创建非核心线程立刻运行这个任务；

  2.4如果队列满了且正在运行的线程数量大于或等于**maximumPoolSize**，那么线程池会启动饱和拒绝策略来执行。
</code></pre>
</li>
</ol>
<p>3当一个线程完成任务时，它会从队列中取下一个任务来执行。</p>
<p>4当一个线程无事可做超过一定的时间（<strong>keepAliveTime</strong>）时，线程会判断：</p>
<p>如果当前运行的线程数大于<strong>corePoolSize</strong>，那么这个线程就被停掉。</p>
<p>所以线程池的所有任务完成后，它最终会收缩到<strong>corePoolSize</strong>的大小。</p>
<h2 id="线程池用哪个？生产中如设置合理参数"><a href="#线程池用哪个？生产中如设置合理参数" class="headerlink" title="线程池用哪个？生产中如设置合理参数"></a>线程池用哪个？生产中如设置合理参数</h2><h3 id="线程池的拒绝策略"><a href="#线程池的拒绝策略" class="headerlink" title="线程池的拒绝策略"></a>线程池的拒绝策略</h3><h4 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h4><p><strong>等待队列已经排满了</strong>，再也塞不下新任务了</p>
<p>同时，<strong>线程池中的max线程也达到了</strong>，无法继续为新任务服务。</p>
<p>这个是时候我们就需要拒绝策略机制合理的处理这个问题。</p>
<h4 id="JDK内置的拒绝策略"><a href="#JDK内置的拒绝策略" class="headerlink" title="JDK内置的拒绝策略"></a>JDK内置的拒绝策略</h4><ul>
<li>AbortPolicy(默认)：直接抛出RejectedExecutionException异常阻止系统正常运行</li>
<li>CallerRunsPolicy：“调用者运行”一种调节机制，该策略既不会抛弃任务，也不<br>会抛出异常，而是将某些任务回退到调用者，从而降低新任务的流量。</li>
<li>DiscardOldestPolicy：抛弃队列中等待最久的任务，然后把当前任务加人队列中<br>尝试再次提交当前任务。</li>
<li>DiscardPolicy：该策略默默地丢弃无法处理的任务，不予任何处理也不抛出异常。<br>如果允许任务丢失，这是最好的一种策略。</li>
</ul>
<h3 id="以上内置拒绝策略均实现了RejectedExecutionHandle接口"><a href="#以上内置拒绝策略均实现了RejectedExecutionHandle接口" class="headerlink" title="以上内置拒绝策略均实现了RejectedExecutionHandle接口"></a>以上内置拒绝策略均实现了RejectedExecutionHandle接口</h3><h2 id="在工作中单一的-固定数的-可变的三种创建线程池的方法哪个用的多？超级大坑"><a href="#在工作中单一的-固定数的-可变的三种创建线程池的方法哪个用的多？超级大坑" class="headerlink" title="在工作中单一的/固定数的/可变的三种创建线程池的方法哪个用的多？超级大坑"></a>在工作中单一的/固定数的/可变的三种创建线程池的方法哪个用的多？超级大坑</h2><ol>
<li>答案是一个都不用，我们工作中只能使用自定义的</li>
<li>Executors中JDK已经给你提供了，为什么不用？</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172949.png" alt="image-20220109184859628"></p>
<h1 id="Java8之流式计算复习"><a href="#Java8之流式计算复习" class="headerlink" title="Java8之流式计算复习"></a>Java8之流式计算复习</h1><h2 id="函数式接口"><a href="#函数式接口" class="headerlink" title="函数式接口"></a>函数式接口</h2><h3 id="java-util-function"><a href="#java-util-function" class="headerlink" title="java.util.function"></a>java.util.function</h3><p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172952.png" alt="image-20220111120945026"></p>
<h3 id="java内置核心四大函数式接口"><a href="#java内置核心四大函数式接口" class="headerlink" title="java内置核心四大函数式接口"></a>java内置核心四大函数式接口</h3><p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118172954.png" alt="image-20220111121004428"></p>
<p>伪代码：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//R apply(T t);函数型接口，一个参数，一个返回值</span>
Function<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Integer<span class="token operator">></span> function <span class="token operator">=</span> t <span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">return</span> t<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>function<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token string">"abcd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//boolean test(T t);断定型接口，一个参数，返回boolean</span>
Predicate<span class="token operator">&lt;</span>String<span class="token operator">></span> predicate <span class="token operator">=</span> t<span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">return</span> t<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>predicate<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// void accept(T t);消费型接口，一个参数，没有返回值</span>
Consumer<span class="token operator">&lt;</span>String<span class="token operator">></span> consumer <span class="token operator">=</span> t<span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">"javaXXXX"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//T get(); 供给型接口，无参数，有返回值</span>
Supplier<span class="token operator">&lt;</span>String<span class="token operator">></span> supplier <span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">return</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>supplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Stream流"><a href="#Stream流" class="headerlink" title="Stream流"></a>Stream流</h2><h3 id="流是什么"><a href="#流是什么" class="headerlink" title="流是什么"></a>流是什么</h3><p>流(Stream) 到底是什么呢？<br>是数据渠道，用于操作数据源（集合、数组等）所生成的元素序列。<br><strong>“集合讲的是数据，流讲的是计算！”</strong></p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ol>
<li>Stream 自己不会存储元素</li>
<li>Stream 不会改变源对象。相反，他们会返回一个持有结果的新Stream。</li>
<li>Stream 操作是延迟执行的。这意味着他们会等到需要结果的时候才执行。</li>
</ol>
<h3 id="阶段"><a href="#阶段" class="headerlink" title="阶段"></a>阶段</h3><ol>
<li>创建一个Stream：一个数据源（数组、集合）</li>
<li>中间操作：一个中间操作，处理数据源数据</li>
<li>终止操作：一个终止操作，执行中间操作链，产生结果</li>
</ol>
<p>过程：</p>
<p><strong>源头=&gt;中间流水线=&gt;结果</strong></p>
<p>代码示例：</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Created with IntelliJ IDEA.
 * @Author: pzx
 * @Date: 2022/01/10    13:15
 * @Version:1.0
 *
 *  (lambda表达式的几个步骤 ：
 *1 、 拷贝小括号 ( 如果只有一个参数的话, 可以省略参数类型和括号)
 *          2、写死右箭头
 *          3/落地大括号
 */</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@Data</span>
<span class="token comment" spellcheck="true">// 支持链式调用</span>
<span class="token annotation punctuation">@Accessors</span><span class="token punctuation">(</span>chain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// 链式编程 +   流式计算</span>

    <span class="token keyword">private</span> Integer id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String userName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/**
 * 题目:请按照给出数据，找出同时满足以下条件的用户,也即以下条件全部满足
 * 偶数ID且年龄大于24且用户名转为大写且用户名字母倒排序
 * 只输出一个用户名字
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StreamDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>


        User u1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span>  <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        User u2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        User u3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        User u4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        User u5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">"e"</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 将数组转换成list集合</span>
        List<span class="token operator">&lt;</span>User<span class="token operator">></span> list <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>u1<span class="token punctuation">,</span> u2<span class="token punctuation">,</span> u3<span class="token punctuation">,</span> u4<span class="token punctuation">,</span> u5<span class="token punctuation">)</span><span class="token punctuation">;</span>
        List<span class="token operator">&lt;</span>User<span class="token operator">></span> users <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>user <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 过滤掉为id为偶数的</span>
            <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>user <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 过滤年龄大于24的</span>
            <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">24</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// map是映射</span>
            <span class="token comment" spellcheck="true">// sorted是stream的排序，默认是升序</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>user <span class="token operator">-</span><span class="token operator">></span> user<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 降序排列</span>
            <span class="token keyword">return</span> <span class="token operator">-</span>o1<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>o2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// limit和MySQL中的类似，限制个数.forEach进行遍历，然后加</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>out<span class="token operator">:</span><span class="token operator">:</span>println<span class="token punctuation">)</span><span class="token punctuation">;</span>


        list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/*        for (User user : list) {
            if (user.getId() % 2 == 0 &amp;&amp; user.getAge() > 24) {
                user.setUserName(user.getUserName().toUpperCase());
                users.add(user);
            }
        }*/</span>


    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="分支合并框架"><a href="#分支合并框架" class="headerlink" title="分支合并框架"></a>分支合并框架</h1><h2 id="原理-4"><a href="#原理-4" class="headerlink" title="原理"></a>原理</h2><p>Fork：把一个复杂任务进行分拆，大事化小<br>Join：把分拆任务的结果进行合并</p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118173002.png" alt="image-20220111121606583"></p>
<p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118173004.png" alt="image-20220111121613341"></p>
<h2 id="相关类"><a href="#相关类" class="headerlink" title="相关类"></a>相关类</h2><p>和Exector相关，以及线程池有关</p>
<h3 id="ForkJoinPool"><a href="#ForkJoinPool" class="headerlink" title="ForkJoinPool"></a>ForkJoinPool</h3><p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118173007.png" alt="image-20220111134910595"></p>
<p>分支合并池    类比=&gt;   线程池</p>
<h3 id="ForkJoinTask"><a href="#ForkJoinTask" class="headerlink" title="ForkJoinTask"></a>ForkJoinTask</h3><p> <img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118173010.png" alt="image-20220111134928706"></p>
<p>ForkJoinTask    类比=&gt;   FutureTask</p>
<h3 id="RecursiveTask"><a href="#RecursiveTask" class="headerlink" title="RecursiveTask"></a>RecursiveTask</h3><p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118173012.png" alt="image-20220111135645753"></p>
<p>递归任务：继承后可以实现递归(自己调自己)调用的任务</p>
<p>伪代码</p>
<pre class="line-numbers language-java"><code class="language-java"> 
 <span class="token keyword">class</span> <span class="token class-name">Fibonacci</span> <span class="token keyword">extends</span> <span class="token class-name">RecursiveTask</span><span class="token operator">&lt;</span>Integer<span class="token operator">></span> <span class="token punctuation">{</span>
   <span class="token keyword">final</span> <span class="token keyword">int</span> n<span class="token punctuation">;</span>
   <span class="token function">Fibonacci</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>n <span class="token operator">=</span> n<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   Integer <span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span>
       <span class="token keyword">return</span> n<span class="token punctuation">;</span>
     Fibonacci f1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fibonacci</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     f1<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     Fibonacci f2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fibonacci</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> f2<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> f1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ForkJoin的使用代码</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Created with IntelliJ IDEA.
 * @Author: pzx
 * @Date: 2022/01/10    22:05
 * @Version:1.0
 * ForkJoin框架
 * 用到了分治算法
 * 基础回顾：
 * 抽象类被继承
 * 接口被实现
 */</span>
<span class="token keyword">class</span> <span class="token class-name">MyTask</span> <span class="token keyword">extends</span> <span class="token class-name">RecursiveTask</span><span class="token operator">&lt;</span>Integer<span class="token operator">></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Integer ADJUST_VALUE <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> begin<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> end<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> result<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">MyTask</span><span class="token punctuation">(</span><span class="token keyword">int</span> begin<span class="token punctuation">,</span> <span class="token keyword">int</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>begin <span class="token operator">=</span> begin<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> end<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> Integer <span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> begin <span class="token operator">&lt;=</span> ADJUST_VALUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 当数值差小于等于10的时候就直接进行累加</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> begin<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> end<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                result <span class="token operator">+=</span> i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> middle <span class="token operator">=</span> <span class="token punctuation">(</span>begin <span class="token operator">+</span> end<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 这里是递归</span>
            <span class="token comment" spellcheck="true">// 第一个任务从begin加到中间</span>
            MyTask task01 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyTask</span><span class="token punctuation">(</span>begin<span class="token punctuation">,</span> middle<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 第二个任务从中间加到最末尾</span>
            MyTask task02 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyTask</span><span class="token punctuation">(</span>middle <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 回来调用compute</span>
            task01<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            task02<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 当 is done返回计算结果。</span>
            result <span class="token operator">=</span> task01<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> task02<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ForkJoinDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 创建forkjoin池</span>
        ForkJoinPool forkJoinPool <span class="token operator">=</span> null<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            MyTask myTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyTask</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            forkJoinPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// 计算任务</span>
            ForkJoinTask<span class="token operator">&lt;</span>Integer<span class="token operator">></span> task <span class="token operator">=</span> forkJoinPool<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>myTask<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 获取计算的结果</span>
            Integer integer <span class="token operator">=</span> task<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"integer = "</span> <span class="token operator">+</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>forkJoinPool <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                forkJoinPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="异步回调CompletableFuture"><a href="#异步回调CompletableFuture" class="headerlink" title="异步回调CompletableFuture"></a>异步回调CompletableFuture</h1><h2 id="CompletableFuture"><a href="#CompletableFuture" class="headerlink" title="CompletableFuture"></a>CompletableFuture</h2><p><img src="https://cdn.jsdelivr.net/gh/losserlong/pictures/20220118173016.png" alt="image-20220111145007736"></p>
<p>这一段，听得挺迷的，有点类似于ajax的异步请求</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Created with IntelliJ IDEA.
 * @Author: pzx
 * @Date: 2022/01/10    22:47
 * @Version:1.0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableFutureDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> ExecutionException<span class="token punctuation">,</span> InterruptedException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 没有返回值的</span>
        CompletableFuture<span class="token operator">&lt;</span>Void<span class="token operator">></span> completableFuture <span class="token operator">=</span> CompletableFuture<span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t没有返回值"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        completableFuture<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment" spellcheck="true">// 异步回调，有返回值supplyAsync供给型函数式接口</span>
        CompletableFuture<span class="token operator">&lt;</span>Integer<span class="token operator">></span> completableFuture2 <span class="token operator">=</span> CompletableFuture<span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Thread<span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t completableFuture2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//            return 10 / 0;</span>
            <span class="token keyword">return</span> <span class="token number">1024</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//  whenComplete方法返回一个新的CompletableFuture，当CompletableFuture完成时完成，</span>
        <span class="token comment" spellcheck="true">//  whenComplete(</span>
        <span class="token comment" spellcheck="true">//        BiConsumer&lt;? super T, ? super Throwable> action)</span>
        Integer result <span class="token operator">=</span> completableFuture2<span class="token punctuation">.</span><span class="token function">whenComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 不出异常就走这一步</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"a = "</span> <span class="token operator">+</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 这里为null就表示没有异常</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"b = "</span> <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">//结果是异常触发此CompletableFuture的完成特殊功能的给定功能;</span>
            <span class="token comment" spellcheck="true">// 否则，如果此CompletableFuture正常完成，则返回的CompletableFuture也会以相同的值正常完成。</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exceptionally</span><span class="token punctuation">(</span>f <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">//  CompletableFuture&lt;T> exceptionally(</span>
            <span class="token comment" spellcheck="true">//        Function&lt;Throwable, ? extends T> fn)</span>

            <span class="token comment" spellcheck="true">// 这个是当出现异常的时候就会走这一步</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">444</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://losserlong.github.io/2022/01/16/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/author.jpg">
      <meta itemprop="name" content="Xiang">
      <meta itemprop="description" content="今日长缨在手，何时缚住苍龙？">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiang's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/16/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-16 18:18:51 / 修改时间：18:18:23" itemprop="dateCreated datePublished" datetime="2022-01-16T18:18:51+08:00">2022-01-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo server
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo generate
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo deploy
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Xiang"
      src="/images/author.jpg">
  <p class="site-author-name" itemprop="name">Xiang</p>
  <div class="site-description" itemprop="description">今日长缨在手，何时缚住苍龙？</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/losserlong" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;losserlong" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1049385564@qq.com" title="E-Mail → mailto:1049385564@qq.com" rel="noopener" target="_blank"><i class="fab fa-qq fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xiang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
<div>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<span id="busuanzi_container_site_pv" style='display:none'>
    本站总访问量 <span id="busuanzi_value_site_pv"></span> 次
    <span class="post-meta-divider">|</span>
</span>
<span id="busuanzi_container_site_uv" style='display:none'>
    有<span id="busuanzi_value_site_uv"></span>人看过我的博客啦
</span>
</div>
<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();
        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
        var t1 = Date.UTC(2022, 1, 11, 00, 00, 00); //北京时间2018-2-13 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已运行 " +diffYears+" 年 "+diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>
<span id="sitetime"></span>
        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  <!-- 代码块复制功能 -->
<script type="text/javascript" src="/js/src/clipboard.min.js"></script>  
<script type="text/javascript" src="/js/src/clipboard-use.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>
</html>
